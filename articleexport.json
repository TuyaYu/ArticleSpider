[
{"comment_nums": 0, "url_object_id": "366f225c06e5d219f2213ca1330cfce3", "url": "http://blog.jobbole.com/111926/", "tags": ["IT技术", "OAuth2"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>作为第三方应用，为了提升用户体验，往往会提供第三方社交账号登录或者绑定的功能，这背后使用到的关键技术是OAuth认证。想要在自己的应用里集成OAuth不是难事儿，各大社交网站都提供了详尽的文档指南。</p>\n<div>\n<p>OAuth的复杂度比较高，有不少安全方面的坑，开发者在使用过程中一不注意可能就会掉进去，比如说不正确的使用OAuth2可能会遭遇到CSRF攻击。本文将对这个安全风险做一个通俗易懂的解释。 老司机发车前的特别提醒：阅读本文需要你对OAuth2有一些了解，可以参考文末的链接。</p>\n<h3>1. OAuth2 授权模式回顾</h3>\n<p>在开始之前，让我们先来回顾一下OAuth2中最典型的Authorization Code 授权模式，其大致流程如下：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-OAuth2-Authorization-Code-Flow.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-OAuth2-Authorization-Code-Flow.png\" alt=\"\" width=\"768\" height=\"734\"></a></p>\n<p>图1：OAuth2 Authorization Code Flow</p>\n<p>我们把OAuth2的整个认证过程大致分为三个阶段。第一阶段主要是向用户取得授权许可，对应图中的第1、2、3步；第二阶段主要是申请访问令牌（access_token），对应图中的第4、5步；第三阶段就是使用access_token获取用户数据。</p>\n<p>这一过程中涉及了不少敏感参数和数据，例如client_secret相当于是第三方应用自己的密码，access_token某种程度上来讲就是用户的session id。由于这些参数以及数据极其特殊，我们当然得确保它们的安全性，HTTPS加密传输以及安全存储是必不可少的防护手段。不过仅仅做到这些是远远不够的，在这个流程里存在一个弱点，容易被攻击者利用进行CSRF攻击。</p>\n<h3>2. 针对OAuth2的CSRF攻击</h3>\n<h4>2.1 攻击流程</h4>\n<p>让我们来看一个针对OAuth2的CSRF攻击的例子。假设有用户张三，和攻击者李四，还有一个第三方Web应用Tonr，它集成了第三方社交账号登录，并且允许用户将社交账号和Tonr中的账号进行绑定。此外还有一个OAuth2服务提供者Sparklr。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-CSRF-attack.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-CSRF-attack.png\" alt=\"\" width=\"768\" height=\"250\"></a></p>\n<p>图2：模拟攻击案例中涉及的角色</p>\n<p>Step 1. 攻击者李四登录Tonr网站，并且选择绑定自己的Sparklr账号。</p>\n<p>Step 2. Tonr网站将李四重定向到Sparklr，由于他之前已经登录过Sparklr，所以Sparklr直接向他显示“是否授权Tonr访问”的页面。</p>\n<p>Step 3. 李四在点击”同意授权“之后，截获Sparklr服务器返回的含有Authorization Code参数的HTTP响应。</p>\n<p>Step 4. 李四精心构造一个Web页面，它会触发Tonr网站向Sparklr发起令牌申请的请求，而这个请求中的Authorization Code参数正是上一步截获到的code。</p>\n<p>Step 5. 李四将这个Web页面放到互联网上，等待或者诱骗受害者张三来访问。</p>\n<p>Step 6. 张三之前登录了Tonr网站，只是没有把自己的账号和其他社交账号绑定起来。在张三访问了李四准备的这个Web页面后，令牌申请流程在张三的浏览器里被顺利触发，Tonr网站从Sparklr那里获取到access_token，但是这个token以及通过它进一步获取到的用户信息却都是攻击者李四的。</p>\n<p>Step 7. Tonr网站将李四的Sparklr账号同张三的Tonr账号关联绑定起来，从此以后，李四就可以用自己的Sparklr账号通过OAuth登录到张三在Tonr网站中的账号，堂而皇之的冒充张三的身份执行各种操作。</p>\n<p>等等，这一切发生得太快，还没看清楚李四怎么就登录到张三的账号里去了。没关系，让我们从几个不同的角度来看看这当中发生了什么。</p>\n<h4>2.2 受害者张三(Resource Owner)视角</h4>\n<p>受害者张三访问了一个Web页面，然后，就没有然后了，他在Tonr网站上的账号就和攻击者李四在Sparklr上的账号绑定到了一起。伪造的请求是经过精心构造的，令牌申请这一过程在张三的浏览器里是非常隐蔽的被触发的，换句话讲就是，他根本不知道这背后发生了什么。</p>\n<h4>2.3 Tonr网站(Client)视角</h4>\n<p>从Tonr网站来看，它收到的所有请求看上去都是正常的。首先它收到了一个HTTP请求，其代表着当前用户张三在Sparklr网站上已经做了“同意授权”操作。其内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597160a817ef4808913184\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGET /bindingCallback?code=AUTHORIZATION_CODE\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597160a817ef4808913184-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597160a817ef4808913184-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597160a817ef4808913184-1\"><span class=\"crayon-v\">GET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bindingCallback</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">code</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">AUTHORIZATION</span><span class=\"crayon-sy\">_</span>CODE</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597160a817ef4808913184-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>不过需要注意的是，URL里的code不是当前受害者张三的Authorization Code，而是攻击者李四的。</p>\n<p>当Tonr收到这样的请求时，它以为张三已经同意授权（但实际上这个请求是李四伪造的），于是就发起后续的令牌申请请求，用收到的Authorization Code向Sparklr换取access_token，只不过最后拿到的是攻击者李四的 access_token。</p>\n<p>最后，Tonr网站把攻击者李四的access_token和当前受害者张三在Tonr网站上的账号进行关联绑定。</p>\n<h4>2.4 Sparklr网站(OAuth2服务提供者)视角</h4>\n<p>Sparklr网站也是一脸茫然的样子，因为在它看来，自己收到的授权请求，以及后续的令牌申请请求都是正常的，或者说它无法得知接收到的这些请求之间的关联关系，而且也无法区别出这些请求到底是来自张三本人，还是由李四伪造出来的。因此只要自己收到的参数是正确有效的，那就提供正常的认证服务，仅此而已。</p>\n<h4>2.5 攻击者李四视角</h4>\n<p>李四伪造了一个用户授权成功的请求，并且将其中的Authorization Code参数替换成了自己提前获取到的code。这样，当受害者张三的浏览器被欺骗从而发起令牌申请请求时，实际上是在用张三在Tonr网站上的账号和李四在Sparklr网站上的账号做绑定。</p>\n<p>攻击完成后，李四在Tonr网站上可以通过自己在Sparklr网站的账号进行登录，而且登录进入的是张三在Tonr网站上的账号。而张三通过自己在Tonr网站上的账号登录进去之后，看到的是李四在Sparklr网站上的数据。</p>\n<h4>2.6 上帝视角</h4>\n<p>从整体上来看，这次攻击的时序图应该是下面这个样子的：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-Sparklr.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-Sparklr.png\" alt=\"\" width=\"768\" height=\"734\"></a></p>\n<p>图3：攻击时序图示</p>\n<h3>3. 漏洞的本质</h3>\n<p>这个问题的关键点在于，OAuth2的认证流程是分为好几步来完成的，在图1中的第4步，第三方应用在收到一个GET请求时，除了能知道当前用户的cookie，以及URL中的Authorization Code之外，难以分辨出这个请求到底是用户本人的意愿，还是攻击者利用用户的身份伪造出来的请求。 于是乎，攻击者就能使用移花接木的手段，提前准备一个含有自己的Authorization Code的请求，并让受害者的浏览器来接着完成后续的令牌申请流程。</p>\n<h3>4. 前提条件</h3>\n<p>尽管这个攻击既巧妙又隐蔽，但是要成功进行这样的CSRF攻击也是需要满足一定前提条件的。</p>\n<p>首先，在攻击过程中，受害者张三在Tonr网站上的用户会话(User Session)必须是有效的，也就是说，张三在受到攻击前已经登录了Tonr网站。</p>\n<p>其次，整个攻击必须在短时间内完成，因为OAuth2提供者颁发的Authorization Code有效期很短，OAuth2官方推荐的时间是不大于10分钟，而一旦Authorization Code过期那么后续的攻击也就不能进行下去了。</p>\n<p>最后，一个Authorization Code只能被使用一次，如果OAuth2提供者收到重复的Authorization Code，它会拒绝当前的令牌申请请求。不止如此，根据OAuth2官方推荐，它还可以把和这个已经使用过的Authorization Code相关联的access_token全部撤销掉，进一步降低安全风险。</p>\n<h3>5. 防御办法</h3>\n<p>要防止这样的攻击其实很容易，作为第三方应用的开发者，只需在OAuth认证过程中加入state参数，并验证它的参数值即可。具体细节如下：</p>\n<ul>\n<li>在将用户重定向到OAuth2的Authorization Endpoint去的时候，为用户生成一个随机的字符串，并作为state参数加入到URL中。</li>\n<li>在收到OAuth2服务提供者返回的Authorization Code请求的时候，验证接收到的state参数值。如果是正确合法的请求，那么此时接受到的参数值应该和上一步提到的为该用户生成的state参数值完全一致，否则就是异常请求。</li>\n<li>state参数值需要具备下面几个特性：\n<ul>\n<li>不可预测性：足够的随机，使得攻击者难以猜到正确的参数值</li>\n<li>关联性：state参数值和当前用户会话（user session）是相互关联的</li>\n<li>唯一性：每个用户，甚至每次请求生成的state参数值都是唯一的</li>\n<li>时效性：state参数一旦被使用则立即失效</li>\n</ul>\n</li>\n</ul>\n<h3>6. 总结</h3>\n<p>要避免遭受本文提到的CSRF攻击问题，需要第三方应用正确的使用state参数，然而纵观各大OAuth服务提供者，在其开发文档里都没有明确把state参数和CSRF攻击联系起来，仅仅只是像下面这样一句话带过：</p>\n<p><em>“参数：state</em></p>\n<p><em>是否必须：否</em></p>\n<p><em>说明：重定向后会带上state参数，开发者可以填写a-zA-Z0-9的参数值，最多128字节”</em></p>\n<p>让事情变得更糟糕的是，state是可选参数，因此更容易被开发者忽略，造成安全风险。此外，本文中的攻击非常巧妙，可以悄无声息的攻陷受害者的账号，难以被察觉到。</p>\n<p>作为第三方应用的开发者，我们除了参考OAuth2服务提供者的开发文档之外，还应当加深自己对OAuth2的理解，尽可能的避开这些安全的坑。 而作为OAuth2服务提供者，也应当承担起提醒开发者注意防范安全风险的责任。</p>\n<p>参考资料</p>\n<ul>\n<li><a href=\"https://aaronparecki.com/oauth-2-simplified/\">OAuth2 Simplified</a></li>\n<li><a href=\"https://tools.ietf.org/html/rfc6749\">OAuth2 Authorization Framework RFC6749</a></li>\n</ul>\n<div></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111926\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111926votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111926\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 60</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-07-20", "vote": " ", "front_image_path": "full/a9d57da89cab263e2f865e47192960cec716c90d.jpg", "title": "移花接木：针对OAuth2的攻击", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-OAuth2-Authorization-Code-Flow.png"]},
{"comment_nums": 0, "url_object_id": "d374f2fc6bd013a58513687fe2fe4e97", "url": "http://blog.jobbole.com/111866/", "tags": ["IT技术", "分库分表", "数据库"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/bluishglc/article/details/7710738\">Laurence的技术博客</a>   </div><p>本文将主要介绍一些常见的全局主键生成策略，然后重点介绍flickr使用的一种非常优秀的全局主键生成方案。关于分库分表(sharding)的拆分策略和实施细则，请参考该系列的前一篇文章：<a href=\"http://blog.jobbole.com/111860/\" target=\"_blank\">DB 分库分表（1）：拆分实施策略和示例演示</a></p>\n<p><strong>第一部分：一些常见的主键生成策略</strong></p>\n<p>一旦<a class=\"replace_word\" title=\"MySQL知识库\" href=\"http://lib.csdn.net/base/14\" target=\"_blank\">数据库</a>被切分到多个物理结点上，我们将不能再依赖数据库自身的主键生成机制。一方面，某个分区数据库自生成的ID无法保证在全局上是唯一的；另一方面，应用程序在插入数据之前需要先获得ID,以便进行SQL路由。目前几种可行的主键生成策略有：<br>\n1. UUID：使用UUID作主键是最简单的方案，但是缺点也是非常明显的。由于UUID非常的长，除占用大量存储空间外，最主要的问题是在索引上，在建立索引和基于索引进行查询时都存在性能问题。<br>\n2. 结合数据库维护一个Sequence表：此方案的思路也很简单，在数据库中建立一个Sequence表，表的结构类似于：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59711e4198f65671572249\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE `SEQUENCE` (  \r\n    `tablename` varchar(30) NOT NULL,  \r\n    `nextid` bigint(20) NOT NULL,  \r\n    PRIMARY KEY (`tablename`)  \r\n) ENGINE=InnoDB</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59711e4198f65671572249-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59711e4198f65671572249-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59711e4198f65671572249-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59711e4198f65671572249-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59711e4198f65671572249-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59711e4198f65671572249-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">SEQUENCE</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59711e4198f65671572249-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">tablename</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59711e4198f65671572249-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">nextid</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bigint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59711e4198f65671572249-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">tablename</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59711e4198f65671572249-5\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">InnoDB</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>每当需要为某个表的新纪录生成ID时就从Sequence表中取出对应表的nextid,并将nextid的值加1后更新到数据库中以备下次使用。此方案也较简单，但缺点同样明显：由于所有插入任何都需要访问该表，该表很容易成为系统性能瓶颈，同时它也存在单点问题，一旦该表数据库失效，整个应用程序将无法工作。有人提出使用Master-Slave进行主从同步，但这也只能解决单点问题，并不能解决读写比为1:1的访问压力问题。</p>\n<p>除此之外，还有一些方案，像对每个数据库结点分区段划分ID,以及网上的一些ID生成算法，因为缺少可操作性和实践检验，本文并不推荐。实际上，接下来，我们要介绍的是Fickr使用的一种主键生成方案，这个方案是目前我所知道的最优秀的一个方案，并且经受了实践的检验，可以为大多数应用系统所借鉴。</p>\n<p><strong>第二部分：一种极为优秀的主键生成策略</strong></p>\n<p>flickr开发团队在2010年撰文介绍了flickr使用的一种主键生成测策略，同时表示该方案在flickr上的实际运行效果也非常令人满意，原文连接：<a href=\"http://code.flickr.com/blog/2010/02/08/ticket-servers-distributed-unique-primary-keys-on-the-cheap/\" target=\"_blank\">Ticket Servers: Distributed Unique Primary Keys on the Cheap </a>这个方案是我目前知道的最好的方案，它与一般Sequence表方案有些类似，但却很好地解决了性能瓶颈和单点问题，是一种非常可靠而高效的全局主键生成方案。</p>\n<p align=\"center\"><img src=\"http://ww1.sinaimg.cn/large/67a6a651gw1dujgqcx9ncj.jpg\" alt=\"\"></p>\n<p align=\"center\"><strong>图1. flickr采用的sharding主键生成方案示意图</strong>(<a href=\"http://ww1.sinaimg.cn/large/67a6a651gw1dujgqcx9ncj.jpg\" target=\"_blank\">点击查看大图</a>)</p>\n<p>flickr这一方案的整体思想是：建立两台以上的数据库ID生成服务器，每个服务器都有一张记录各表当前ID的Sequence表，但是Sequence中ID增长的步长是服务器的数量，起始值依次错开，这样相当于把ID的生成散列到了每个服务器节点上。例如：如果我们设置两台数据库ID生成服务器，那么就让一台的Sequence表的ID起始值为1,每次增长步长为2,另一台的Sequence表的ID起始值为2,每次增长步长也为2，那么结果就是奇数的ID都将从第一台服务器上生成，偶数的ID都从第二台服务器上生成，这样就将生成ID的压力均匀分散到两台服务器上，同时配合应用程序的控制，当一个服务器失效后，系统能自动切换到另一个服务器上获取ID，从而保证了系统的容错。</p>\n<p>关于这个方案，有几点细节这里再说明一下：</p>\n<p>1. flickr的数据库ID生成服务器是专用服务器，服务器上只有一个数据库，数据库中表都是用于生成Sequence的，这也是因为auto-increment-offset和auto-increment-increment这两个数据库变量是数据库实例级别的变量。<br>\n2. flickr的方案中表格中的stub字段只是一<code>个char(1) NOT NULL存根字段，并非表名，因此，一般来说，一个Sequence表只有一条纪录，可以同时为多张表生成ID，如果需要表的ID是有连续的，需要为该表单独建立<code>Sequence表</code>。</code></p>\n<p>3. 方案使用了<a class=\"replace_word\" title=\"MySQL知识库\" href=\"http://lib.csdn.net/base/14\" target=\"_blank\">MySQL</a>的LAST_INSERT_ID()函数，这也决定了Sequence表只能有一条记录。<br>\n4. 使用REPLACE INTO插入数据，这是很讨巧的作法，主要是希望利用mysql自身的机制生成ID,不仅是因为这样简单，更是因为我们需要ID按照我们设定的方式(初值和步长)来生成。</p>\n<p>5. SELECT LAST_INSERT_ID()必须要于REPLACE INTO语句在同一个数据库连接下才能得到刚刚插入的新ID，否则返回的值总是0<br>\n6. 该方案中Sequence表使用的是<strong>MyISAM</strong>引擎，以获取更高的性能，注意：MyISAM引擎使用的是表级别的锁，<strong>MyISAM对表的读写是串行的</strong>，因此不必担心在并发时两次读取会得到同一个ID(另外，应该程序也不需要同步，每个请求的线程都会得到一个新的connection,不存在需要同步的共享资源)。经过实际对比测试，使用一样的Sequence表进行ID生成，MyISAM引擎要比InnoDB表现高出很多！</p>\n<p>7. 可使用纯JDBC实现对Sequence表的操作，以便获得更高的效率，实验表明，即使只使用<a class=\"replace_word\" title=\"Java EE知识库\" href=\"http://lib.csdn.net/base/17\" target=\"_blank\">spring</a> JDBC性能也不及纯JDBC来得快！</p>\n<p>实现该方案，应用程序同样需要做一些处理，主要是两方面的工作：<br>\n1. 自动均衡数据库ID生成服务器的访问<br>\n2. 确保在某个数据库ID生成服务器失效的情况下，能将请求转发到其他服务器上执行。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111866\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111866votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111866\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-07-16", "vote": " ", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg", "title": "DB 分库分表（2）：全局主键生成策略", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"]},
{"comment_nums": 1, "url_object_id": "a5b15948fdca33a7e5a22f9c857c1ff3", "url": "http://blog.jobbole.com/111850/", "tags": ["IT技术", " 1 评论 ", "Linux"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/zhenbianshu/p/7152327.html\">枕边书</a>   </div><h3 id=\"toc_0\">前言</h3>\n<p>常在 linux 下玩耍的开发者肯定会经常遇到需要对进程调度的情况，在 windows 中点击 <code>最小化</code> 去干别的就 OK 了，那么在 linux 下怎么办呢。</p>\n<p>可能有的小伙伴会说，再开一个终端窗口不就好了么。可是开很多窗口管理会很不方便，还有万一手贱点了x，或者长时间不操作，远程终端断开了连接，进程停止了，再次打开，又是一番折腾。</p>\n<p>今天来介绍几个命令，帮大家系统地梳理一下 linux 的进程调度，并附上一些自己的使用心得和踩过的坑。</p>\n<h3 id=\"toc_1\">名词</h3>\n<p>在此之前，我们必须（当然也不是必须，但了解原理有利于理解和解决错误）先弄懂几个名词。</p>\n<h4 id=\"toc_2\">进程组</h4>\n<p>进程组是一个或多个进程的集合，进程组方便了对多个进程的控制，在进程数较多的情况下，向进程组发送信号就行了。</p>\n<p>它的 ID 由它的组长进程的进程 ID 决定。组长进程创建了进程组，但它并不能决定进程组的存活时间，只要进程组内还有一个进程存在，进程就存在，与组长进程是否已终止无关。</p>\n<h4 id=\"toc_3\">会话</h4>\n<p>会话(session)是一个或多个进程组的集合，它开始于用户登陆终端，结束于用户退出登陆。其义如其名，就是指用户与系统的一次对话的全程。</p>\n<p>会话包括控制进程（与终端建立连接的领头进程），一个前台进程组和任意后台进程组。一个会话只能有一个控制终端，通常是登录到其上的终端设备或伪终端设备，产生在控制终端上的输入和信号将发送给会话的前台进程组中的所有进程。</p>\n<h4 id=\"toc_4\">控制终端</h4>\n<p>每当我们使用终端工具打开一个本地或远程 shell，我们便打开了一个控制终端，通过 <code>ps</code> 命令可以查看到 command 为 <code>ttyn</code> 的就是它对应的进程了，同时它对应 linux <code>/dev/</code> 目录下的一个文件。</p>\n<h4 id=\"toc_5\">作业</h4>\n<p>作业的概念与进程组类似，同样由一个或多个进程组成，它分为前台作业和后台作业，一个会话会有一个前台作业和多个后台作业，与进程组不同的是，作业内的某个进程产生的子进程并不属于这个作业。</p>\n<h4 id=\"toc_6\">类比</h4>\n<p>以上几个概念可以类比为我们一次通过 QQ 聊天的全程，控制终端就是 QQ软件，关闭了此软件代表着聊天结束。聊天时发送的每一条信息都是一个进程，作业或进程组就是我们在聊的某一件事，它由很多条相互的信息构成。而会话则是我们指我们从开始聊天到结束聊天的全过程，可能会聊很多个事。</p>\n<p>它们之间的相关图如下所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/799c79770f8239cea9ebad6ddab63472.png\" alt=\"\"></p>\n<h3 id=\"toc_7\">后台执行</h3>\n<p>我们每次在终端窗口执行命令的时候，进程总会一直占用着终端，走到进程结束，这段时间内，我们在终端的输入是没有用的。而且，当终端窗口关闭或网络连接失败后，再次打开终端，会发现进程已经中断了。这是因为用户注销或者网络断开时，<code>SIGHUP</code>信号会被发送到会话所属的子进程，而此 <code>SIGHUP</code> 的默认处理方式是终止收到该信号的进程。所以若程序中没有捕捉该信号，当终端关闭后，会话所属进程就会退出。</p>\n<p>我们要实现后台执行的目的，实际上是要完成如下两个目标：</p>\n<ul>\n<li>使进程让出前台终端，让我们可以继续通过终端与系统进行交互。</li>\n<li>使进程不再受终端关闭的影响，即系统在终端关闭后不再向进程发送 <code>SIGHUP</code> 信号或即使发送了信号程序也不会退出。</li>\n</ul>\n<p>以下的命令就围绕着这两个目标来实现。</p>\n<h4 id=\"toc_8\">&amp;</h4>\n<p>首先是我们最经常遇到的符号 <code>&amp;</code>，将它附在命令后面可以使进程在后台执行，不会占用前台界面。它实际上是在会话中开启了一个后台作业，对作业的操作我们后面再说。</p>\n<p>但我们会发现，如果此时终端被关闭后，进程还是会退出。这是因为，<code>&amp;</code> 符号只有让进程让出前台终端的功能，无法让进程不受 <code>SIGHUP</code> 信号的影响。</p>\n<h4 id=\"toc_9\">nohup</h4>\n<p><code>nohup</code> 应该是另外一个我们常用的命令了，它的作用如其字面意思，使进程不受 <code>SIGHUP</code> 信号的影响。但我们在使用 <code>nohup php test.php</code> 后会发现，进程还会一直占用前台终端，但即使终端被关闭或连接断开了，程序还是会执行，另外我们会发现在当前文件夹下多了个名为 <code>nohup.out</code> 的文件。</p>\n<p>这是因为 nohup 的功能仅仅是让进程不受 <code>SIGHUP</code> 信号的影响，并不会让出前台终端，而且它还会在命令执行目录下建立 <code>nohup.out</code> 用以存储进程的输出。如果进程不需要输出，且不想让 nohup 创建文件，可以将标准输出和标准错误输出重定向。</p>\n<p>我们常将 <code>nohup</code> 和 <code>&amp;</code> 搭配到一块使用，执行命令如下 <code>nohup command &gt;/dev/null 2&gt;&amp;1 &amp;</code> 这样，就可以放心的等待进程运行结果了。</p>\n<h4 id=\"toc_10\">setsid</h4>\n<p>setsid 是另一个让进程在后台执行的命令，它的作用是让进程打开一个新的会话并运行进程，使用方式为 <code>setsid command</code>。</p>\n<p>根据上面的概念我们得知终端关闭后进程退出是因为会话首进程向进程发送了 <code>SIGHUP</code> 信号，setsid 就厉害了，它直接打开一个新的会话来执行命令，那么原会话的终端的状态就再也不会影响到此进程了。</p>\n<p>我们使用 <code>pstree</code> 来查看使用 <code>setsid</code> 和 <code>nohup ... &amp;</code> 两种命令来运行进程时的进程树状态。</p>\n<ul>\n<li><code>nohup php test.php &amp;</code></li>\n</ul>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712a61043ca017593478\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npstree -a |grep -C 6 test\r\n  |-sshd\r\n  |   `-sshd\r\n  |       `-sshd\r\n  |           `-bash\r\n  |               `-sudo -s\r\n  |                   `-bash\r\n  |                       |-grep -C 6 test\r\n  |                       |-php test.php\r\n  |                       `-pstree -a</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712a61043ca017593478-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043ca017593478-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043ca017593478-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043ca017593478-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043ca017593478-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043ca017593478-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043ca017593478-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043ca017593478-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043ca017593478-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043ca017593478-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712a61043ca017593478-1\"><span class=\"crayon-v\">pstree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043ca017593478-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sshd</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043ca017593478-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sshd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043ca017593478-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">       </span><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sshd</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043ca017593478-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">           </span><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043ca017593478-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">               </span><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">s</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043ca017593478-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                   </span><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043ca017593478-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                       </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043ca017593478-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                       </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">php </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043ca017593478-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                       </span><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pstree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n\n</div>\n<p>我是用 ssh 远程登陆的机器，所以 test.php 进程是挂在 sshd 进程下的。正常情况下，一旦 sshd 进程结束，则 test.php也无法幸免。</p>\n<ul>\n<li><code>setsid php test.php</code></li>\n</ul>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712a61043e3188359356\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npstree -a |grep -C 6 test \r\n  |-{nscd}\r\n  |-php test.php\r\n  |-php-fpm\r\n --\r\n  |-sshd\r\n  |   `-sshd</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712a61043e3188359356-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043e3188359356-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043e3188359356-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043e3188359356-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043e3188359356-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043e3188359356-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043e3188359356-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712a61043e3188359356-1\"><span class=\"crayon-v\">pstree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043e3188359356-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">nscd</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043e3188359356-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">php </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043e3188359356-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">php</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fpm</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043e3188359356-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043e3188359356-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sshd</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043e3188359356-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">`</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sshd</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p>使用了 setsid 后，test.php 进程已经与 sshd 进程同级，属于 init 进程的子进程了。</p>\n<p>但是 setsid 并没有为进程分配一个输出终端，所以进程还是会输出到当前终端上。</p>\n<h5 id=\"toc_11\">setsid的坑</h5>\n<p>另外，setsid 有个略坑的地方： 在终端中直接使用 <code>setsid command</code> 运行进程时，终端前台并不会被影响，command 会在后台默默运行。而在 shell 脚本中，我们会发现运行 setsid 的进程会一直阻塞住，直到 command 进程执行结束。</p>\n<p>这是因为，setsid 在其是进程组长时会 <code>fork()</code> 一个进程，但它不会 <code>wait()</code> 它的子进程，而是立刻退出，所以在终端内直接使用 setsid 时，setsid 作为进程组长不会占用终端界面。</p>\n<p>而在 shell 脚本内，setsid 不是进程组长，它不会 <code>fork()</code> 子进程，而是由 bash 来<code>fork()</code> 一个子进程，而 bash 会 <code>wait()</code> 子进程，所以表现得像 setsid 在 <code>wait()</code> 子进程一样。</p>\n<p>要解决这个问题，有两个办法：</p>\n<ul>\n<li>使用上面介绍的 <code>&amp;</code>符号，使 setsid 强行到后台执行。</li>\n<li>使用 <code>.</code> 或 <code>source</code> 命令由终端执行 setsid；</li>\n</ul>\n<h4 id=\"toc_12\">其他</h4>\n<p>除了上面介绍的命令，还有 screen 和 tmux 等会话工具，他们都有自己的一套规范，也比较复杂，掌握本文的命令已经足够你驰骋 linux 进程控制了。当然有想了解新知识的可以查询学习一下，应该会比基础命令好用。</p>\n<h3 id=\"toc_13\">作业命令</h3>\n<p>使用上面的后台执行命令时可能还会遇到一些小状况：</p>\n<ul>\n<li>被我们放在后台的进程执行时间过长，而我们又忘记使用 nohup 命令，那么终端一旦断开，进程又需要被重新执行。</li>\n<li>我们直接开启了某个进程，又想在不中断进程的情况下让它让出前台终端；</li>\n</ul>\n<p>这些都要牵涉到今天的第二个模块–作业；</p>\n<p>我们在终端里运行的命令都可以理解为一个作业，有的占用前台终端，有的在后台默默执行，下面的命令就是为了调度这些作业。</p>\n<h4 id=\"toc_14\">jobs</h4>\n<p>jobs 是作业的基础命令，用它可以查看正在运行的作业的信息，其输出如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712a61043ea762508729\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\njobs\r\n[1]-  Running                 php test.php &amp;\r\n[2]+  Stopped                 php test.php</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712a61043ea762508729-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043ea762508729-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043ea762508729-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712a61043ea762508729-1\"><span class=\"crayon-i\">jobs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043ea762508729-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">Running                 </span><span class=\"crayon-e\">php </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043ea762508729-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">Stopped                 </span><span class=\"crayon-e\">php </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>前面<code>[ ]</code>内的数字是作业 ID，也是后面我们要操作作业的标识，然后是作业状态和命令。</p>\n<h4 id=\"toc_15\">ctrl+z</h4>\n<p><code>ctrl+z</code> 严格来说并是作业命令，它只是向当前进程发送一个 <code>SIGSTOP</code> 信号，促使进程进入暂停(stopped)状态，此状态下，进程状态会被系统保存，此进程会被放置到作业队列中去，而让出进程终端。</p>\n<p>使用它，我们可以暂停正在占用终端的进程而不停止它，从而让我们使用终端命令来操作此进程。</p>\n<h4 id=\"toc_16\">bg</h4>\n<p>bg是 <code>backgroud</code> 的缩写，顾名思义，<code>bg %id</code> 把作业放到后台进程中执行。</p>\n<p>结合 <code>ctrl+z</code> 和 <code>bg</code> 命令，我们可以解决上面提出的第一个问题，不停止地将正在占用终端的进程放到后台执行。</p>\n<h4 id=\"toc_17\">fg</h4>\n<p>fg 与 bg 相对，使用它可以把作业放到前台来执行。</p>\n<h4 id=\"toc_18\">disown</h4>\n<p>disown 用来将作业从作业列表中移除，即使它 <code>不属于</code> 会话，这样终端关闭后不再向此作业发送 <code>SIGHUP</code> 信号，以阻止终端对进程的影响。</p>\n<p>使用 disown 我们可以解决上面提出的第二个问题，不重新执行将一个没使用 nohup 命令的进程不受终端关闭影响。</p>\n<h3 id=\"toc_19\">守护进程</h3>\n<p>以上介绍的都是一些临时进程的处理，后台运行的进程的最终方法是将进程变成守护进程。</p>\n<h4 id=\"toc_20\">守护进程</h4>\n<blockquote><p>守护进程(daemon)是生存期较长的一种进程，一般在系统启动时启动，系统关闭时停止，没有控制终端，也不会输出。如我们的服务器、fpm 等进程就是以守护进程的形式存在的。</p></blockquote>\n<h4 id=\"toc_21\">创建过程</h4>\n<p>要创建一个守护进程，步骤为：</p>\n<p>必选项</p>\n<ol>\n<li><code>fork</code> 子进程，退出父进程，子进程作为孤儿进程被 init 进程收养；</li>\n<li>使用 <code>setsid</code>, 打开新会话，进程成为会话组长，正式脱离终端控制；</li>\n<li>设置信号处理（特别是子进程退出处理）；可选项：</li>\n<li>使用 <code>chdir</code> 改变进程工作目录，一般到根目录下，防止占用可卸载文件系统；</li>\n<li>用 <code>umask</code> 重设文件权限掩码，不再继承父进程的文件权限设置；</li>\n<li>关闭父进程打开的文件描述符；</li>\n</ol>\n<h4 id=\"toc_22\">代码</h4>\n<p>以下是 php 创建守护进程的伪代码，另外我的另一篇博客 <a href=\"http://www.cnblogs.com/zhenbianshu/p/5676822.html\">初探PHP多进程</a> 也稍微介绍了一些相关内容：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712a61043f0322876579\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$pid = pcntl_fork();\r\nif ($pid &gt; 0) {\r\n    exit; // 父进程直接退出\r\n} elseif ($pid &lt; 0) {\r\n throw_error(); // 进程创建失败\r\n}\r\n\r\nposix_setsid(); // setsid成为会话领导进程\r\nchdir($dir); // 切换目录\r\numask(0); // 重置文件权限mask\r\nclose_fd(); // 关闭父进程的文件描述符\r\npcntl_signal($signal, $func); // 注册信号处理函数\r\n\r\nwhile (true) {\r\n do_job(); // 处理进程任务\r\n pcntl_signal_dispatch(); // 分发信号处理\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712a61043f0322876579-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043f0322876579-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043f0322876579-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043f0322876579-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043f0322876579-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043f0322876579-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043f0322876579-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043f0322876579-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043f0322876579-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043f0322876579-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043f0322876579-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043f0322876579-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043f0322876579-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043f0322876579-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043f0322876579-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712a61043f0322876579-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59712a61043f0322876579-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712a61043f0322876579-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pcntl_fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043f0322876579-2\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043f0322876579-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">exit</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 父进程直接退出</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043f0322876579-4\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">elseif</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043f0322876579-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throw_error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 进程创建失败</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043f0322876579-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043f0322876579-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043f0322876579-8\"><span class=\"crayon-e\">posix_setsid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// setsid成为会话领导进程</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043f0322876579-9\"><span class=\"crayon-e\">chdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dir</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 切换目录</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043f0322876579-10\"><span class=\"crayon-e\">umask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 重置文件权限mask</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043f0322876579-11\"><span class=\"crayon-e\">close_fd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 关闭父进程的文件描述符</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043f0322876579-12\"><span class=\"crayon-e\">pcntl_signal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">signal</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 注册信号处理函数</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043f0322876579-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043f0322876579-14\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043f0322876579-15\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">do_job</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 处理进程任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712a61043f0322876579-16\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pcntl_signal_dispatch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 分发信号处理</span></div><div class=\"crayon-line\" id=\"crayon-59712a61043f0322876579-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n\n</div>\n<h3 id=\"toc_23\">总结</h3>\n<p>linux 是开发者的基础技能，而进程的调度更是我们常用的功能，希望读完本文的同学们能有所收获。</p>\n<p>又有大半个月没发博客了，最近鼓捣着重构代码，经常会在一个点上纠结半天，不知不觉就加了个班。而且这个是个没法精确度量工作量和目标的活儿，优化没有尽头嘛。不过由于要更多地考虑一下代码的抽象、效率和扩展，对自己也是个挑战，算是乐在其中吧~</p>\n<p>最近可能会考虑写一个守护进程和 cron 进程调度器，嗯，希望给我算到工作量里，哈哈~想写的太多了，只怨自己还不够强大。。。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111850\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111850votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111850\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-07-14", "vote": " ", "front_image_path": "full/d3d1a5ad957de059084690efae6fdfaa3527e1c3.jpg", "title": "Linux - 请允许我静静地后台运行", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"]},
{"comment_nums": 0, "url_object_id": "b299e9cd2dda0c69c7c1c010f60074f4", "url": "http://blog.jobbole.com/111860/", "tags": ["IT技术", "分库分表", "数据库"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/bluishglc/article/details/7696085\">Laurence的技术博客</a>   </div><p><strong>第一部分：实施策略</strong></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4d96fb1fcbf89962346119fdae9e9584.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><strong>图1.数据库分库分表(sharding)实施策略图解(<a href=\"http://ww1.sinaimg.cn/large/67a6a651gw1ducq4lmzyzj.jpg\">点击查看大图</a>)</strong></p>\n<p><strong>1.准备阶段</strong></p>\n<p>对数据库进行分库分表(Sharding化)前，需要开发人员充分了解系统业务逻辑和数据库schema.一个好的建议是绘制一张数据库ER图或领域模型图，以这类图为基础划分shard,直观易行，可以确保开发人员始终保持清醒思路。对于是选择数据库ER图还是领域模型图要根据项目自身情况进行选择。如果项目使用数据驱动的开发方式，团队以数据库ER图作为业务交流的基础，则自然会选择数据库ER图，如果项目使用的是领域驱动的开发方式，并通过OR-Mapping构建了一个良好的领域模型，那么领域模型图无疑是最好的选择。就我个人来说，更加倾向使用领域模型图，因为进行切分时更多的是以业务为依据进行分析判断，领域模型无疑更加清晰和直观。</p>\n<p><strong>2.分析阶段</strong></p>\n<p>1. 垂直切分<br>\n垂直切分的依据原则是：将业务紧密，表间关联密切的表划分在一起，例如同一模块的表。结合已经准备好的数据库ER图或领域模型图，仿照活动图中的泳道概念，一个泳道代表一个shard，把所有表格划分到不同的泳道中。下面的分析示例会展示这种做法。当然，你也可以在打印出的ER图或模型图上直接用铅笔圈，一切取决于你自己的喜好。</p>\n<p><strong>2. 水平切分</strong><br>\n垂直切分后，需要对shard内表格的数据量和增速进一步分析，以确定是否需要进行水平切分。</p>\n<p><strong>2.1</strong>若划分到一起的表格数据增长缓慢，在产品上线后可遇见的足够长的时期内均可以由单一数据库承载，则不需要进行水平切分，所有表格驻留同一shard,所有表间关联关系会得到最大限度的保留，同时保证了书写SQL的自由度，不易受join、group by、order by等子句限制。</p>\n<p><strong>2.2</strong> 若划分到一起的表格数据量巨大，增速迅猛，需要进一步进行水平分割。进一步的水平分割就这样进行：</p>\n<p><strong>2.2.1</strong>.结合业务逻辑和表间关系，将当前shard划分成多个更小的shard,通常情况下，这些更小的shard每一个都只包含一个主表（将以该表ID进行散列的表）和多个与其关联或间接关联的次表。这种一个shard一张主表多张次表的状况是水平切分的必然结果。这样切分下来，shard数量就会迅速增多。如果每一个shard代表一个独立的数据库，那么管理和维护数据库将会非常麻烦，而且这些小shard往往只有两三张表，为此而建立一个新库，利用率并不高，因此，在水平切分完成后可再进行一次“反向的Merge”,即：将业务上相近，并且具有相近数据增长速率（主表数据量在同一数量级上）的两个或多个shard放到同一个数据库上，在逻辑上它们依然是独立的shard，有各自的主表，并依据各自主表的ID进行散列，不同的只是它们的散列取模（即节点数量）必需是一致的。这样，每个数据库结点上的表格数量就相对平均了。</p>\n<p><strong>2.2.2. </strong>所有表格均划分到合适的shard之后，所有跨越shard的表间关联都必须打断，在书写sql时，跨shard的join、group by、order by都将被禁止，需要在应用程序层面协调解决这些问题。</p>\n<p>特别想提一点：经水平切分后，shard的粒度往往要比只做垂直切割的粒度要小，原单一垂直shard会被细分为一到多个以一个主表为中心关联或间接关联多个次表的shard，此时的shard粒度与领域驱动设计中的“聚合”概念不谋而合，甚至可以说是完全一致，每个shard的主表正是一个聚合中的聚合根！</p>\n<p><strong>3.实施阶段</strong><br>\n如果项目在开发伊始就决定进行分库分表，则严格按照分析设计方案推进即可。如果是在中期架构演进中实施，除搭建实现sharding逻辑的基础设施外(关于该话题会在下篇文章中进行阐述)，还需要对原有SQL逐一过滤分析，修改那些因为sharding而受到影响的sql.</p>\n<p><strong>第二部分：示例演示</strong></p>\n<p>本文选择一个人尽皆知的应用：jpetstore来演示如何进行分库分表(sharding)在分析阶段的工作。由于一些个人原因，演示使用的jpetstore来自原ibatis官方的一个Demo版本，SVN地址为：http://mybatis.googlecode.com/svn/tags/java_release_2.3.4-726/jpetstore-5。关于jpetstore的业务逻辑这里不再介绍，这是一个非常简单的电商系统原型，其领域模型如下图：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/bc2711a69bd224bbf973fa03cbf4e5a9.jpg\" alt=\"\" width=\"888\" height=\"371\"></p>\n<p style=\"text-align: center\"><strong>图2. jpetstore领域模型</strong></p>\n<p>由于系统较简单，我们很容易从模型上看出，其主要由三个模块组成：用户，产品和订单。那么垂直切分的方案也就出来了。接下来看水平切分，如果我们从一个实际的宠物店出发考虑，可能出现数据激增的单表应该是Account和Order,因此这两张表需要进行水平切分。对于Product模块来说，如果是一个实际的系统，Product和Item的数量都不会很大，因此只做垂直切分就足够了，也就是（Product，Category，Item，Iventory，Supplier）五张表在一个数据库结点上（没有水平切分，不会存在两个以上的数据库结点）。<strong>但是作为一个演示，我们假设产品模块也有大量的数据需要我们做水平切分</strong>，那么分析来看，这个模块要拆分出两个shard:一个是（Product（主），Category），另一个是（Item（主），Iventory，Supplier），<strong>同时，我们认为：这两个shard在数据增速上应该是相近的，且在业务上也很紧密</strong>，那么我们可以<strong>把这两个shard放在同一个数据库节点上，Item和Product数据在散列时取一样的模</strong>。根据前文介绍的图纸绘制方法，我们得到下面这张sharding示意图：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/883e27937895e73700b2f78bb4106a31.jpg\" alt=\"\" width=\"867\" height=\"365\"></p>\n<p style=\"text-align: center\"><strong>图3. jpetstore sharding示意图</strong></p>\n<p>对于这张图再说明几点：<br>\n<strong>1.使用泳道表示物理shard（一个数据库结点）</strong></p>\n<p><strong>2.若<strong>垂直切分出的shard进行了进一步的水平切分，但公用一个物理shard的话，则用虚线框住，表示其在逻辑上是一个独立的shard。</strong><br>\n</strong></p>\n<p><strong>3.深色实体表示主表</strong></p>\n<p><strong>4.X表示需要打断的表间关联</strong></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111860\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111860votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111860\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-07-15", "vote": " ", "front_image_path": "full/f42d1238aa0f889b8988c70dd7481c7a4bd3b456.jpg", "title": "DB 分库分表（1）：拆分实施策略和示例演示", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/03/database-logo.png"]},
{"comment_nums": 1, "url_object_id": "6d15dbaaf727b966d37bd068bb39aa2a", "url": "http://blog.jobbole.com/111484/", "tags": ["IT技术", " 1 评论 ", "团队", "管理", "职场"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/liulun/p/7159705.html\">liulun</a>   </div><p>我们公司和大部分传统软件公司一样，随着业务的发展和新领域的开拓，公司的管理风格越来越像华为，这是不是最佳的演进路线，我觉得值得探讨，以下是我的思考，希望跟大家讨论。</p>\n<h2>一个问题</h2>\n<p>前段时间跟一个创业的朋友聊天，说起他们最近在做的一个项目，这是一个教育行业的管理系统，业务非常复杂，牵涉到的决策人，需要对接的系统也非常多，最后问到他们做了多久完成这个项目，朋友告诉我2个多月，6个人，其中还括一个美工，一个项目经理；剩下的都是开发人员，没有测试，没有前端开发；朋友问我，如果这个项目给你们做，你们需要做多久；我想了想说，这个项目如果交给我们做，顺利的话，至少要半年。</p>\n<p><strong>为什么差异这么大呢？</strong></p>\n<p>我们一个一个环节来分析一下，朋友的团队跟客户沟通需求的时候，功能性需求只用一个原型草图，非功能性需求就一个excel表格；如果我们公司做的话，至少要做需求调研报告，需求规格说明书；这个阶段的负责人甚至不会画原型，要到设计阶段才有人能画原型；</p>\n<p>到设计阶段，朋友的团队几乎没有什么技术设计，业务按模块给开发人员分一下，各人设计好自己的数据库模型，汇总起来给项目经理看一下，没问题就进入开发阶段了，界面设计花的时间比较久，跟客户反复确认了两三次；如果我们公司做的话，至少要产出原型设计（低保真描述功能的设计稿，高保真描述界面的设计稿），概要设计，详细设计（技术设计、架构设计、网络设计）等等，而且几乎每个设计都要经历评审环节，组织评审就要协调人员，要等大家都有时间的时候再做评审，这都是损耗；</p>\n<p>到开发测试阶段，朋友的团队几个开发人员从前端到后端，从开发到测试，都是这几个人做；如果我们公司来做的话，后台开发人员不做前端（不做复杂的前端页面，普通的前端工作还是要做的），质量保证要测试人员保证，测试把BUG提交到BUG管理工具，开发再去BUG管理工具查阅属于自己的BUG，修改完成之后，再关闭BUG，测试再做回归测试；这些流程看起来琐碎，但却损耗了大量的资源；</p>\n<p>验收上线阶段，朋友的团队所有人都铺在项目现场，有问题，当场解决；我们公司要收集问题，让测试工程师验证问题，再由开发解决，解决之后再验证，再发布版本给现场的实施工程师，实施工程师再更新上线，给客户验证。</p>\n<p>这个问题很明显：规模大的团队和规模小的团队工作方式的差异非常大，组织资源的方式也有明显的区别；我们抽象一下，把这两种模式称为：大军团模式和小编队模式，再看这两种模式的具体区别：</p>\n<h2>大军团模式</h2>\n<p>之前有一种理论，要完成一项超大规模的工程，往往需要成百上千人，有组织有纪律的协作才能完成；</p>\n<p>这样就需要制定一系列的规章、制度、流程、KPI来约束这些人，</p>\n<p>把这些人变成一个庞大机器的零部件，保证结果的达成，避免产生差错；</p>\n<p>这是一种非常常见的大组织的运作模式，</p>\n<p>不但在软件行业普遍存在（华为、惠普、IBM），</p>\n<p>在造桥、修路、航天、汽车等工业领域也十分常见，</p>\n<p>这种模式非常“稳”，他能保证目标的稳定达成，并且能使目标达成的过程清晰、可控。</p>\n<h2>小编队模式</h2>\n<p>第三次工业革命（信息技术革命）以来，小编队的运作模式发展越来越好，我司IPCC产品的核心：开源语音通信软件FreeSwitch，核心开发者也不过6个人；（说这个开源软件养活了半个呼叫中心行业的开发者都不足为过）； 这种例子在软件行业不胜枚举，比如：git源码管理系统、linux操作系统、JavaScript语言等等。</p>\n<p>甚至有些产品是一个人在短时间内完成的，这就是英雄；</p>\n<p>有很多大规模的公司，比如谷歌、Facebook、国内的百度也在内部推行小编队的运作模式；</p>\n<p>这种模式非常“快”，他能保证目标的快速达成，并且能使目标达成的效率非常高；</p>\n<h2>大军团的不足</h2>\n<h3>效率低下</h3>\n<p>大军团强调集体的智慧，</p>\n<p>个体想推动一项事务向正确的方向推进十分困难，</p>\n<p>个体的决策往往会受到质疑或排斥</p>\n<p>诸如：流程、规范、计划、考核、文档、评审、调研等词</p>\n<p>都是为了保证目标的稳定达成所衍生出来的东西，</p>\n<p>它们都是团队快速前进的束缚和绊脚石！</p>\n<h3>阻碍创新</h3>\n<p>大军团鼓励墨守成规、照章办事的氛围，</p>\n<p>大军团强调分工，把员工看作螺丝钉，希望员工各司其职，不是职责范围内的事务尽量不要碰，因为你不专业，你可能会出错，大军团最害怕出错；</p>\n<p>只有这样才能使目标达成的过程清晰可控；</p>\n<p>然而创新却需要不拘一格的思想，需要独立自主的工作空间，需要组织具备容错性，这和大军团的工作方式是格格不入的；</p>\n<h3>资源浪费</h3>\n<p>为了使目标的达成过程清晰可控；</p>\n<p>大军团制定了很多流程和制度来约束个体的行为；</p>\n<p>他把每一项事务都拆分成很多环节；</p>\n<p>又给每个环节制定了很多关卡；</p>\n<p>而且每个环节都要留下数据，使过程有迹可寻；</p>\n<p>因为大军团要做到每项事务都可以复盘，产生问题之后要可以追溯问题根源；</p>\n<p>这样确实保证了目标达成过程的清晰可控，但却浪费了大量的资源；</p>\n<h2>小编队的优势</h2>\n<h3>小编队也适合做大项目</h3>\n<p>有很多很庞大复杂的软件系统，都是以小编队的方式完成的；</p>\n<p>比如操作系统linux，大数据分析系统hadoop，我们这个行业的freeSwitch等；</p>\n<p>如果一个项目大到一定的规模，需要不同角色的人参与，那么也应该是有更多的小编队来做这一块事情；甚至更极端的做法，就是一个项目在建设之初，就考虑到会有很多小编队或个人参与到项目建设过程中，预留了多人、多团队协作的支撑工具，比如说nodejs的NPM，go语言和rust语言也有相应的规划；</p>\n<h3>小编队有很强的执行力</h3>\n<p>小编队不会说这个事情需要做个评审；</p>\n<p>小编队不会说这个事情安排的资源不够，需要协调更多的资源；</p>\n<p>小编队会把这个事情当成自己的事情，不会像大军团一样，把这个事情当成大家的事情来对待；</p>\n<p>我们来看个图：</p>\n<p>（图片遗失，暂不补充）</p>\n<h3>小编队有很强的创新力</h3>\n<p>软件行业不像建筑行业，90%以上的优秀软件一开始都是个人或者小编队创造出来的；很少见一个优秀软件是一个大规模的组织创造出来的。</p>\n<h2>一个案例</h2>\n<p>张小龙曾经说过一段话：</p>\n<p>好的工具就不应该黏人，应该帮助用户非常高效率完成任务，而不是说用完了还要拿到手里玩一会儿、多用一会儿，那不是一个很高效的表现。但是对这样的一些想法的话，我特别希望它能够根植到大家意识里，时刻想一下什么是我们做的对用户有价值的事情；</p>\n<p>假设你是马化腾，你会怎么给张小龙定KPI呢？考核微信的日活吗？……</p>\n<p>无论你制定什么KPI，都会导致团队去围绕着那个KPI去完成任务；</p>\n<p>KPI考核准则里有一项原则就是“可度量”，当你提出一项纯数据目标的时候，团队就会围绕着那个数字去工作。而偏离了做好产品的初心。</p>\n<p>一个团队工作的目的不应该是完成KPI，工作的目的应该是做好产品，完成KPI只不过是做好产品这件事情的副产物，就像一个人好好工作的目的不应该是为了赚钱，他好好工作的副产物是赚了很多钱；</p>\n<p>所以你制定了一系列的kpi考核制度，只能导致员工工作的动机更不纯粹。</p>\n<h2>最后</h2>\n<p>一个组织只要发展良好，总是会吸引更多的资源，所以组织规模的扩大是无可避免的，但如果一个组织规模已经超过500人了，那么你应该把他看作是50~100个小团队来对待，而不是把他当作一个500人的大团队来对待；</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111484\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111484votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111484\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-07-17", "vote": " ", "front_image_path": "full/ff4572cdd38455986d3d6be616ebc49296dd76d8.jpg", "title": "小团队管理与大团队管理", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/01/7062164f8b12cab9bb7cfd7920176dc7.jpg"]},
{"comment_nums": 0, "url_object_id": "cc276802ec74b5c8ad50fe746800ea7f", "url": "http://blog.jobbole.com/111797/", "tags": ["IT技术", "设计模式"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/justin_ygg\">Justin_YGG</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://github.com/kamranahmedse/design-patterns-for-humans/blob/master/README.md#behavioral-design-patterns\">kamranahmedse</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>用最简单的语言，解释设计模式。</p>\n<p>虽然示例代码是用 PHP7 实现的，但因为概念是一样的，所以语言并不会阻碍大家理解设计模式。</p>\n<ul>\n<li>《<a href=\"http://blog.jobbole.com/111799/\" target=\"_blank\">人人都能读懂的设计模式（1）：创建型模式</a>》</li>\n<li>《<a href=\"http://blog.jobbole.com/111798/\" target=\"_blank\">人人都能读懂的设计模式（2）：结构型模式</a>》</li>\n</ul>\n<h3>概述</h3>\n<p>行为型设计模式关心对象之间的责任分配。与结构型设计模式不同的是，行为型设计模式不仅仅指定结构，而且还概述了它们之间的消息传递/通信的模式。或者换句话说，行为型模式帮助回答了“软件组件是如何运行的？”</p>\n<h3>维基百科</h3>\n<p>在软件工程中，行为型设计模式为设计模式的一种类型，用来识别对象之间的常用交流模式并加以实现。如此，可以在交流时增强灵活性。</p>\n<p><strong>分类</strong></p>\n<ul>\n<li>责任链模式</li>\n<li>命令模式</li>\n<li>迭代器模式</li>\n<li>中介者模式</li>\n<li>备忘录模式</li>\n<li>观察者模式</li>\n<li>访问者模式</li>\n<li>策略模式</li>\n<li>状态模式</li>\n<li>模板方法模式</li>\n</ul>\n<h3>🔗 责任链模式</h3>\n<h4>现实生活示例</h4>\n<p>例如，你的帐户中有三种付款方式（A，B 和 C）; 每种方式付款额不同。 A 可支付 100 美元，B 可支付 300 美元，C 可支付 1000 美元，支付的优先级为 A-&gt;B-&gt;C。现在想要购买价值 210 美元的东西。使用责任链模式，首先将检查帐户 A 是否可以进行购买，如果可以购买，链条将被破坏。如果不能购买，将继续检查账号 B 是否可以购买，如果可以购买，链条将被破坏，否则请求将继续转发，直到找到合适的处理程序。这里的 A、B 和 C 就是责任链的链条，整个现象就是责任链模式。</p>\n<h4>概述</h4>\n<p>责任链模式有助于建立一个对象链。请求从一端进入，在对象之间转发，直到找到合适的处理程序。</p>\n<h4>维基百科</h4>\n<p>责任链模式是面向对象程序设计的一种软件设计模式，它包含了一些命令对象和一系列的处理对象。每一个处理对象决定它能处理哪些命令对象，不能处理的命令对象传递给该链中的下一个处理对象。</p>\n<p><strong>程序示例</strong></p>\n<p>以上面的支付账号为例，首先给出账户基类，包含链接账号的逻辑以及一些不同类型的账户</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59716661672df954445926\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nabstract class Account\r\n{\r\n    protected $successor;\r\n    protected $balance;\r\n\r\n    public function setNext(Account $account)\r\n    {\r\n        $this-&gt;successor = $account;\r\n    }\r\n\r\n    public function pay(float $amountToPay)\r\n    {\r\n        if ($this-&gt;canPay($amountToPay)) {\r\n            echo sprintf('Paid %s using %s' . PHP_EOL, $amountToPay, get_called_class());\r\n        } elseif ($this-&gt;successor) {\r\n            echo sprintf('Cannot pay using %s. Proceeding ..' . PHP_EOL, get_called_class());\r\n            $this-&gt;successor-&gt;pay($amountToPay);\r\n        } else {\r\n            throw new Exception('None of the accounts have enough balance');\r\n        }\r\n    }\r\n\r\n    public function canPay($amount): bool\r\n    {\r\n        return $this-&gt;balance &gt;= $amount;\r\n    }\r\n}\r\n\r\nclass Bank extends Account\r\n{\r\n    protected $balance;\r\n\r\n    public function __construct(float $balance)\r\n    {\r\n        $this-&gt;balance = $balance;\r\n    }\r\n}\r\n\r\nclass Paypal extends Account\r\n{\r\n    protected $balance;\r\n\r\n    public function __construct(float $balance)\r\n    {\r\n        $this-&gt;balance = $balance;\r\n    }\r\n}\r\n\r\nclass Bitcoin extends Account\r\n{\r\n    protected $balance;\r\n\r\n    public function __construct(float $balance)\r\n    {\r\n        $this-&gt;balance = $balance;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672df954445926-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59716661672df954445926-57\">57</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-1\"><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Account</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">successor</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Account</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">account</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">successor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">account</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-10\"> </div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amountToPay</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">canPay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amountToPay</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Paid %s using %s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PHP_EOL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amountToPay</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_called_class</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">elseif</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">successor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Cannot pay using %s. Proceeding ..'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PHP_EOL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_called_class</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">successor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">pay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amountToPay</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">throw</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'None of the accounts have enough balance'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-22\"> </div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">canPay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amount</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">bool</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">amount</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-27\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-28\"> </div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-29\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bank</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Account</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-30\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-32\"> </div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-37\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-38\"> </div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-39\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Paypal</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Account</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-40\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-42\"> </div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-47\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-48\"> </div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-49\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bitcoin</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Account</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-50\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-52\"> </div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">balance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">balance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672df954445926-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59716661672df954445926-57\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0067 seconds] -->\r\n<p>然后通过上面定义的链接（即 Bank, Paypal, Bitcoin）形成责任链</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59716661672e9052279801\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Let's prepare a chain like below\r\n//      $bank-&gt;$paypal-&gt;$bitcoin\r\n//\r\n// First priority bank\r\n//      If bank can't pay then paypal\r\n//      If paypal can't pay then bit coin\r\n\r\n$bank = new Bank(100);          // Bank with balance 100\r\n$paypal = new Paypal(200);      // Paypal with balance 200\r\n$bitcoin = new Bitcoin(300);    // Bitcoin with balance 300\r\n\r\n$bank-&gt;setNext($paypal);\r\n$paypal-&gt;setNext($bitcoin);\r\n\r\n// Let's try to pay using the first priority i.e. bank\r\n$bank-&gt;pay(259);\r\n\r\n// Output will be\r\n// ==============\r\n// Cannot pay using bank. Proceeding ..\r\n// Cannot pay using paypal. Proceeding ..:\r\n// Paid 259 using Bitcoin!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59716661672e9052279801-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672e9052279801-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59716661672e9052279801-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672e9052279801-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59716661672e9052279801-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672e9052279801-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59716661672e9052279801-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672e9052279801-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59716661672e9052279801-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672e9052279801-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59716661672e9052279801-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672e9052279801-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59716661672e9052279801-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672e9052279801-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59716661672e9052279801-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672e9052279801-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59716661672e9052279801-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672e9052279801-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59716661672e9052279801-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672e9052279801-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59716661672e9052279801-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672e9052279801-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59716661672e9052279801-1\"><span class=\"crayon-c\">// Let's prepare a chain like below</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672e9052279801-2\"><span class=\"crayon-c\">//      $bank-&gt;$paypal-&gt;$bitcoin</span></div><div class=\"crayon-line\" id=\"crayon-59716661672e9052279801-3\"><span class=\"crayon-c\">//</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672e9052279801-4\"><span class=\"crayon-c\">// First priority bank</span></div><div class=\"crayon-line\" id=\"crayon-59716661672e9052279801-5\"><span class=\"crayon-c\">//      If bank can't pay then paypal</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672e9052279801-6\"><span class=\"crayon-c\">//      If paypal can't pay then bit coin</span></div><div class=\"crayon-line\" id=\"crayon-59716661672e9052279801-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672e9052279801-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bank</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">          </span><span class=\"crayon-c\">// Bank with balance 100</span></div><div class=\"crayon-line\" id=\"crayon-59716661672e9052279801-9\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">paypal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Paypal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">// Paypal with balance 200</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672e9052279801-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bitcoin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bitcoin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// Bitcoin with balance 300</span></div><div class=\"crayon-line\" id=\"crayon-59716661672e9052279801-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672e9052279801-12\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bank</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">setNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">paypal</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672e9052279801-13\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">paypal</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">setNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bitcoin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672e9052279801-14\"> </div><div class=\"crayon-line\" id=\"crayon-59716661672e9052279801-15\"><span class=\"crayon-c\">// Let's try to pay using the first priority i.e. bank</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672e9052279801-16\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bank</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">pay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">259</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672e9052279801-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672e9052279801-18\"><span class=\"crayon-c\">// Output will be</span></div><div class=\"crayon-line\" id=\"crayon-59716661672e9052279801-19\"><span class=\"crayon-c\">// ==============</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672e9052279801-20\"><span class=\"crayon-c\">// Cannot pay using bank. Proceeding ..</span></div><div class=\"crayon-line\" id=\"crayon-59716661672e9052279801-21\"><span class=\"crayon-c\">// Cannot pay using paypal. Proceeding ..:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672e9052279801-22\"><span class=\"crayon-c\">// Paid 259 using Bitcoin!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p></p>\n<h3>👮 命令模式</h3>\n<h4>现实生活示例</h4>\n<p>一个典型的例子是你在餐厅点菜，你（即客户）向服务员（即 Invoker）点餐（即命令），服务员只需将需求转达给会烹饪的厨师。 另外一个例子是你（即客户端）使用遥控器（Invoker）打开（即命令）电视机（即接收器）。</p>\n<h4>概述</h4>\n<p>命令模式允许将操作封装在对象中，其背后的关键思想是提供客户端与接收器分离的方法。</p>\n<h4>维基百科</h4>\n<p>在面向对象程序设计的范畴中，命令模式是一种行为型设计模式。将所有需要的信息封装到对象中，用于之后的动作（action）或者事件触发。被封装的信息包括方法名以及拥有方法及参数的对象。</p>\n<p><strong>程序示例</strong></p>\n<p>首先给出一个接收器，实现了可能会执行的动作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59716661672ee649662913\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Receiver\r\nclass Bulb\r\n{\r\n    public function turnOn()\r\n    {\r\n        echo \"Bulb has been lit\";\r\n    }\r\n\r\n    public function turnOff()\r\n    {\r\n        echo \"Darkness!\";\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59716661672ee649662913-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672ee649662913-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59716661672ee649662913-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672ee649662913-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59716661672ee649662913-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672ee649662913-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59716661672ee649662913-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672ee649662913-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59716661672ee649662913-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672ee649662913-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59716661672ee649662913-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672ee649662913-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59716661672ee649662913-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59716661672ee649662913-1\"><span class=\"crayon-c\">// Receiver</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672ee649662913-2\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bulb</span></div><div class=\"crayon-line\" id=\"crayon-59716661672ee649662913-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672ee649662913-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">turnOn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59716661672ee649662913-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672ee649662913-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Bulb has been lit\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672ee649662913-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672ee649662913-8\"> </div><div class=\"crayon-line\" id=\"crayon-59716661672ee649662913-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">turnOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672ee649662913-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672ee649662913-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Darkness!\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672ee649662913-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59716661672ee649662913-13\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>然后给出一个接口，（Bulb）中的每个命令都要实现这个接口，得到一组命令集：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59716661672f2971834890\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface Command\r\n{\r\n    public function execute();\r\n    public function undo();\r\n    public function redo();\r\n}\r\n\r\n// Command\r\nclass TurnOn implements Command\r\n{\r\n    protected $bulb;\r\n\r\n    public function __construct(Bulb $bulb)\r\n    {\r\n        $this-&gt;bulb = $bulb;\r\n    }\r\n\r\n    public function execute()\r\n    {\r\n        $this-&gt;bulb-&gt;turnOn();\r\n    }\r\n\r\n    public function undo()\r\n    {\r\n        $this-&gt;bulb-&gt;turnOff();\r\n    }\r\n\r\n    public function redo()\r\n    {\r\n        $this-&gt;execute();\r\n    }\r\n}\r\n\r\nclass TurnOff implements Command\r\n{\r\n    protected $bulb;\r\n\r\n    public function __construct(Bulb $bulb)\r\n    {\r\n        $this-&gt;bulb = $bulb;\r\n    }\r\n\r\n    public function execute()\r\n    {\r\n        $this-&gt;bulb-&gt;turnOff();\r\n    }\r\n\r\n    public function undo()\r\n    {\r\n        $this-&gt;bulb-&gt;turnOn();\r\n    }\r\n\r\n    public function redo()\r\n    {\r\n        $this-&gt;execute();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f2971834890-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f2971834890-57\">57</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Command</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">undo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-8\"><span class=\"crayon-c\">// Command</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-9\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TurnOn</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Command</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-10\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-12\"> </div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Bulb</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">turnOn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-22\"> </div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">undo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">turnOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-32\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-34\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TurnOff</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Command</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-35\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Bulb</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-42\"> </div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">turnOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-47\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">undo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">turnOn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-52\"> </div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f2971834890-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f2971834890-57\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0055 seconds] -->\r\n<p>然后是Invoker，客户端将与之交互以处理各种命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59716661672f6699778638\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Invoker\r\nclass RemoteControl\r\n{\r\n    public function submit(Command $command)\r\n    {\r\n        $command-&gt;execute();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59716661672f6699778638-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f6699778638-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f6699778638-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f6699778638-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f6699778638-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f6699778638-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f6699778638-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f6699778638-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59716661672f6699778638-1\"><span class=\"crayon-c\">// Invoker</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f6699778638-2\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RemoteControl</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f6699778638-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f6699778638-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">submit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Command</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f6699778638-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f6699778638-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">command</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f6699778638-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f6699778638-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>最后来看一下如何在客户端中使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59716661672f9780423988\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$bulb = new Bulb();\r\n\r\n$turnOn = new TurnOn($bulb);\r\n$turnOff = new TurnOff($bulb);\r\n\r\n$remote = new RemoteControl();\r\n$remote-&gt;submit($turnOn); // Bulb has been lit!\r\n$remote-&gt;submit($turnOff); // Darkness!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59716661672f9780423988-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f9780423988-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f9780423988-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f9780423988-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f9780423988-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f9780423988-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59716661672f9780423988-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716661672f9780423988-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59716661672f9780423988-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bulb</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f9780423988-2\"> </div><div class=\"crayon-line\" id=\"crayon-59716661672f9780423988-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">turnOn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TurnOn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f9780423988-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">turnOff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TurnOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bulb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f9780423988-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f9780423988-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">remote</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RemoteControl</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59716661672f9780423988-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">remote</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">submit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">turnOn</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Bulb has been lit!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716661672f9780423988-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">remote</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">submit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">turnOff</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Darkness!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>命令模式也可用于实现基于事务的系统。在执行命令时，需要持续保存命令的历史，如果最后一条命令成功执行，皆大欢喜，否则遍历历史记录，并对所有执行过的命执行<code>撤销</code>。</p>\n<h3>➿ 迭代器模式</h3>\n<h4>现实生活示例</h4>\n<p>老式的无线电设备将是一个很好的迭代器示例，用户可以在某个频道上启动，然后使用下一个或上一个按钮来切换频道。或者以 MP3 播放器或电视机为例，你可以按下一个按钮和上一个按钮进行连续的频道切换。换句话说，它们都提供了一个界面来遍历相应的频道，歌曲或广播电台。</p>\n<h4>概述</h4>\n<p>迭代器模式提供了一种方法，可以访问对象的元素而不暴露底层实现。</p>\n<h4>维基百科</h4>\n<p>在面向对象程序设计中，迭代器模式是一种设计模式，其中迭代器用于遍历容器并访问容器的元素。迭代器模式将算法与容器解耦; 在某些情况下，算法是特定容器必需的，因此不能解耦。</p>\n<p><strong>程序示例</strong></p>\n<p>通过PHP，使用 SPL（PHP标准库）可以轻松实现迭代器模式，以上述收音机为例，首先给出 <code>RadioStation</code> 类</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167301387815707\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass RadioStation\r\n{\r\n    protected $frequency;\r\n\r\n    public function __construct(float $frequency)\r\n    {\r\n        $this-&gt;frequency = $frequency;\r\n    }\r\n\r\n    public function getFrequency(): float\r\n    {\r\n        return $this-&gt;frequency;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167301387815707-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167301387815707-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167301387815707-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167301387815707-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167301387815707-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167301387815707-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167301387815707-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167301387815707-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971666167301387815707-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167301387815707-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971666167301387815707-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167301387815707-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971666167301387815707-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167301387815707-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167301387815707-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167301387815707-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167301387815707-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">frequency</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167301387815707-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167301387815707-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">float</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">frequency</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167301387815707-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167301387815707-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">frequency</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">frequency</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167301387815707-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167301387815707-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167301387815707-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getFrequency</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span></div><div class=\"crayon-line\" id=\"crayon-5971666167301387815707-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167301387815707-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">frequency</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167301387815707-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167301387815707-14\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>然后是 迭代器</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167305206230337\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuse Countable;\r\nuse Iterator;\r\n\r\nclass StationList implements Countable, Iterator\r\n{\r\n    /** [@var](http://www.jobbole.com/members/variable) RadioStation[] $stations */\r\n    protected $stations = [];\r\n\r\n    /** [@var](http://www.jobbole.com/members/variable) int $counter */\r\n    protected $counter;\r\n\r\n    public function addStation(RadioStation $station)\r\n    {\r\n        $this-&gt;stations[] = $station;\r\n    }\r\n\r\n    public function removeStation(RadioStation $toRemove)\r\n    {\r\n        $toRemoveFrequency = $toRemove-&gt;getFrequency();\r\n        $this-&gt;stations = array_filter($this-&gt;stations, function (RadioStation $station) use ($toRemoveFrequency) {\r\n            return $station-&gt;getFrequency() !== $toRemoveFrequency;\r\n        });\r\n    }\r\n\r\n    public function count(): int\r\n    {\r\n        return count($this-&gt;stations);\r\n    }\r\n\r\n    public function current(): RadioStation\r\n    {\r\n        return $this-&gt;stations[$this-&gt;counter];\r\n    }\r\n\r\n    public function key()\r\n    {\r\n        return $this-&gt;counter;\r\n    }\r\n\r\n    public function next()\r\n    {\r\n        $this-&gt;counter++;\r\n    }\r\n\r\n    public function rewind()\r\n    {\r\n        $this-&gt;counter = 0;\r\n    }\r\n\r\n    public function valid(): bool\r\n    {\r\n        return isset($this-&gt;stations[$this-&gt;counter]);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5971666167305206230337-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167305206230337-54\">54</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-1\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Countable</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-2\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Iterator</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-4\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StationList </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Countable</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Iterator</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-5\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/** [@var](http://www.jobbole.com/members/variable) RadioStation[] $stations */</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stations</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-8\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/** [@var](http://www.jobbole.com/members/variable) int $counter */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">RadioStation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-16\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">removeStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">RadioStation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">toRemove</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">toRemoveFrequency</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">toRemove</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getFrequency</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_filter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">RadioStation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">toRemoveFrequency</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getFrequency</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!==</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">toRemoveFrequency</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-24\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">current</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-34\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">key</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-39\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">counter</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-44\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rewind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-49\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">bool</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">stations</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167305206230337-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167305206230337-54\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0070 seconds] -->\r\n<p>可以这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597166616730a608432303\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$stationList = new StationList();\r\n\r\n$stationList-&gt;addStation(new RadioStation(89));\r\n$stationList-&gt;addStation(new RadioStation(101));\r\n$stationList-&gt;addStation(new RadioStation(102));\r\n$stationList-&gt;addStation(new RadioStation(103.2));\r\n\r\nforeach($stationList as $station) {\r\n    echo $station-&gt;getFrequency() . PHP_EOL;\r\n}\r\n\r\n$stationList-&gt;removeStation(new RadioStation(89)); // Will remove station 89</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597166616730a608432303-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616730a608432303-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597166616730a608432303-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616730a608432303-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597166616730a608432303-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616730a608432303-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597166616730a608432303-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616730a608432303-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597166616730a608432303-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616730a608432303-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-597166616730a608432303-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616730a608432303-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597166616730a608432303-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StationList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616730a608432303-2\"> </div><div class=\"crayon-line\" id=\"crayon-597166616730a608432303-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">89</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616730a608432303-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">101</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616730a608432303-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">102</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616730a608432303-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">103.2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616730a608432303-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616730a608432303-8\"><span class=\"crayon-st\">foreach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">stationList </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616730a608432303-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">station</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getFrequency</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PHP_EOL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616730a608432303-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616730a608432303-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616730a608432303-12\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">stationList</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">removeStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RadioStation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">89</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Will remove station 89</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p></p>\n<h3>👽 中介者模式</h3>\n<h4>现实生活示例</h4>\n<p>典型的例子是你通过手机与他人通话，你与通话者之间有一个网络供应商，对话将通过供应商传递而非直接传递。这种情况下网络供应商就是中介者。</p>\n<h4>概述</h4>\n<p>中介者模式添加了第三方对象（称为中介者）来控制两个对象（称为 colleague）之间的交互。中介者模式有助于减少通信类之间的耦合，因为类之间无需知道对方的实现。</p>\n<h4>维基百科</h4>\n<p>在软件工程中，中介者模式包装了一系列对象相互作用的方式。这种模式被认为是一种行为模式，因为它可以改变程序的运行时行为。</p>\n<p><strong>程序示例</strong></p>\n<p>下面是一个最简单的用户（即 colleague）在聊天室（中介者）中互相发送消息的示例</p>\n<p>首先给出中介者及聊天室</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597166616730e607815655\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface ChatRoomMediator \r\n{\r\n    public function showMessage(User $user, string $message);\r\n}\r\n\r\n// Mediator\r\nclass ChatRoom implements ChatRoomMediator\r\n{\r\n    public function showMessage(User $user, string $message)\r\n    {\r\n        $time = date('M d, y H:i');\r\n        $sender = $user-&gt;getName();\r\n\r\n        echo $time . '[' . $sender . ']:' . $message;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597166616730e607815655-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616730e607815655-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597166616730e607815655-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616730e607815655-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597166616730e607815655-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616730e607815655-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597166616730e607815655-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616730e607815655-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597166616730e607815655-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616730e607815655-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-597166616730e607815655-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616730e607815655-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-597166616730e607815655-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616730e607815655-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-597166616730e607815655-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616730e607815655-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597166616730e607815655-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ChatRoomMediator</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616730e607815655-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616730e607815655-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">showMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616730e607815655-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616730e607815655-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616730e607815655-6\"><span class=\"crayon-c\">// Mediator</span></div><div class=\"crayon-line\" id=\"crayon-597166616730e607815655-7\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ChatRoom</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ChatRoomMediator</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616730e607815655-8\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616730e607815655-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">showMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616730e607815655-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616730e607815655-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'M d, y H:i'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616730e607815655-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sender</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616730e607815655-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616730e607815655-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'['</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">sender</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">']:'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616730e607815655-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616730e607815655-16\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>然后是用户即 colleague</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167311131051409\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass User {\r\n    protected $name;\r\n    protected $chatMediator;\r\n\r\n    public function __construct(string $name, ChatRoomMediator $chatMediator) {\r\n        $this-&gt;name = $name;\r\n        $this-&gt;chatMediator = $chatMediator;\r\n    }\r\n\r\n    public function getName() {\r\n        return $this-&gt;name;\r\n    }\r\n\r\n    public function send($message) {\r\n        $this-&gt;chatMediator-&gt;showMessage($this, $message);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167311131051409-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167311131051409-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167311131051409-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167311131051409-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167311131051409-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167311131051409-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167311131051409-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167311131051409-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971666167311131051409-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167311131051409-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971666167311131051409-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167311131051409-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971666167311131051409-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167311131051409-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971666167311131051409-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167311131051409-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971666167311131051409-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167311131051409-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167311131051409-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167311131051409-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">chatMediator</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167311131051409-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167311131051409-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ChatRoomMediator</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">chatMediator</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167311131051409-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167311131051409-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">chatMediator</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">chatMediator</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167311131051409-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167311131051409-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167311131051409-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167311131051409-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167311131051409-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167311131051409-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167311131051409-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167311131051409-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">chatMediator</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">showMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167311131051409-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167311131051409-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>用法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167314807618864\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$mediator = new ChatRoom();\r\n\r\n$john = new User('John Doe', $mediator);\r\n$jane = new User('Jane Doe', $mediator);\r\n\r\n$john-&gt;send('Hi there!');\r\n$jane-&gt;send('Hey!');\r\n\r\n// Output will be\r\n// Feb 14, 10:58 [John]: Hi there!\r\n// Feb 14, 10:58 [Jane]: Hey!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167314807618864-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167314807618864-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167314807618864-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167314807618864-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167314807618864-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167314807618864-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167314807618864-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167314807618864-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971666167314807618864-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167314807618864-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971666167314807618864-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167314807618864-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">mediator</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ChatRoom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167314807618864-2\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167314807618864-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">john</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'John Doe'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">mediator</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167314807618864-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jane</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">User</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Jane Doe'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">mediator</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167314807618864-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167314807618864-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">john</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hi there!'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167314807618864-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jane</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hey!'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167314807618864-8\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167314807618864-9\"><span class=\"crayon-c\">// Output will be</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167314807618864-10\"><span class=\"crayon-c\">// Feb 14, 10:58 [John]: Hi there!</span></div><div class=\"crayon-line\" id=\"crayon-5971666167314807618864-11\"><span class=\"crayon-c\">// Feb 14, 10:58 [Jane]: Hey!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p>\n<h3>💾 备忘录模式</h3>\n<h4>现实生活示例</h4>\n<p>以计算器（即发起者）为例，每当执行一些计算时，最后一次计算结果将保存在内存中（即备忘录），以便数据可以恢复，也可以使用某些操作按钮（即临时代理）来恢复数据。</p>\n<h4>概述</h4>\n<p>备忘录模式以一种稍后可平滑恢复的方式捕捉并存储对象的当前状态。</p>\n<h4>维基百科</h4>\n<p>备忘录模式是一种软件设计模式，可以将对象恢复到之前的状态（通过回滚来撤销）</p>\n<p>需要提供撤销操作时，备忘录模式通常很有用。</p>\n<p><strong>程序示例</strong></p>\n<p>首先给出可以存储编辑器状态的备忘录对象</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167318969113866\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass EditorMemento\r\n{\r\n    protected $content;\r\n\r\n    public function __construct(string $content)\r\n    {\r\n        $this-&gt;content = $content;\r\n    }\r\n\r\n    public function getContent()\r\n    {\r\n        return $this-&gt;content;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167318969113866-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167318969113866-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167318969113866-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167318969113866-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167318969113866-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167318969113866-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167318969113866-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167318969113866-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971666167318969113866-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167318969113866-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971666167318969113866-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167318969113866-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971666167318969113866-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167318969113866-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167318969113866-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EditorMemento</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167318969113866-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167318969113866-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167318969113866-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167318969113866-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167318969113866-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167318969113866-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167318969113866-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167318969113866-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167318969113866-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971666167318969113866-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167318969113866-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167318969113866-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167318969113866-14\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>然后是使用备忘录对象的编辑器及发起者</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597166616731b708569822\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Editor\r\n{\r\n    protected $content = '';\r\n\r\n    public function type(string $words)\r\n    {\r\n        $this-&gt;content = $this-&gt;content . ' ' . $words;\r\n    }\r\n\r\n    public function getContent()\r\n    {\r\n        return $this-&gt;content;\r\n    }\r\n\r\n    public function save()\r\n    {\r\n        return new EditorMemento($this-&gt;content);\r\n    }\r\n\r\n    public function restore(EditorMemento $memento)\r\n    {\r\n        $this-&gt;content = $memento-&gt;getContent();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597166616731b708569822-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731b708569822-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597166616731b708569822-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731b708569822-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597166616731b708569822-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731b708569822-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597166616731b708569822-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731b708569822-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597166616731b708569822-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731b708569822-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-597166616731b708569822-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731b708569822-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-597166616731b708569822-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731b708569822-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-597166616731b708569822-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731b708569822-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-597166616731b708569822-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731b708569822-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-597166616731b708569822-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731b708569822-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-597166616731b708569822-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731b708569822-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-597166616731b708569822-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731b708569822-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597166616731b708569822-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Editor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731b708569822-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616731b708569822-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731b708569822-4\"> </div><div class=\"crayon-line\" id=\"crayon-597166616731b708569822-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731b708569822-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616731b708569822-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-i\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">' '</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731b708569822-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616731b708569822-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731b708569822-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-597166616731b708569822-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731b708569822-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616731b708569822-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731b708569822-14\"> </div><div class=\"crayon-line\" id=\"crayon-597166616731b708569822-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731b708569822-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616731b708569822-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EditorMemento</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731b708569822-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616731b708569822-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731b708569822-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">restore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">EditorMemento</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">memento</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-597166616731b708569822-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731b708569822-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">memento</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616731b708569822-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731b708569822-24\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597166616731f044453092\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$editor = new Editor();\r\n\r\n// Type some stuff\r\n$editor-&gt;type('This is the first sentence.');\r\n$editor-&gt;type('This is second.');\r\n\r\n// Save the state to restore to : This is the first sentence. This is second.\r\n$saved = $editor-&gt;save();\r\n\r\n// Type some more\r\n$editor-&gt;type('And this is third.');\r\n\r\n// Output: Content before Saving\r\necho $editor-&gt;getContent(); // This is the first sentence. This is second. And this is third.\r\n\r\n// Restoring to last saved state\r\n$editor-&gt;restore($saved);\r\n\r\n$editor-&gt;getContent(); // This is the first sentence. This is second.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597166616731f044453092-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731f044453092-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597166616731f044453092-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731f044453092-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597166616731f044453092-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731f044453092-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597166616731f044453092-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731f044453092-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597166616731f044453092-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731f044453092-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-597166616731f044453092-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731f044453092-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-597166616731f044453092-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731f044453092-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-597166616731f044453092-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731f044453092-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-597166616731f044453092-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616731f044453092-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-597166616731f044453092-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597166616731f044453092-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Editor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731f044453092-2\"> </div><div class=\"crayon-line\" id=\"crayon-597166616731f044453092-3\"><span class=\"crayon-c\">// Type some stuff</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731f044453092-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'This is the first sentence.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616731f044453092-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'This is second.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731f044453092-6\"> </div><div class=\"crayon-line\" id=\"crayon-597166616731f044453092-7\"><span class=\"crayon-c\">// Save the state to restore to : This is the first sentence. This is second.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731f044453092-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">saved</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616731f044453092-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731f044453092-10\"><span class=\"crayon-c\">// Type some more</span></div><div class=\"crayon-line\" id=\"crayon-597166616731f044453092-11\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'And this is third.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731f044453092-12\"> </div><div class=\"crayon-line\" id=\"crayon-597166616731f044453092-13\"><span class=\"crayon-c\">// Output: Content before Saving</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731f044453092-14\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// This is the first sentence. This is second. And this is third.</span></div><div class=\"crayon-line\" id=\"crayon-597166616731f044453092-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731f044453092-16\"><span class=\"crayon-c\">// Restoring to last saved state</span></div><div class=\"crayon-line\" id=\"crayon-597166616731f044453092-17\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">restore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">saved</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616731f044453092-18\"> </div><div class=\"crayon-line\" id=\"crayon-597166616731f044453092-19\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getContent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// This is the first sentence. This is second.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p></p>\n<h3>😎 观察者模式</h3>\n<h4>现实生活示例</h4>\n<p>一个很好的例子是，求职者订阅了一些招聘网站，每当有匹配的工作机会时，求职者就会收到通知。</p>\n<h4>概述</h4>\n<p>定义了对象之间的依赖，一旦其中一个对象的状态发生改变，依赖它的对象都会收到通知。</p>\n<h4>维基百科</h4>\n<p>观察者模式是软件设计模式的一种。在此种模式中，一个目标对象管理所有相依于它的观察者对象，并且在它本身的状态改变时主动发出通知。通常通过调用目标对象所提供的方法来实现。</p>\n<p><strong>程序示例</strong></p>\n<p>以上述求职订阅为例，首先给出求职者，有职位发布时会收到通知</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167322005064724\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass JobPost\r\n{\r\n    protected $title;\r\n\r\n    public function __construct(string $title)\r\n    {\r\n        $this-&gt;title = $title;\r\n    }\r\n\r\n    public function getTitle()\r\n    {\r\n        return $this-&gt;title;\r\n    }\r\n}\r\n\r\nclass JobSeeker implements Observer\r\n{\r\n    protected $name;\r\n\r\n    public function __construct(string $name)\r\n    {\r\n        $this-&gt;name = $name;\r\n    }\r\n\r\n    public function onJobPosted(JobPost $job)\r\n    {\r\n        // Do something with the job posting\r\n        echo 'Hi ' . $this-&gt;name . '! New job posted: '. $job-&gt;getTitle();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167322005064724-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167322005064724-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167322005064724-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167322005064724-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167322005064724-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167322005064724-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167322005064724-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167322005064724-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971666167322005064724-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167322005064724-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971666167322005064724-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167322005064724-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971666167322005064724-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167322005064724-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971666167322005064724-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167322005064724-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971666167322005064724-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167322005064724-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971666167322005064724-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167322005064724-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971666167322005064724-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167322005064724-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5971666167322005064724-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167322005064724-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5971666167322005064724-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167322005064724-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5971666167322005064724-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167322005064724-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5971666167322005064724-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167322005064724-30\">30</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167322005064724-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobPost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167322005064724-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167322005064724-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">title</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167322005064724-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167322005064724-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">title</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167322005064724-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167322005064724-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">title</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">title</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167322005064724-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167322005064724-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167322005064724-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTitle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971666167322005064724-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167322005064724-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">title</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167322005064724-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167322005064724-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167322005064724-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167322005064724-16\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobSeeker</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Observer</span></div><div class=\"crayon-line\" id=\"crayon-5971666167322005064724-17\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167322005064724-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167322005064724-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167322005064724-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971666167322005064724-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167322005064724-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167322005064724-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167322005064724-24\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167322005064724-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">onJobPosted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">JobPost</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">job</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167322005064724-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167322005064724-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Do something with the job posting</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167322005064724-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Hi '</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'! New job posted: '</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">job</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getTitle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167322005064724-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167322005064724-30\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p>然后是求职者订阅的职位发布类</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167326226691966\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass JobPostings implements Observable\r\n{\r\n    protected $observers = [];\r\n\r\n    protected function notify(JobPost $jobPosting)\r\n    {\r\n        foreach ($this-&gt;observers as $observer) {\r\n            $observer-&gt;onJobPosted($jobPosting);\r\n        }\r\n    }\r\n\r\n    public function attach(Observer $observer)\r\n    {\r\n        $this-&gt;observers[] = $observer;\r\n    }\r\n\r\n    public function addJob(JobPost $jobPosting)\r\n    {\r\n        $this-&gt;notify($jobPosting);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167326226691966-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167326226691966-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167326226691966-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167326226691966-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167326226691966-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167326226691966-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167326226691966-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167326226691966-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971666167326226691966-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167326226691966-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971666167326226691966-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167326226691966-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971666167326226691966-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167326226691966-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971666167326226691966-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167326226691966-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971666167326226691966-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167326226691966-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971666167326226691966-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167326226691966-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971666167326226691966-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167326226691966-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobPostings</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Observable</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167326226691966-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167326226691966-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">observers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167326226691966-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167326226691966-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">notify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">JobPost</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPosting</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167326226691966-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167326226691966-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">observers </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">observer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167326226691966-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">observer</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">onJobPosted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPosting</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167326226691966-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167326226691966-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167326226691966-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167326226691966-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">attach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Observer</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">observer</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971666167326226691966-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167326226691966-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">observers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">observer</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167326226691966-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167326226691966-16\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167326226691966-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addJob</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">JobPost</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPosting</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167326226691966-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167326226691966-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">notify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPosting</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167326226691966-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167326226691966-21\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167329848909529\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Create subscribers\r\n$johnDoe = new JobSeeker('John Doe');\r\n$janeDoe = new JobSeeker('Jane Doe');\r\n\r\n// Create publisher and attach subscribers\r\n$jobPostings = new JobPostings();\r\n$jobPostings-&gt;attach($johnDoe);\r\n$jobPostings-&gt;attach($janeDoe);\r\n\r\n// Add a new job and see if subscribers get notified\r\n$jobPostings-&gt;addJob(new JobPost('Software Engineer'));\r\n\r\n// Output\r\n// Hi John Doe! New job posted: Software Engineer\r\n// Hi Jane Doe! New job posted: Software Engineer</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167329848909529-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167329848909529-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167329848909529-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167329848909529-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167329848909529-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167329848909529-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167329848909529-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167329848909529-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971666167329848909529-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167329848909529-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971666167329848909529-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167329848909529-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971666167329848909529-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167329848909529-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971666167329848909529-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167329848909529-1\"><span class=\"crayon-c\">// Create subscribers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167329848909529-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">johnDoe</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobSeeker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'John Doe'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167329848909529-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">janeDoe</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobSeeker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Jane Doe'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167329848909529-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167329848909529-5\"><span class=\"crayon-c\">// Create publisher and attach subscribers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167329848909529-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPostings</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobPostings</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167329848909529-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPostings</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">attach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">johnDoe</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167329848909529-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPostings</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">attach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">janeDoe</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167329848909529-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167329848909529-10\"><span class=\"crayon-c\">// Add a new job and see if subscribers get notified</span></div><div class=\"crayon-line\" id=\"crayon-5971666167329848909529-11\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jobPostings</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addJob</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JobPost</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Software Engineer'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167329848909529-12\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167329848909529-13\"><span class=\"crayon-c\">// Output</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167329848909529-14\"><span class=\"crayon-c\">// Hi John Doe! New job posted: Software Engineer</span></div><div class=\"crayon-line\" id=\"crayon-5971666167329848909529-15\"><span class=\"crayon-c\">// Hi Jane Doe! New job posted: Software Engineer</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p>\n<h3>🏃 访问者模式</h3>\n<h4>现实生活示例</h4>\n<p>假如有人前往迪拜，他们需要有证件（比如签证）就可进入迪拜。到达后，无需获得许可或做一些跑腿工作，他们便可以自由前往迪拜的任何地方; 只要是知道的地方，就能游览。访问者模式可以做到这一点，它可以帮助你添加访问地点，以便在无需跑腿的情况下，可以尽可能多地访问。</p>\n<h4>概述</h4>\n<p>访问者模式可以在无需修改对象的情况下增加一些额外操作。</p>\n<h4>维基百科</h4>\n<p>在面向对象编程和软件工程中，访问者设计模式是一种从对象结构中分离算法的方式。这种分离的实际结果是能够向现有的对象结构添加新的操作，而无需修改这些结构。这是遵循开放/封闭原则的一种方式。</p>\n<p><strong>编程示例</strong></p>\n<p>以模拟动物园为例，动物园里有几种不同种类的动物，我们需要让它们发出叫声，下面使用访问者模式实现</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597166616732d035587556\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Visitee\r\ninterface Animal\r\n{\r\n    public function accept(AnimalOperation $operation);\r\n}\r\n\r\n// Visitor\r\ninterface AnimalOperation\r\n{\r\n    public function visitMonkey(Monkey $monkey);\r\n    public function visitLion(Lion $lion);\r\n    public function visitDolphin(Dolphin $dolphin);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597166616732d035587556-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616732d035587556-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597166616732d035587556-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616732d035587556-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597166616732d035587556-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616732d035587556-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597166616732d035587556-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616732d035587556-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597166616732d035587556-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616732d035587556-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-597166616732d035587556-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616732d035587556-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-597166616732d035587556-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597166616732d035587556-1\"><span class=\"crayon-c\">// Visitee</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616732d035587556-2\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Animal</span></div><div class=\"crayon-line\" id=\"crayon-597166616732d035587556-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616732d035587556-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">AnimalOperation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616732d035587556-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616732d035587556-6\"> </div><div class=\"crayon-line\" id=\"crayon-597166616732d035587556-7\"><span class=\"crayon-c\">// Visitor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616732d035587556-8\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AnimalOperation</span></div><div class=\"crayon-line\" id=\"crayon-597166616732d035587556-9\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616732d035587556-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitMonkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Monkey</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616732d035587556-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitLion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616732d035587556-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitDolphin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Dolphin</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616732d035587556-13\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>然后实现各种动物</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167331880875273\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Monkey implements Animal\r\n{\r\n    public function shout()\r\n    {\r\n        echo 'Ooh oo aa aa!';\r\n    }\r\n\r\n    public function accept(AnimalOperation $operation)\r\n    {\r\n        $operation-&gt;visitMonkey($this);\r\n    }\r\n}\r\n\r\nclass Lion implements Animal\r\n{\r\n    public function roar()\r\n    {\r\n        echo 'Roaaar!';\r\n    }\r\n\r\n    public function accept(AnimalOperation $operation)\r\n    {\r\n        $operation-&gt;visitLion($this);\r\n    }\r\n}\r\n\r\nclass Dolphin implements Animal\r\n{\r\n    public function speak()\r\n    {\r\n        echo 'Tuut tuttu tuutt!';\r\n    }\r\n\r\n    public function accept(AnimalOperation $operation)\r\n    {\r\n        $operation-&gt;visitDolphin($this);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5971666167331880875273-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167331880875273-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Monkey</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Animal</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">shout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Ooh oo aa aa!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">AnimalOperation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">visitMonkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-12\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-14\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Animal</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-15\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">roar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Roaaar!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-20\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">AnimalOperation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">visitLion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-25\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-26\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-27\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dolphin</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Animal</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-28\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">speak</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Tuut tuttu tuutt!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">AnimalOperation</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">operation</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">visitDolphin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167331880875273-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167331880875273-38\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p>接下来实现访问者</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167334944824439\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Speak implements AnimalOperation\r\n{\r\n    public function visitMonkey(Monkey $monkey)\r\n    {\r\n        $monkey-&gt;shout();\r\n    }\r\n\r\n    public function visitLion(Lion $lion)\r\n    {\r\n        $lion-&gt;roar();\r\n    }\r\n\r\n    public function visitDolphin(Dolphin $dolphin)\r\n    {\r\n        $dolphin-&gt;speak();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167334944824439-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167334944824439-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167334944824439-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167334944824439-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167334944824439-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167334944824439-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167334944824439-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167334944824439-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971666167334944824439-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167334944824439-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971666167334944824439-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167334944824439-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971666167334944824439-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167334944824439-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971666167334944824439-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167334944824439-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971666167334944824439-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167334944824439-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Speak</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AnimalOperation</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167334944824439-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167334944824439-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitMonkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Monkey</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167334944824439-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167334944824439-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">shout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167334944824439-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167334944824439-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167334944824439-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitLion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5971666167334944824439-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167334944824439-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">roar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167334944824439-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167334944824439-12\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167334944824439-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitDolphin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Dolphin</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167334944824439-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167334944824439-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">speak</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167334944824439-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167334944824439-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>可以这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167337393627322\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$monkey = new Monkey();\r\n$lion = new Lion();\r\n$dolphin = new Dolphin();\r\n\r\n$speak = new Speak();\r\n\r\n$monkey-&gt;accept($speak);    // Ooh oo aa aa!    \r\n$lion-&gt;accept($speak);      // Roaaar!\r\n$dolphin-&gt;accept($speak);   // Tuut tutt tuutt!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167337393627322-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167337393627322-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167337393627322-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167337393627322-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167337393627322-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167337393627322-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167337393627322-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167337393627322-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971666167337393627322-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167337393627322-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Monkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167337393627322-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167337393627322-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dolphin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167337393627322-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167337393627322-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Speak</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167337393627322-6\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167337393627322-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// Ooh oo aa aa!    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167337393627322-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">// Roaaar!</span></div><div class=\"crayon-line\" id=\"crayon-5971666167337393627322-9\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// Tuut tutt tuutt!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>当需要为动物添加新动作时，我们本可以通过动物支持继承来实现，但是需要修改动物类。但现在就不必修改动物类了。例如，假设需要向动物添加跳跃行为，我们可以通过创建一个新的访问者来简单地添加此行为，即：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597166616733a872870960\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Jump implements AnimalOperation\r\n{\r\n    public function visitMonkey(Monkey $monkey)\r\n    {\r\n        echo 'Jumped 20 feet high! on to the tree!';\r\n    }\r\n\r\n    public function visitLion(Lion $lion)\r\n    {\r\n        echo 'Jumped 7 feet! Back on the ground!';\r\n    }\r\n\r\n    public function visitDolphin(Dolphin $dolphin)\r\n    {\r\n        echo 'Walked on water a little and disappeared';\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597166616733a872870960-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616733a872870960-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597166616733a872870960-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616733a872870960-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597166616733a872870960-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616733a872870960-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597166616733a872870960-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616733a872870960-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597166616733a872870960-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616733a872870960-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-597166616733a872870960-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616733a872870960-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-597166616733a872870960-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616733a872870960-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-597166616733a872870960-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616733a872870960-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-597166616733a872870960-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597166616733a872870960-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Jump</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AnimalOperation</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616733a872870960-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616733a872870960-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitMonkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Monkey</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616733a872870960-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616733a872870960-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Jumped 20 feet high! on to the tree!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616733a872870960-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616733a872870960-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616733a872870960-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitLion</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Lion</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-597166616733a872870960-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616733a872870960-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Jumped 7 feet! Back on the ground!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616733a872870960-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616733a872870960-12\"> </div><div class=\"crayon-line\" id=\"crayon-597166616733a872870960-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visitDolphin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Dolphin</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616733a872870960-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616733a872870960-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Walked on water a little and disappeared'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616733a872870960-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616733a872870960-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>这样使用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597166616733e284145818\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$jump = new Jump();\r\n\r\n$monkey-&gt;accept($speak);   // Ooh oo aa aa!\r\n$monkey-&gt;accept($jump);    // Jumped 20 feet high! on to the tree!\r\n\r\n$lion-&gt;accept($speak);     // Roaaar!\r\n$lion-&gt;accept($jump);      // Jumped 7 feet! Back on the ground!\r\n\r\n$dolphin-&gt;accept($speak);  // Tuut tutt tuutt!\r\n$dolphin-&gt;accept($jump);   // Walked on water a little and disappeared</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597166616733e284145818-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616733e284145818-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597166616733e284145818-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616733e284145818-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597166616733e284145818-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616733e284145818-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597166616733e284145818-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616733e284145818-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597166616733e284145818-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616733e284145818-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597166616733e284145818-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Jump</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616733e284145818-2\"> </div><div class=\"crayon-line\" id=\"crayon-597166616733e284145818-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// Ooh oo aa aa!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616733e284145818-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">monkey</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jump</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// Jumped 20 feet high! on to the tree!</span></div><div class=\"crayon-line\" id=\"crayon-597166616733e284145818-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616733e284145818-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">// Roaaar!</span></div><div class=\"crayon-line\" id=\"crayon-597166616733e284145818-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lion</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jump</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">// Jumped 7 feet! Back on the ground!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616733e284145818-8\"> </div><div class=\"crayon-line\" id=\"crayon-597166616733e284145818-9\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">speak</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">// Tuut tutt tuutt!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616733e284145818-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dolphin</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">jump</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// Walked on water a little and disappeared</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p></p>\n<h3>💡 策略模式</h3>\n<h4>现实生活示例</h4>\n<p>考虑排序的例子，我们实现了冒泡排序，但数据开始增长，冒泡排序开始变得非常慢。为了解决这个问题，我们实现了快速排序。尽管快速排序算法对于大型数据集来说效果很好，但对于较小的数据集却非常慢。为了解决这个问题，我们实施了一个策略，小数据集使用冒泡排序，大数据集使用快速排序。</p>\n<h4>概述</h4>\n<p>策略模式允许你基于场景转换算法或策略。</p>\n<h4>维基百科</h4>\n<p>在计算机编程中，策略模式是一种行为设计模式，可以在运行时选择算法的行为。</p>\n<p><strong>编程示例</strong></p>\n<p>以上述排序为例，首先给出策略接口及不同的策略实现</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167341094115900\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface SortStrategy\r\n{\r\n    public function sort(array $dataset): array;\r\n}\r\n\r\nclass BubbleSortStrategy implements SortStrategy\r\n{\r\n    public function sort(array $dataset): array\r\n    {\r\n        echo \"Sorting using bubble sort\";\r\n\r\n        // Do sorting\r\n        return $dataset;\r\n    }\r\n}\r\n\r\nclass QuickSortStrategy implements SortStrategy\r\n{\r\n    public function sort(array $dataset): array\r\n    {\r\n        echo \"Sorting using quick sort\";\r\n\r\n        // Do sorting\r\n        return $dataset;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167341094115900-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167341094115900-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167341094115900-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167341094115900-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167341094115900-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167341094115900-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167341094115900-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167341094115900-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971666167341094115900-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167341094115900-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971666167341094115900-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167341094115900-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971666167341094115900-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167341094115900-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971666167341094115900-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167341094115900-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971666167341094115900-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167341094115900-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971666167341094115900-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167341094115900-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5971666167341094115900-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167341094115900-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5971666167341094115900-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167341094115900-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5971666167341094115900-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167341094115900-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167341094115900-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SortStrategy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167341094115900-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167341094115900-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167341094115900-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167341094115900-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167341094115900-6\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BubbleSortStrategy</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SortStrategy</span></div><div class=\"crayon-line\" id=\"crayon-5971666167341094115900-7\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167341094115900-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span></div><div class=\"crayon-line\" id=\"crayon-5971666167341094115900-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167341094115900-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Sorting using bubble sort\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167341094115900-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167341094115900-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Do sorting</span></div><div class=\"crayon-line\" id=\"crayon-5971666167341094115900-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167341094115900-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167341094115900-15\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167341094115900-16\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167341094115900-17\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">QuickSortStrategy</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SortStrategy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167341094115900-18\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167341094115900-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167341094115900-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167341094115900-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Sorting using quick sort\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167341094115900-22\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167341094115900-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Do sorting</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167341094115900-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167341094115900-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167341094115900-26\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>客户端可以使用任意策略</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167345971650163\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Sorter\r\n{\r\n    protected $sorter;\r\n\r\n    public function __construct(SortStrategy $sorter)\r\n    {\r\n        $this-&gt;sorter = $sorter;\r\n    }\r\n\r\n    public function sort(array $dataset): array\r\n    {\r\n        return $this-&gt;sorter-&gt;sort($dataset);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167345971650163-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167345971650163-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167345971650163-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167345971650163-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167345971650163-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167345971650163-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167345971650163-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167345971650163-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971666167345971650163-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167345971650163-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971666167345971650163-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167345971650163-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971666167345971650163-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167345971650163-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167345971650163-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Sorter</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167345971650163-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167345971650163-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167345971650163-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167345971650163-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">SortStrategy</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167345971650163-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167345971650163-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167345971650163-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5971666167345971650163-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167345971650163-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span></div><div class=\"crayon-line\" id=\"crayon-5971666167345971650163-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167345971650163-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167345971650163-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167345971650163-14\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>用法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167348396991368\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$dataset = [1, 5, 4, 3, 2, 8];\r\n\r\n$sorter = new Sorter(new BubbleSortStrategy());\r\n$sorter-&gt;sort($dataset); // Output : Sorting using bubble sort\r\n\r\n$sorter = new Sorter(new QuickSortStrategy());\r\n$sorter-&gt;sort($dataset); // Output : Sorting using quick sort</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167348396991368-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167348396991368-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167348396991368-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167348396991368-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167348396991368-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167348396991368-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167348396991368-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167348396991368-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167348396991368-2\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167348396991368-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Sorter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BubbleSortStrategy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167348396991368-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Output : Sorting using bubble sort</span></div><div class=\"crayon-line\" id=\"crayon-5971666167348396991368-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167348396991368-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Sorter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">QuickSortStrategy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167348396991368-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sorter</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">dataset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// Output : Sorting using quick sort</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<h3>💢 状态模式</h3>\n<h4>现实生活示例</h4>\n<p>想象一下，你正在使用一些绘图应用程序，你可以选择笔刷来绘画，刷子根据所选颜色改变其行为，即如果选择红色，它将绘制为红色，如果选择蓝色，那么它将绘制蓝色等。</p>\n<h4>概述</h4>\n<p>当状态改变时，类的行为也发生改变。</p>\n<h4>维基百科</h4>\n<p>状态模式是以面向对象的方式实现状态机的行为设计模式。对于状态模式，通过将每个单独状态实现为派生类的状态模式接口, 来实现一个状态机，并通过调用模式超类的方法来实现状态转换。状态模式可以被解释为一种策略模式，它能够通过调用模式接口定义的方法来切换当前策略。</p>\n<p><strong>程序示例</strong></p>\n<p>以文本编辑器为例，编辑器可以改变文本的状态如选中粗体，就会以粗体输入文本，选中斜体便以斜体输入。</p>\n<p>首先是状态接口和一些状态实现</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597166616734c239726683\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface WritingState\r\n{\r\n    public function write(string $words);\r\n}\r\n\r\nclass UpperCase implements WritingState\r\n{\r\n    public function write(string $words)\r\n    {\r\n        echo strtoupper($words);\r\n    }\r\n}\r\n\r\nclass LowerCase implements WritingState\r\n{\r\n    public function write(string $words)\r\n    {\r\n        echo strtolower($words);\r\n    }\r\n}\r\n\r\nclass Default implements WritingState\r\n{\r\n    public function write(string $words)\r\n    {\r\n        echo $words;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597166616734c239726683-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734c239726683-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597166616734c239726683-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734c239726683-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597166616734c239726683-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734c239726683-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597166616734c239726683-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734c239726683-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597166616734c239726683-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734c239726683-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-597166616734c239726683-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734c239726683-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-597166616734c239726683-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734c239726683-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-597166616734c239726683-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734c239726683-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-597166616734c239726683-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734c239726683-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-597166616734c239726683-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734c239726683-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-597166616734c239726683-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734c239726683-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-597166616734c239726683-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734c239726683-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-597166616734c239726683-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734c239726683-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-597166616734c239726683-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734c239726683-28\">28</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597166616734c239726683-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WritingState</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734c239726683-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616734c239726683-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734c239726683-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616734c239726683-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734c239726683-6\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">UpperCase</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WritingState</span></div><div class=\"crayon-line\" id=\"crayon-597166616734c239726683-7\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734c239726683-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-597166616734c239726683-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734c239726683-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">strtoupper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616734c239726683-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734c239726683-12\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616734c239726683-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734c239726683-14\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LowerCase</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WritingState</span></div><div class=\"crayon-line\" id=\"crayon-597166616734c239726683-15\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734c239726683-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-597166616734c239726683-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734c239726683-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">strtolower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616734c239726683-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734c239726683-20\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616734c239726683-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734c239726683-22\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">Default</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">implements</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WritingState</span></div><div class=\"crayon-line\" id=\"crayon-597166616734c239726683-23\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734c239726683-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-597166616734c239726683-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734c239726683-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616734c239726683-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734c239726683-28\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>然后是文本编辑器</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597166616734f386952497\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass TextEditor\r\n{\r\n    protected $state;\r\n\r\n    public function __construct(WritingState $state)\r\n    {\r\n        $this-&gt;state = $state;\r\n    }\r\n\r\n    public function setState(WritingState $state)\r\n    {\r\n        $this-&gt;state = $state;\r\n    }\r\n\r\n    public function type(string $words)\r\n    {\r\n        $this-&gt;state-&gt;write($words);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597166616734f386952497-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734f386952497-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597166616734f386952497-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734f386952497-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597166616734f386952497-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734f386952497-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597166616734f386952497-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734f386952497-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597166616734f386952497-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734f386952497-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-597166616734f386952497-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734f386952497-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-597166616734f386952497-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734f386952497-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-597166616734f386952497-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734f386952497-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-597166616734f386952497-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616734f386952497-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-597166616734f386952497-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597166616734f386952497-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TextEditor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734f386952497-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616734f386952497-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734f386952497-4\"> </div><div class=\"crayon-line\" id=\"crayon-597166616734f386952497-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__construct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">WritingState</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734f386952497-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616734f386952497-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734f386952497-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616734f386952497-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734f386952497-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">WritingState</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-597166616734f386952497-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734f386952497-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616734f386952497-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734f386952497-14\"> </div><div class=\"crayon-line\" id=\"crayon-597166616734f386952497-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734f386952497-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616734f386952497-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">state</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616734f386952497-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616734f386952497-19\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>用法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167352473001436\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$editor = new TextEditor(new Default());\r\n\r\n$editor-&gt;type('First line');\r\n\r\n$editor-&gt;setState(new UpperCase());\r\n\r\n$editor-&gt;type('Second line');\r\n$editor-&gt;type('Third line');\r\n\r\n$editor-&gt;setState(new LowerCase());\r\n\r\n$editor-&gt;type('Fourth line');\r\n$editor-&gt;type('Fifth line');\r\n\r\n// Output:\r\n// First line\r\n// SECOND LINE\r\n// THIRD LINE\r\n// fourth line\r\n// fifth line</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167352473001436-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167352473001436-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167352473001436-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167352473001436-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167352473001436-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167352473001436-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167352473001436-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167352473001436-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971666167352473001436-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167352473001436-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971666167352473001436-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167352473001436-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971666167352473001436-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167352473001436-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971666167352473001436-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167352473001436-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971666167352473001436-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167352473001436-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5971666167352473001436-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167352473001436-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167352473001436-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TextEditor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">Default</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167352473001436-2\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167352473001436-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'First line'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167352473001436-4\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167352473001436-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">setState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">UpperCase</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167352473001436-6\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167352473001436-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Second line'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167352473001436-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Third line'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167352473001436-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167352473001436-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">setState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LowerCase</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167352473001436-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167352473001436-12\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Fourth line'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167352473001436-13\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">editor</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Fifth line'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167352473001436-14\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167352473001436-15\"><span class=\"crayon-c\">// Output:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167352473001436-16\"><span class=\"crayon-c\">// First line</span></div><div class=\"crayon-line\" id=\"crayon-5971666167352473001436-17\"><span class=\"crayon-c\">// SECOND LINE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167352473001436-18\"><span class=\"crayon-c\">// THIRD LINE</span></div><div class=\"crayon-line\" id=\"crayon-5971666167352473001436-19\"><span class=\"crayon-c\">// fourth line</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167352473001436-20\"><span class=\"crayon-c\">// fifth line</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p></p>\n<h3>📒 模板方法模式</h3>\n<h4>现实生活示例</h4>\n<p>假设我们要造一座房子，建造的大体步骤如下：</p>\n<ul>\n<li>打地基</li>\n<li>垒墙</li>\n<li>封顶</li>\n<li>铺地板</li>\n</ul>\n<p>这些步骤的顺序不能被打乱，比如说，你不能在垒墙之前先封顶。但是其中的每一步可以定制，比如墙的材料可以使用木头、聚酯纤维或者石头。</p>\n<h4>概述</h4>\n<p>模板方法模式定义了如何执行某种算法的框架，但是将这些步骤的实现推迟到子类中。</p>\n<h4>维基百科</h4>\n<p>在软件工程中，模板方法模式是一种行为设计模式，用于定义操作中算法的程序框架，将一些步骤推迟到子类实现。它允许在不改变算法结构的情况下重新定义算法的某些步骤。</p>\n<p><strong>程序示例</strong></p>\n<p>假如我们有一个构建工具，可以帮助我们测试，构建并生成构建报告（即代码覆盖报告，linting报告等），并将应用程序部署到测试服务器上。</p>\n<p>首先是用于确定构建算法框架的基类</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5971666167356448684069\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nabstract class Builder\r\n{\r\n\r\n    // Template method\r\n    final public function build()\r\n    {\r\n        $this-&gt;test();\r\n        $this-&gt;lint();\r\n        $this-&gt;assemble();\r\n        $this-&gt;deploy();\r\n    }\r\n\r\n    abstract public function test();\r\n    abstract public function lint();\r\n    abstract public function assemble();\r\n    abstract public function deploy();\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5971666167356448684069-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167356448684069-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5971666167356448684069-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167356448684069-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5971666167356448684069-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167356448684069-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5971666167356448684069-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167356448684069-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5971666167356448684069-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167356448684069-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5971666167356448684069-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167356448684069-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5971666167356448684069-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167356448684069-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5971666167356448684069-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5971666167356448684069-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5971666167356448684069-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5971666167356448684069-1\"><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Builder</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167356448684069-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167356448684069-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167356448684069-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// Template method</span></div><div class=\"crayon-line\" id=\"crayon-5971666167356448684069-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167356448684069-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5971666167356448684069-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167356448684069-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">lint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167356448684069-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">assemble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167356448684069-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">deploy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167356448684069-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167356448684069-12\"> </div><div class=\"crayon-line\" id=\"crayon-5971666167356448684069-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167356448684069-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167356448684069-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">assemble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5971666167356448684069-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">abstract</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">deploy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5971666167356448684069-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>然后提供一些基类的实现</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597166616735a287706683\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass AndroidBuilder extends Builder\r\n{\r\n    public function test()\r\n    {\r\n        echo 'Running android tests';\r\n    }\r\n\r\n    public function lint()\r\n    {\r\n        echo 'Linting the android code';\r\n    }\r\n\r\n    public function assemble()\r\n    {\r\n        echo 'Assembling the android build';\r\n    }\r\n\r\n    public function deploy()\r\n    {\r\n        echo 'Deploying android build to server';\r\n    }\r\n}\r\n\r\nclass IosBuilder extends Builder\r\n{\r\n    public function test()\r\n    {\r\n        echo 'Running ios tests';\r\n    }\r\n\r\n    public function lint()\r\n    {\r\n        echo 'Linting the ios code';\r\n    }\r\n\r\n    public function assemble()\r\n    {\r\n        echo 'Assembling the ios build';\r\n    }\r\n\r\n    public function deploy()\r\n    {\r\n        echo 'Deploying ios build to server';\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735a287706683-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-597166616735a287706683-45\">45</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AndroidBuilder</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Builder</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Running android tests'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Linting the android code'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-12\"> </div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">assemble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Assembling the android build'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">deploy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Deploying android build to server'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-22\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-24\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IosBuilder</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Builder</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-25\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Running ios tests'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-30\"> </div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Linting the ios code'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">assemble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Assembling the ios build'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-40\"> </div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">deploy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Deploying ios build to server'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735a287706683-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-597166616735a287706683-45\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0051 seconds] -->\r\n<p>用法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-597166616735d369003631\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$androidBuilder = new AndroidBuilder();\r\n$androidBuilder-&gt;build();\r\n\r\n// Output:\r\n// Running android tests\r\n// Linting the android code\r\n// Assembling the android build\r\n// Deploying android build to server\r\n\r\n$iosBuilder = new IosBuilder();\r\n$iosBuilder-&gt;build();\r\n\r\n// Output:\r\n// Running ios tests\r\n// Linting the ios code\r\n// Assembling the ios build\r\n// Deploying ios build to server</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-597166616735d369003631-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735d369003631-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-597166616735d369003631-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735d369003631-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-597166616735d369003631-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735d369003631-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-597166616735d369003631-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735d369003631-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-597166616735d369003631-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735d369003631-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-597166616735d369003631-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735d369003631-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-597166616735d369003631-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735d369003631-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-597166616735d369003631-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-597166616735d369003631-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-597166616735d369003631-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-597166616735d369003631-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">androidBuilder</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AndroidBuilder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735d369003631-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">androidBuilder</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616735d369003631-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735d369003631-4\"><span class=\"crayon-c\">// Output:</span></div><div class=\"crayon-line\" id=\"crayon-597166616735d369003631-5\"><span class=\"crayon-c\">// Running android tests</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735d369003631-6\"><span class=\"crayon-c\">// Linting the android code</span></div><div class=\"crayon-line\" id=\"crayon-597166616735d369003631-7\"><span class=\"crayon-c\">// Assembling the android build</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735d369003631-8\"><span class=\"crayon-c\">// Deploying android build to server</span></div><div class=\"crayon-line\" id=\"crayon-597166616735d369003631-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735d369003631-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iosBuilder</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IosBuilder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-597166616735d369003631-11\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iosBuilder</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735d369003631-12\"> </div><div class=\"crayon-line\" id=\"crayon-597166616735d369003631-13\"><span class=\"crayon-c\">// Output:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735d369003631-14\"><span class=\"crayon-c\">// Running ios tests</span></div><div class=\"crayon-line\" id=\"crayon-597166616735d369003631-15\"><span class=\"crayon-c\">// Linting the ios code</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-597166616735d369003631-16\"><span class=\"crayon-c\">// Assembling the ios build</span></div><div class=\"crayon-line\" id=\"crayon-597166616735d369003631-17\"><span class=\"crayon-c\">// Deploying ios build to server</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p></p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/a9e67955472c1afcad111aa202984192.jpg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111797\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111797votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111797\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/justin_ygg\">Justin_YGG</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/justin_ygg\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/4302cabf679254e36d325f1d9185b6c72.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            Python工程师一枚，对go、docker感兴趣，还在成长ing~~        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/justin_ygg\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/justin_ygg/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/justin_ygg/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-07-17", "vote": " ", "front_image_path": "full/ae5704bda1df1c07deb1efa5f979b89054301d53.jpg", "title": "人人都能读懂的设计模式（3）：行为型模式", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/ef9bd8829d4a02c071feb1af9522d6ab.png"]},
{"comment_nums": 0, "url_object_id": "99c1959be1169340bfefafd21c8b2fdd", "url": "http://blog.jobbole.com/111880/", "tags": ["IT技术", "分库分表", "数据库"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/bluishglc/article/details/7793172\">Laurence的技术博客</a>   </div><p>系统经sharding改造之后，原来单一的数据库会演变成多个数据库，如何确保多数据源同时操作的原子性和一致性是不得不考虑的一个问题。总体上看，目前对于一个分布式系统的事务处理有三种方式：分布式事务、基于Best Efforts 1PC模式的事务以及事务补偿机制。我们下面对这三种处理方式一一进行分析。</p>\n<p><strong>分布式事务</strong></p>\n<p>这是最为人们所熟知的多数据源事务处理机制。本文并不打算对分布式事务做过多介绍，读者可参考此文：<a href=\"http://blog.csdn.net/bluishglc/article/details/7612811\" target=\"_blank\">关于分布式事务、两阶段提交、一阶段提交、Best Efforts 1PC模式和事务补偿机制的研究 </a>。在这里只想对分布式事务的利弊作一下分析。</p>\n<p>优势：</p>\n<blockquote><p>1. 基于两阶段提交，最大限度地保证了跨数据库操作的“原子性”，是分布式系统下最严格的事务实现方式。<br>\n2. 实现简单，工作量小。由于多数应用服务器以及一些独立的分布式事务协调器做了大量的封装工作，使得项目中引入分布式事务的难度和工作量基本上可以忽略不计。</p></blockquote>\n<p>劣势：</p>\n<blockquote><p>系统“水平”伸缩的死敌。基于两阶段提交的分布式事务在提交事务时需要在多个节点之间进行协调,最大限度地推后了提交事务的时间点，客观上延长了事务的执行时间，这会导致事务在访问共享资源时发生冲突和死锁的概率增高，随着数据库节点的增多，这种趋势会越来越严重，从而成为系统在数据库层面上水平伸缩的”枷锁”， 这是很多Sharding系统不采用分布式事务的主要原因。</p></blockquote>\n<p><strong>基于Best Efforts 1PC模式的事务</strong></p>\n<p>与分布式事务采用的两阶段提交不同，Best Efforts 1PC模式采用的是一阶段端提交，牺牲了事务在某些特殊情况(当机、网络中断等)下的安全性，却获得了良好的性能，特别是消除了对水平伸缩的桎酷。<a href=\"http://www.javaworld.com/javaworld/jw-01-2009/jw-01-spring-transactions.html?page=5\" target=\"_blank\">Distributed transactions in Spring, with and without XA</a>一文对Best Efforts 1PC模式进行了详细的说明，该文提供的Demo代码更是直接给出了在Spring环境下实现一阶段提交的多数据源事务管理示例。不过需要注意的是，原示例是基于spring 3.0之前的版本，如果你使用spring 3.0+,会得到如下错误：<strong>java.lang.IllegalStateException: Cannot activate transaction synchronization – already active</strong>，如果使用spring 3.0+，你需要参考<a href=\"https://github.com/SpringSource/spring-data-graph/blob/master/spring-data-neo4j/src/main/java/org/springframework/data/neo4j/transaction/ChainedTransactionManager.java\" target=\"_blank\">spring-data-neo4j</a>的实现。鉴于Best Efforts 1PC模式的性能优势，以及相对简单的实现方式，它被大多数的sharding框架和项目采用。</p>\n<p><strong>事务补偿机制</strong></p>\n<p>对于那些对性能要求很高，但对一致性要求并不高的系统，往往并不苛求系统的实时一致性，只要在一个允许的时间周期内达到最终一致性即可，这使得事务补偿机制成为一种可行的方案。事务补偿机制最初被提出是在“长事务”的处理中，但是对于分布式系统确保一致性也有很好的参考意义。笼统地讲，与事务在执行中发生错误后立即回滚的方式不同，事务补偿是一种事后检查并补救的措施，它只期望在一个容许时间周期内得到最终一致的结果就可以了。事务补偿的实现与系统业务紧密相关，并没有一种标准的处理方式。一些常见的实现方式有：对数据进行对帐检查;基于日志进行比对;定期同标准数据来源进行同步，等等。</p>\n<p><strong>小结</strong></p>\n<p>分布式事务，最严格的事务实现，但性能是个大问题;Best Efforts 1PC模式，性能与事务可靠性的平衡，支持系统水平伸缩，大多数情况下是最合适的选择;事务补偿机制，只能适用于对事务性要求不高，允许数据“最终一致”即可的系统，牺牲实时一致性，获得最大的性能回报。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111880\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111880votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111880\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-07-18", "vote": " ", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg", "title": "DB 分库分表（4）：多数据源的事务处理", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"]},
{"comment_nums": 3, "url_object_id": "a91e0b50334a75b7a782e2c16dff83d3", "url": "http://blog.jobbole.com/111892/", "tags": ["职场", " 3 评论 ", "DHH"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/aoi\">伯小乐</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>问：代码写的好，出过畅销书，并且还拿过赛车冠军，这是一种什么体验？</p>\n<p>答：这事得问 DHH。什么？你不知道 DHH 是哪个程序员，那你更得看看这篇文章了。😀</p>\n<p>（ps：以前伯乐在线扩散《<a href=\"http://blog.jobbole.com/110811/\" target=\"_blank\">我是小有成就，但我过不了白板面试</a>》这篇文章时，曾有读者问 DHH 是何许人也。）</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhnu0fdsm9j20dw09bgos.jpg\"></p>\n<p>DHH 是一个丹麦程序员，全名是 David Heinemeier Hansson，DHH 是他的全名首字母缩写，也是他常用的网名。1979 年 10 月 15 日出生在哥本哈根。</p>\n<h3>Ruby On Rails 的诞生</h3>\n<p>1999 年，20 岁的 DHH 成立了一个丹麦语的游戏资讯和社区网站 Daily Rush，一直运营到 2001 年。</p>\n<p>后来因其 PHP 编程能力，吸引到 37signals 联合创始人 Jason Fried 的注意，后被 Jason 招入37signals 开发一个在线版的项目管理工具。该工具也就是后来 37signals 的 SasS 产品 Basecamp。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fhnuqwp1i0j21kw0w0ajk.jpg\" width=\"601\" height=\"338\"></p>\n<p style=\"text-align: center;\">（图：37signals 联合创始人 Jason Fried）</p>\n<p>为了加速 Basecamp 开发，DHH 用 Ruby 开发了一个框架，即 Ruby On Rails。2004 年 7 月，DHH 把 Rails 从 Basecamp 中剥离出来，并且开源。Rails 初期并没有开放 commit 权限，2005 年 2 月才向外开放。</p>\n<p>因其 Rails 的贡献，DHH 获得 Google 和 O’Reilly 联合颁发的「2005 年度最佳 Hacker」奖。</p>\n<p>2006 年 8 月，Rails 迎来一个重要里程碑，苹果公司宣布 Mac OS X v10.5 Leopard 预装 Rails 框架。</p>\n<p>2007 年，DHH 注册了 3 个商标：RUBY ON RAILS 短语、RAILS 以及 Rails 官方标志。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fhnw217rahj20go0gogm2.jpg\" width=\"300\" height=\"300\"></p>\n<p>Rails 的（企业）用户很多，包括 GitHub、Shopify、 Airbnb 和 Square 等。</p>\n<h3>移居美国</h3>\n<p>2005 年，DHH 从哥本哈根商学院毕业，拿到计算机科学和企业管理双学位。同年 11 月，从丹麦移居到美国芝加哥。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhns0wk3zrj20jb0avt9s.jpg\" width=\"601\" height=\"338\"></p>\n<p>DHH 后来成为了 37signals 的联合创始人兼 CTO。</p>\n<p>37signals 公司在 2014 年更名为 Basecamp。</p>\n<h3>写书</h3>\n<p>DHH 和 Jason 合著了 3 本畅销书：</p>\n<p>2006 年的《<a href=\"http://gettingreal.37signals.com/\" target=\"_blank\">Getting Real</a>》，2010 年的《Rework》，和 2013 年的《Remote》。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fho1d0td36j20im0cewg8.jpg\" width=\"601\" height=\"400\"></p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fho1d0b23lj20ic0cqt9o.jpg\" width=\"601\" height=\"417\"></p>\n<h3>赛车</h3>\n<p>DHH 有两大业余爱好：赛车和摄影。</p>\n<p>从 2013 年到 2017 年，连续 5 年参加国际汽联世界耐力锦标赛（FIA WEC）。2014 年，在「勒芒 24 小时耐力赛」个人排名 82 位。他所在车队赢得 GTE-AM 组的冠军。</p>\n<p>补充介绍：</p>\n<blockquote><p>勒芒 24 小时耐力赛：3 位车手为一个车组，驾驶一台赛车，完成连续 24 个小时的竞赛。它和世界一级方程式锦标赛(F1)、世界汽车拉力锦标赛(WRC)，并称为世界最著名和最艰苦的三大汽车赛事。</p>\n<p>勒芒耐力赛分 4 个组别：LMP1、LMP2、GTE-PRO，GTE-AM。</p>\n<p>GTE-AM：允许封闭座舱以及开放式座舱，2车门，2或2+2坐席，所使用的赛车为市面上可以够买到的量产车改装而成，但赛车车龄必须大于 12 个月，每辆车内必须包含有业余车手。</p></blockquote>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhns9tpacyj20h30b4wg9.jpg\" width=\"600\" height=\"390\"></p>\n<blockquote><p>注意 DHH 的赛车服，前胸的 Basecamp.com、脖颈的 Basecamp.com 和 logo，还有左臂的 37signals logo，开车还不忘给自家公司做宣传。´</p></blockquote>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhns9sfhyuj20rs0fu75o.jpg\" width=\"600\" height=\"342\"></p>\n<p>五年来，DHH 参加 FIA WEC 36 场比赛，16 次上领奖台，赢过 6 次分站冠军，2 次锦标赛亚军，1 次锦标赛冠军。</p>\n<p>5 次参加勒芒耐力赛（无退赛），3 次上领奖台，获得 1 次冠军。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fho726yopzj21kw1kwqow.jpg\" width=\"640\" height=\"640\"></p>\n<p style=\"text-align: center;\">（DHH 参加比赛的车）</p>\n<h3>摄影</h3>\n<p>除了赛车，DHH 还有一大爱好 —— 摄影。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fho3eotjxrj20hs0bvadi.jpg\" width=\"640\" height=\"427\"></p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fho3es3f93j20hs0bwjv1.jpg\" width=\"640\" height=\"428\"></p>\n<p>DHH 已婚，妻子 Jamie。他们有 2 个儿子：Colt 和 Dash。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fho7266uh9j20m80m81i9.jpg\" width=\"690\" height=\"690\"></p>\n<p>DHH 一家四口的时间，主要在芝加哥、加州的马里布，西班牙的马贝拉之间切换度过。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111892\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111892votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111892\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">伯小乐</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/11/f2bb4f6f428a49476a2e91c355c8d150.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            伯乐在线小编一枚~~~~PS：我不是@小编辑，不要问我了        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/aoi\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/aoi/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/aoi/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 245</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-07-18", "vote": " ", "front_image_path": "full/0f76dcd24f8a5d0095b676d974e274b9e9914d81.jpg", "title": "代码写的好，出过畅销书，还拿过赛车冠军，这是一种什么体验？", "front_image_url": ["http://wx3.sinaimg.cn/large/7cc829d3gy1fhns9tpacyj20h30b4wg9.jpg"]},
{"comment_nums": 0, "url_object_id": "cca88c074547b53fcc59c01e5736f847", "url": "http://blog.jobbole.com/111927/", "tags": ["IT技术", "分库分表", "数据库"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/bluishglc/article/details/7970268\">Laurence的技术博客，首发《程序员》杂志</a>   </div><p>作为一种数据存储层面上的水平伸缩解决方案，数据库Sharding技术由来已久，很多海量数据系统在其发展演进的历程中都曾经历过分库分表的Sharding改造阶段。简单地说，Sharding就是将原来单一数据库按照一定的规则进行切分，把数据分散到多台物理机（我们称之为Shard)上存储，从而突破单机限制，使系统能以Scale-Out的方式应对不断上涨的海量数据，但是这种切分对上层应用来说是透明的，多个物理上分布的数据库在逻辑上依然是一个库。实现Sharding需要解决一系列关键的技术问题，这些问题主要包括：切分策略、节点路由、全局主键生成、跨节点排序/分组/表关联、多数据源事务处理和数据库扩容等。本文将重点围绕“数据库扩容”进行深入讨论，并提出一种允许自由规划并能避免数据迁移和修改路由代码的Sharding扩容方案。</p>\n<h3><strong>Sharding扩容——系统维护不能承受之重</strong></h3>\n<p>任何Sharding系统，在上线运行一段时间后，数据就会积累到当前节点规模所能承载的上限，此时就需要对数据库进行扩容了，也就是增加新的物理结点来分摊数据。如果系统使用的是基于ID进行散列的路由方式，那么团队需要根据新的节点规模重新计算所有数据应处的目标Shard，并将其迁移过去，这对团队来说无疑是一个巨大的维护负担；而如果系统是按增量区间进行路由(如每1千万条数据或是每一个月的数据存放在一个节点上 )，虽然可以避免数据的迁移，却有可能带来“热点”问题，也就是近期系统的读写都集中在最新创建的节点上(很多系统都有此类特点：新生数据的读写频率明显高于旧有数据)，从而影响了系统性能。面对这种两难的处境，Sharding扩容显得异常困难。</p>\n<p>一般来说，“理想”的扩容方案应该努力满足以下几个要求：</p>\n<ol>\n<li> 最好不迁移数据 （无论如何，数据迁移都是一个让团队压力山大的问题）</li>\n<li>允许根据硬件资源自由规划扩容规模和节点存储负载</li>\n<li>能均匀的分布数据读写，避免“热点”问题</li>\n<li>保证对已经达到存储上限的节点不再写入数据</li>\n</ol>\n<p>目前，能够避免数据迁移的优秀方案并不多，相对可行的有两种，一种是维护一张记录数据ID和目标Shard对应关系的映射表，写入时，数据都写入新扩容的Shard，同时将ID和目标节点写入映射表，读取时，先查映射表，找到目标Shard后再执行查询。该方案简单有效，但是读写数据都需要访问两次数据库，且映射表本身也极易成为性能瓶颈。为此系统不得不引入分布式缓存来缓存映射表数据，但是这样也无法避免在写入时访问两次数据库，同时大量映射数据对缓存资源的消耗以及专门为此而引入分布式缓存的代价都是需要权衡的问题。另一种方案来自淘宝综合业务平台团队，它利用对2的倍数取余具有向前兼容的特性（如对4取余得1的数对2取余也是1）来分配数据，避免了行级别的数据迁移，但是依然需要进行表级别的迁移，同时对扩容规模和分表数量都有限制。总得来说，这些方案都不是十分的理想，多多少少都存在一些缺点，这也从一个侧面反映出了Sharding扩容的难度。</p>\n<h3><strong>取长补短，兼容并包——一种理想的Sharding扩容方案</strong></h3>\n<p>如前文所述，Sharding扩容与系统采用的路由规则密切相关：基于散列的路由能均匀地分布数据，但却需要数据迁移，同时也无法避免对达到上限的节点不再写入新数据；基于增量区间的路由天然不存在数据迁移和向某一节点无上限写入数据的问题，但却存在“热点”困扰。我们设计方案的初衷就是希望能结合两种路由规则的优势，摒弃各自的劣势，创造出一种接近“理想”状态的扩容方式，而这种方式简单概括起来就是：全局按增量区间分布数据，使用增量扩容，无数据迁移，局部使用散列方式分散数据读写，解决“热点”问题，同时对Sharding拓扑结构进行建模，使用一致的路由算法，扩容时只需追加节点数据，不再修改散列逻辑代码。</p>\n<h3><strong>原理</strong></h3>\n<p>首先，作为方案的基石，为了能使系统感知到Shard并基于Shard的分布进行路由计算，我们需要建立一个可以描述Sharding拓扑结构的编程模型。按照一般的切分原则，一个单一的数据库会首先进行垂直切分，垂直切分只是将关系密切的表划分在一起，我们把这样分出的一组表称为一个Partition。 接下来，如果Partition里的表数据量很大且增速迅猛，就再进行水平切分，水平切分会将一张表的数据按增量区间或散列方式分散到多个Shard上存储。在我们的方案里，我们使用增量区间与散列相结合的方式，全局上，数据按增量区间分布，但是每个增量区间并不是按照某个Shard的存储规模划分的，而是根据一组Shard的存储总量来确定的，我们把这样的一组Shard称为一个ShardGroup，局部上，也就是一个ShardGroup内，记录会再按散列方式均匀分布到组内各Shard上。这样，一条数据的路由会先根据其ID所处的区间确定ShardGroup，然后再通过散列命中ShardGroup内的某个目标Shard。在每次扩容时，我们会引入一组新的Shard，组成一个新的ShardGroup，为其分配增量区间并标记为“可写入”，同时将原有ShardGroup标记为“不可写入”，于是新生数据就会写入新的ShardGroup，旧有数据不需要迁移。同时，在ShardGroup内部各Shard之间使用散列方式分布数据读写，进而又避免了“热点”问题。最后，在Shard内部，当单表数据达到一定上限时，表的读写性能就开始大幅下滑，但是整个数据库并没有达到存储和负载的上限，为了充分发挥服务器的性能，我们通常会新建多张结构一样的表，并在新表上继续写入数据，我们把这样的表称为“分段表”（Fragment Table）。不过，引入分段表后所有的SQL在执行前都需要根据ID将其中的表名替换成真正的分段表名，这无疑增加了实现Sharding的难度，如果系统再使用了某种ORM框架，那么替换起来可能会更加困难。目前很多数据库提供一种与分段表类似的“分区”机制，但没有分段表的副作用，团队可以根据系统的实现情况在分段表和分区机制中灵活选择。总之，基于上述切分原理，我们将得到如下Sharding拓扑结构的领域模型：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/b6a6923203f3865db3481b3ac4c3103a.jpg\" alt=\"\" width=\"591\" height=\"483\"></p>\n<p style=\"text-align: center\">图1. Sharding拓扑结构领域模型</p>\n<p>在这个模型中，有几个细节需要注意：ShardGroup的writable属性用于标识该ShardGroup是否可以写入数据，一个Partition在任何时候只能有一个ShardGroup是可写的，这个ShardGroup往往是最近一次扩容引入的；startId和endId属性用于标识该ShardGroup的ID增量区间；Shard的hashValue属性用于标识该Shard节点接受哪些散列值的数据；FragmentTable的startId和endId是用于标识该分段表储存数据的ID区间。</p>\n<p>确立上述模型后，我们需要通过配置文件或是在数据库中建立与之对应的表来存储节点元数据，这样，整个存储系统的拓扑结构就可以被持久化起来，系统启动时就能从配置文件或数据库中加载出当前的Sharding拓扑结构进行路由计算了（如果结点规模并不大可以使用配置文件，如果节点规模非常大，需要建立相关表结构存储这些结点元数据。从最新的Oracle发布的《面向大规模可伸缩网站基础设施的MySQL参考架构》白皮书一文的“超大型系统架构参考”章节给出的架构图中我们可以看到一种名为：Shard Catalog的专用服务器，这个其实是保存结点配置信息的数据库），扩容时只需要向对应的文件或表中加入相关的节点信息重启系统即可，不需要修改任何路由逻辑代码。</p>\n<h3><strong>示例</strong></h3>\n<p>让我们通过示例来了解这套方案是如何工作的。</p>\n<p><strong>阶段一：初始上线</strong></p>\n<p>假设某系统初始上线，规划为某表提供4000W条记录的存储能力，若单表存储上限为1000W条，单库存储上限为2000W条，共需2个Shard，每个Shard包含两个分段表，ShardGroup增量区间为0-4000W，按2取余分散到2个Shard上，具体规划方案如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6a4da76f81d438d240c54afe5124d2ab.jpg\" alt=\"\" width=\"591\" height=\"310\"></p>\n<p style=\"text-align: center\">图2. 初始4000W存储规模的规划方案</p>\n<p>与之相适应，Sharding拓扑结构的元数据如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/09fcb6013304ed5a0bd37962856c02c7.jpg\" alt=\"\" width=\"467\" height=\"388\"></p>\n<p style=\"text-align: center\">图3. 对应Sharding元数据</p>\n<p><strong>阶段二：系统扩容</strong></p>\n<p>经过一段时间的运行，当原表总数据逼近4000W条上限时，系统就需要扩容了。为了演示方案的灵活性，我们假设现在有三台服务器Shard2、Shard3、Shard4，其性能和存储能力表现依次为Shard2&lt;Shard3&lt;Shard4，我们安排Shard2储存1000W条记录，Shard3储存2000W条记录，Shard4储存3000W条记录，这样，该表的总存储能力将由扩容前的4000W条提升到10000W条，以下是详细的规划方案：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2375c89746d023b9ddcbb20f653c3b3b.jpg\" alt=\"\" width=\"802\" height=\"278\"></p>\n<p style=\"text-align: center\">图4. 二次扩容6000W存储规模的规划方案</p>\n<p>相应拓扑结构表数据下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/dfae7a7e6e53f086c125982d8bbc8132.jpg\" alt=\"\" width=\"474\" height=\"471\"></p>\n<p style=\"text-align: center\">图5. 对应Sharding元数据</p>\n<p>从这个扩容案例中我们可以看出该方案允许根据硬件情况进行灵活规划，对扩容规模和节点数量没有硬性规定，是一种非常自由的扩容方案。</p>\n<h3><strong>增强</strong></h3>\n<p>接下来让我们讨论一个高级话题：对“再生”存储空间的利用。对于大多数系统来说，历史数据较为稳定，被更新或是删除的概率并不高，反映到数据库上就是历史Shard的数据量基本保持恒定，但也不排除某些系统其数据有同等的删除概率，甚至是越老的数据被删除的可能性越大，这样反映到数据库上就是历史Shard随着时间的推移，数据量会持续下降，在经历了一段时间后，节点就会腾出很大一部分存储空间，我们把这样的存储空间叫“再生”存储空间，如何有效利用再生存储空间是这些系统在设计扩容方案时需要特别考虑的。回到我们的方案，实际上我们只需要在现有基础上进行一个简单的升级就可以实现对再生存储空间的利用，升级的关键就是将过去ShardGroup和FragmentTable的单一的ID区间提升为多重ID区间。为此我们把ShardGroup和FragmentTable的ID区间属性抽离出来，分别用ShardGroupInterval和FragmentTableIdInterval表示，并和它们保持一对多关系。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/eb93f0a9d14f8dd2f21535aaa611eb66.jpg\" alt=\"\" width=\"550\" height=\"629\"></p>\n<p style=\"text-align: center\">图6. 增强后的Sharding拓扑结构领域模型</p>\n<p>让我们还是通过一个示例来了解升级后的方案是如何工作的。</p>\n<p><strong>阶段三：不扩容，重复利用再生存储空间</strong></p>\n<p>假设系统又经过一段时间的运行之后，二次扩容的6000W条存储空间即将耗尽，但是由于系统自身的特点，早期的很多数据被删除，Shard0和Shard1又各自腾出了一半的存储空间，于是ShardGroup0总计有2000W条的存储空间可以重新利用。为此，我们重新将ShardGroup0标记为writable=true，并给它追加一段ID区间：10000W-12000W，进而得到如下规划方案：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9aefceaacb575a4a218b4444b710525c.jpg\" alt=\"\" width=\"518\" height=\"312\"></p>\n<p style=\"text-align: center\">图7. 重复利用2000W再生存储空间的规划方案</p>\n<p>相应拓扑结构的元数据如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7174be65f86f3158fbeae47d88984408.jpg\" alt=\"\" width=\"713\" height=\"382\"></p>\n<p style=\"text-align: center\">图8. 对应Sharding元数据</p>\n<h3><strong>小结</strong></h3>\n<p>这套方案综合利用了增量区间和散列两种路由方式的优势，避免了数据迁移和“热点”问题，同时，它对Sharding拓扑结构建模，使用了一致的路由算法，从而避免了扩容时修改路由代码，是一种理想的Sharding扩容方案。</p>\n<p><a href=\"http://blog.csdn.net/bluishglc/article/details/6161475\" target=\"_blank\" name=\"6161475\"></a></p>\n<h1><a href=\"http://blog.csdn.net/bluishglc/article/details/6161475\" target=\"_blank\" name=\"6161475\"></a></h1>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111927\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111927votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111927\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-07-19", "vote": " ", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg", "title": "DB 分库分表（5）：一种支持自由规划无须数据迁移和修改路由代码的 Sharding 扩容方案", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"]},
{"comment_nums": 0, "url_object_id": "9ce14fbc71c2b3562272365d741946ba", "url": "http://blog.jobbole.com/111930/", "tags": ["IT技术", "数据库"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.iteye.com/news/32473\">首发《程序员》杂志</a>   </div><div>\n<blockquote>作者：雷鹏，Terark核心技术发明人。曾就职奇虎360，负责搜索引擎核心研发；曾就职Yahoo！北研所负责搜索广告、广告交易（AdExchange）等项目。在数据库、高性能计算、分布式、系统架构上都深有造诣。</blockquote>\n</div>\n<p>作为数据库，在系统资源（CPU、内存、SSD、磁盘等）一定的前提下，我们希望：</p>\n<ul>\n<li><strong>存储的数据更多：</strong>采用压缩，这个世界上有各种各样的压缩算法；</li>\n<li><strong>访问的速度更快：</strong>更快的压缩（写）/解压（读）算法、更大的缓存。</li>\n</ul>\n<p>几乎所有压缩算法都严重依赖上下文：</p>\n<ul>\n<li>位置相邻的数据，一般情况下相关性更高，内在冗余度更大；</li>\n<li>上下文越大，压缩率的上限越大（有极限值）。</li>\n</ul>\n<p><strong>块压缩</strong></p>\n<p><strong>传统数据库中的块压缩技术</strong></p>\n<p>对于普通的以数据块/文件为单位的压缩，传统的（流式）数据压缩算法工作得不错，时间长了，大家也都习惯了这种数据压缩的模式。基于这种模式的数据压缩算法层出不穷，不断有新的算法实现。包括使用最广泛的gzip、bzip2、Google的Snappy、新秀Zstd等。</p>\n<ul>\n<li>gzip几乎在在所有平台上都有支持，并且也已经成为一个行业标准，压缩率、压缩速度、解压速度都比较均衡；</li>\n<li>bzip2是基于BWT变换的一种压缩，本质是上对输入分块，每个块单独压缩，优点是压缩率很高，但压缩和解压速度都比较慢；</li>\n<li>Snappy是Google出品，优点是压缩和解压都很快，缺点是压缩率比较低，适用于对压缩率要求不高的实时压缩场景；</li>\n<li>LZ4是Snappy一个强有力的竞争对手，速度比Snappy更快，特别是解压速度；</li>\n<li>Zstd是一个压缩新秀，压缩率比LZ4和Snappy都高不少，压缩和解压速度略低；相比gzip，压缩率不相上下，但压缩/解压速度要高很多。</li>\n</ul>\n<p>对于数据库，在计算机世界的太古代，为I/O优化的Btree一直是不可撼动的，为磁盘优化的Btree block/page size比较大，正好让传统数据压缩算法能得到较大的上下文，于是，基于block/page的压缩也就自然而然地应用到了各种数据库中。在这个蛮荒时代，内存的性能、容量与磁盘的性能、容量泾渭分明，各种应用对性能的需求也比较小，大家都相安无事。</p>\n<p>现在，我们有了SSD、PCIe SSD、3D XPoint等，内存也越来越大，块压缩的缺点也日益突出：</p>\n<ul>\n<li>块选小了，压缩率不够；块选大了，性能没法忍；</li>\n<li>更致命的是，块压缩节省的只是更大更便宜的磁盘、SSD；</li>\n<li>更贵更小的内存不但没有节省，反而更浪费了（双缓存问题）。</li>\n</ul>\n<p>于是，对于很多实时性要求较高的应用，只能关闭压缩。</p>\n<p><strong>块压缩的原理</strong></p>\n<p>使用通用压缩技术（Snappy、LZ4、zip、bzip2、Zstd等），按块/页（block/page）进行压缩（块尺寸通常是4KB~32KB，以压缩率著称的TokuDB块尺寸是2MB~4MB），这个块是逻辑块，而不是内存分页、块设备概念中的那种物理块。</p>\n<p>启用压缩时，随之而来的是访问速度下降，这是因为：</p>\n<ul>\n<li>写入时，很多条记录被打包在一起压缩成一个个的块，增大块尺寸，压缩算法可以获得更大的上下文，从而提高压缩率；相反地，减小块尺寸，会降低压缩率。</li>\n<li>读取时，即便是读取很短的数据，也需要先把整个块解压，再去读取解压后的数据。这样，块尺寸越大，同一个块内包含的记录数目越多。为读取一条数据，所做的不必要解压就也就越多，性能也就越差。相反地，块尺寸越小，性能也就越好。</li>\n</ul>\n<p>一旦启用压缩，为了缓解以上问题，传统数据库一般都需要比较大的专用缓存，用来缓存解压后的数据，这样可以大幅提高热数据的访问性能，但又引起了双缓存的空间占用问题：一是操作系统缓存中的压缩数据；二是专用缓存（例如RocksDB中的DBCache）中解压后的数据。还有一个同样很严重的问题：专用缓存终归是缓存，当缓存未命中时，仍需要解压整个块，这就是慢Query问题的一个主要来源（慢Query的另一个主要来源是在操作系统缓存未命中时）。</p>\n<p>这些都导致现有传统数据库在访问速度和空间占用上是一个此消彼长、无法彻底解决的问题，只能采取一些折衷。</p>\n<p><strong>RocksDB 的块压缩</strong></p>\n<p>以RocksDB为例，RocksDB中的BlockBasedTable就是一个块压缩的SSTable，使用块压缩，索引只定位到块，块的尺寸在dboption里设定，一个块中包含多条（key，value）数据，例如M条，这样索引的尺寸就减小到了1/M：</p>\n<ul>\n<li>M越大，索引的尺寸越小；</li>\n<li>M越大，Block的尺寸越大，压缩算法（gzip、Snappy等）可以获得的上下文也越大，压缩率也就越高。</li>\n</ul>\n<p>创建BlockBasedTable时，Key Value被逐条填入buffer，当buffer尺寸达到预定大小（块尺寸，当然，一般buffer尺寸不会精确地刚好等于预设的块尺寸），就将buffer压缩并写入BlockBasedTable文件，并记录文件偏移和buffer中的第一个Key（创建index要用），如果单条数据太大，比预设的块尺寸还大，这条数据就单独占一个块（单条数据不管多大也不会分割成多个块）。所有Key Value写完以后，根据之前记录的每个块的起始Key和文件偏移，创建一个索引。所以在BlockBasedTable文件中，数据在前，索引在后，文件末尾包含元信息（作用相当于常用的FileHeader，只是位置在文件末尾，所以叫footer）。</p>\n<p>搜索时，先使用searchkey找到searchkey所在的block，然后到DB Cache中搜索这个块，找到后就进一步在块中搜索searchkey，如果找不到，就从磁盘/SSD读取这个块，解压后放入DB Cache。RocksDB中的DB Cache有多种实现，常用的包括LRU Cache，另外还有Clock Cache、Counting Cache（用来统计Cache命中率等），还有其他一些特殊的Cache。</p>\n<p>一般情况下，操作系统会有文件缓存，所以同一份数据可能既在DB Cache中（解压后的数据），又在操作系统Cache中（压缩的数据）。这样会造成内存浪费，所以RocksDB提供了一个折衷：在dboption中设置DIRECT_IO选项，绕过操作系统Cache，这样就只有DB Cache，可以节省一部分内存，但在一定程度上会降低性能。</p>\n<p><strong>传统非主流压缩：FM-Index</strong></p>\n<p>FM-Index的全名是Full Text Matching Index，属于Succinct Data Structure家族，对数据有一定的压缩能力，并且可以直接在压缩的数据上执行搜索和访问。</p>\n<p>FM-Index的功能非常丰富，历史也已经相当悠久，不算是一种新技术，在一些特殊场景下也已经得到了广泛应用，但是因为各种原因，一直不温不火。最近几年，FM-Index开始有些活跃，首先是GitHub上有个大牛实现了全套Succinct算法，其中包括FM-Index，其次Berkeley的Succinct项目也使用了FM-Index。</p>\n<p>FM-Index属于Offline算法（一次性压缩所有数据，压缩好之后不可修改），一般基于BWT变换（BWT变换基于后缀数组），压缩好的FM-Index支持以下两个最主要的操作：</p>\n<ul>\n<li>data = extract(offset, length)</li>\n<li>{offset} = search(string) ，返回多个匹配string的位置/偏移（offset）</li>\n</ul>\n<p>FM-Index还支持更多其他操作，感兴趣的朋友可以进一步调研。</p>\n<p>但是，在笔者看来，FM-Index有几个致命的缺点：</p>\n<ul>\n<li>实现太复杂（这一点可以被少数大牛们克服，不提也罢）；</li>\n<li>压缩率不高（比流式压缩例如gzip差太多）；</li>\n<li>搜索（search）和访问（extract）速度都很慢（在2016年最快的CPU i7-6700K上，单线程吞吐率不超过7MB/sec）；</li>\n<li>压缩过程又慢又耗内存（Berkeley的Succinct压缩过程内存消耗是源数据的50倍以上）；</li>\n<li>数据模型是Flat Text，不是数据库的KeyValue模型。</li>\n</ul>\n<p>可以用一种简单的方式把Flat Model转化成KeyValue Model：挑选一个在Key和Value中都不会出现的字符“#”（如果无法找出这样的字符，需要进行转义编码），每个Key前后都插入该字符，Key之后紧邻的就是Value。如此，search(#key#)返回了#key#出现的位置，我们就能很容易地拿到Value了。</p>\n<p>Berkeley的Succinc项目在FM-Index的Flat Text模型上实现了更丰富的行列（Row-Column）模型，付出了巨大的努力，达到了一定的效果，但离实用还相差太远。</p>\n<p>感兴趣的朋友可以仔细调研下FM-Index，以验证笔者的总结与判断。</p>\n<p><strong>Terark的可检索压缩（Searchable Compression）</strong></p>\n<p>Terark公司提出了“可检索压缩（Searchable Compression）”的概念，其核心也是直接在压缩的数据上执行搜索（search）和访问（extract），但数据模型本身就是KeyValue模型，根据其测试报告，速度要比FM-Index快得多（两个数量级），具体阐述：</p>\n<ul>\n<li>摒弃传统数据库的块压缩技术，采用全局压缩；</li>\n<li>对Key和Value使用不同的全局压缩技术；</li>\n<li>对Key使用有搜索功能的全局压缩技术COIndex（对应FM-Index的search）；</li>\n<li>对Value使用可定点访问的全局压缩技术PA-Zip（对应FM-Index的extract）。</li>\n</ul>\n<p><strong>对Key的压缩：CO-Index</strong></p>\n<p>我们需要对Key进行索引，才能有效地进行搜索，并访问需要的数据。</p>\n<p>普通的索引技术，索引的尺寸相对于索引中原始Key的尺寸要大很多，有些索引使用前缀压缩，能在一定程度上缓解索引的膨胀，但仍然无法解决索引占用内存过大的问题。</p>\n<p>我们提出了CO-Index（Compressed Ordered Index）的概念，并且通过一种叫做Nested Succinct Trie的数据结构实践了这一概念。</p>\n<p>较之传统实现索引的数据结构，Nested Succinct Trie的空间占用小十几倍甚至几十倍。而在保持该压缩率的同时，还支持丰富的搜索功能：</p>\n<ul>\n<li>精确搜索；</li>\n<li>范围搜索；</li>\n<li>顺序遍历；</li>\n<li>前缀搜索；</li>\n<li>正则表达式搜索（不是逐条遍历）。</li>\n</ul>\n<p>与FM-Index相比，CO-Index也有其优势（假定FM-Index中所有的数据都是Key）。</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0457b02458b4a0ba39b8c6364b7c78d4.png\"></div>\n<div style=\"text-align: center\">表1 FM-Index对比CO-Index</div>\n<p><strong>CO-Index的原理</strong></p>\n<p>实际上我们实现了很多种CO-Index，其中Nested Succinct Trie是适用性最广的一种，在这里对其原理做一个简单介绍：</p>\n<p><strong>Succinct Data Structure介绍</strong></p>\n<p>Succinct Data Structure是一种能够在接近于信息论下限的空间内来表达对象的技术，通常使用位图来表示，用位图上的rank和select来定位。</p>\n<p>虽然能够极大降低内存占用量，但实现起来较为复杂，并且性能低很多（时间复杂度的常数项很大）。目前开源的有SDSL-Lite，我们则使用自己实现的Rank-Select，性能也高于开源实现。</p>\n<p><strong>以二叉树为例</strong></p>\n<p>传统的表现形式是一个结点中包含两个指针：struct Node { Node *left, *right; };</p>\n<p>每个结点占用 2ptr，如果我们对传统方法进行优化，结点指针用最小的bits数来表达，N个结点就需要2*[log2(N)]个bits。</p>\n<ul>\n<li>对比传统基本版和传统优化版，假设共有216个结点（包括null结点），传统优化版需要2 bytes，传统基本版需要4/8 bytes。</li>\n<li>对比传统优化版和Succinct，假设共有10亿(~230)个结点。</li>\n<li>传统优化版每个指针占用[log2(230)]=30bits，总内存占用：($frac{2*30}{8}$)*230≈ 7.5GB。</li>\n<li>使用Succinct，占用：($frac{2.5}{8}$)*230≈ 312.5MB(每个结点2.5 bits，其中0.5bits是 rank-select 索引占用的空间）。</li>\n</ul>\n<p><strong>Succinct Tree</strong></p>\n<p>Succinct Tree有很多种表达方式，这里列出常见的两种：</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/42bb4fdda5077930596850352a5d5ab8.png\"></div>\n<div style=\"text-align: center\">图1 Succinct Tree表达方式示例</div>\n<p><strong>Succinct Trie = Succinct Tree + Trie Label</strong></p>\n<p>Trie可以用来实现Index，图2这个Succinct Trie用的是LOUDS表达方式，其中保存了hat、is、it、a、四个Key。</p>\n<p><strong>Patricia Trie加嵌套</strong></p>\n<p>仅使用Succinct技术，压缩率远远不够，所以又应用了路径压缩和嵌套。这样一来，压缩率就上了一个新台阶。</p>\n<p>把上面这些技术综合到一起，就是我们的Nest Succinct Trie。</p>\n<p><strong>对Value的压缩: PA-Zip</strong></p>\n<p>我们研发了一种叫做PA-Zip (Point Accessible Zip)的压缩技术：每条数据关联一个ID，数据压缩好之后，就可以用相应的ID访问那条数据。这里，ID就是那个Point，所以叫做Point Accessible Zip。</p>\n<p>PA-Zip对整个数据库中的所有Value（KeyValue数据库中所有Value的集合）进行全局压缩，而不是按block/page进行压缩。这是针对数据库的需求（KeyValue 模型），专门设计的一个压缩算法，用来解决传统数据库压缩的问题：</p>\n<ul>\n<li>压缩率更高，没有双缓存的问题，只要把压缩后的数据装进内存，不需要专用缓存，可以按ID直接读取单条数据，如果把这种读取单条数据看作是一种解压，那么：</li>\n<li>按ID顺序解压时，解压速度（Throughput）一般在500MB每秒（单线程），最高达到约7GB/s，适合离线分析性需求，传统数据库压缩也能做到这一点；</li>\n<li>按ID随机解压时，解压速度一般在300MB每秒（单线程），最高达到约3GB/s，适合在线服务需求，这一点完胜传统数据库压缩：按随机解压300MB/s算，如果每条记录平均长度1K，相当于QPS = 30万；如果每条记录平均长度300个字节，相当于QPS = 100万；</li>\n<li>预热（warmup），在某些特殊场景下，数据库可能需要预热。因为去掉了专用缓存，TerarkDB的预热相对简单高效，只要把mmap的内存预热一下（避免Page Fault即可），数据库加载成功后就是预热好的，这个预热的Throughput就是SSD连续读的IO性能（较新的SSD读性能超过3GB/s）。</li>\n</ul>\n<p>与FM-Index相比，PA-Zip解决的是FM-Index的extract操作，但性能和压缩率都要好得多：</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/899986dec4eb1f141407f572b05c511f.png\"></div>\n<div style=\"text-align: center\">表2 FM-Index对比PA-Zip</div>\n<p><strong>结合Key与Value</strong></p>\n<p>Key以全局压缩的形式保存在CO-Index中，Value以全局压缩的形式保存在 PA-Zip中。搜索一个Key，会得到一个内部ID，根据这个ID，去PA-Zip中定点访问该ID对应的Value，整个过程中只触碰需要的数据，不需要触碰其他数据。</p>\n<p>如此无需专用缓存（例如RocksDB中的DBCache），仅使用mmap，完美配合文件系统缓存，整个DB只有mmap的文件系统缓存这一层缓存，再加上超高的压缩率，大幅降低了内存用量，并且极大简化了系统的复杂性，最终完成数据库性能的大幅提升，从而同时实现了超高的压缩率和超高的随机读性能。</p>\n<p>从更高的哲学层面看，我们的存储引擎很像是用构造法推导出来的，因为CO-Index和PA-Zip紧密配合，完美匹配KeyValue模型，功能上“刚好够用”，性能上压榨硬件极限，压缩率逼近信息论的下限。相比其他方案：</p>\n<ul>\n<ul>\n<li>传统块压缩是从通用的流式压缩衍生而来，流式压缩的功能非常有限，只有压缩和解压两个操作，对太小的数据块没有压缩效果，也无法压缩数据块之间的冗余。把它用到数据库上，需要大量的工程努力，就像给汽车装上飞机机翼，然后要让它飞起来。</li>\n<li>相比FM-Index，情况则相反，FM-Index的功能非常丰富，它就必然要为此付出一些代价——压缩率和性能。而在KeyValue模型中，我们只需要它那些丰富功能的一个非常小的子集（还要经过适配和转化），其他更多的功能毫无用武之地，却仍然要付出那些代价，就像我们花了很高的代价造了一架飞机，却把它按在地上，只用轮子跑，当汽车用。</li>\n</ul>\n</ul>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/0fadbdd0670c36a88f53a624790ad3bb.png\"></div>\n<div style=\"text-align: center\">图2 用LOUDS方式表达的Succinct Tree</div>\n<p> </p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/7be742bb10ad455007a1e6e8ca885fe4.png\"></div>\n<div style=\"text-align: center\">图3 路径压缩与嵌套</div>\n<p><strong>附录</strong></p>\n<p><strong>压缩率&amp;性能测试比较</strong></p>\n<p><strong>数据集：Amazon movie data</strong></p>\n<p>Amazon movie data (~8 million reviews)，数据集的总大小约为9GB, 记录数大约为800万条，平均每条数据长度大约1K。</p>\n<p>Benchmark代码开源：参见<a href=\"https://github.com/Terark/terarkdb-benchmark/tree/master/doc/movies\" target=\"_blank\">Github仓库</a>。<br>\n压缩率（见图4）</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/02b6b59e468b97bc09a4d6ce30dd5eb2.png\"></div>\n<div style=\"text-align: center\">图4 压缩率对比</div>\n<p>随机读（见图5）</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/33436d4c3c3bdef34dcbd58741d80380.png\"></div>\n<div style=\"text-align: center\">图5 随机读性能对比</div>\n<p>这是在内存足够的情况下，各个存储引擎的性能。<br>\n延迟曲线（见图6）</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/75f6ac41648016d57f8c64747e19c235.png\"></div>\n<div style=\"text-align: center\">图6 延迟曲线对比</div>\n<p><strong>数据集：Wikipedia英文版</strong></p>\n<p>Wikipedia英文版的所有文本数据，109G，压缩到23G。</p>\n<p><strong>数据集：TPC-H</strong></p>\n<p>在TPC-H的lineitem数据上，使用TerarkDB和原版RocksDB（BlockBasedTable）进行对比测试：</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/2ea750214ac1a02595cc67c794e35b20.png\"></div>\n<div style=\"text-align: center\">表3 TerarkDB与原版RocksDB对比测试</div>\n<p><strong>API 接口</strong></p>\n<p><strong>TerarkDB = Terark SSTable + RocksDB</strong></p>\n<p>RocksDB最初是Facebook对Google的LevelDB的一个fork，编程接口上兼容LevelDB，并增加了很多改进。</p>\n<p>RocksDB对我们有用的地方在于其SSTable可以plugin，所以我们实现了一个RocksDB的SSTable，将我们的技术优势通过RocksDB发挥出来。</p>\n<p>虽然RocksDB提供了一个相对完整的KeyValueDB框架，但要完全适配我们特有的技术，仍有一些欠缺，所以需要对RocksDB本身也做一些修改。将来可能有一天我们会将自己的修改提交到RocksDB官方版。</p>\n<p>Github链接：<a href=\"https://github.com/Terark/terarkdb\" target=\"_blank\">TerarkDB</a>（<a href=\"https://github.com/Terark/terarkdb\" target=\"_blank\">https://github.com/Terark/terarkdb</a>），TerarkDB包括两部分：</p>\n<ul>\n<li>terark-zip-rocksdb（<a href=\"https://github.com/terark/terark-zip-rocksdb\" target=\"_blank\">https://github.com/terark/terark-zip-rocksdb</a>），（Terark SSTable forrocksdb）</li>\n<li>Terark fork rocksdb（<a href=\"https://github.com/Terark/rocksdb\" target=\"_blank\">https://github.com/Terark/rocksdb</a>），（必须使用这个修改版的rocksdb）</li>\n</ul>\n<p>为了更好的兼容性，TerarkDB对RocksDB的API没有做任何修改，为了进一步方便用户使用TerarkDB，我们甚至提供了一种方式：程序无需重新编译，只需要替换 librocksdb.so并设置几个环境变量，就能体验TerarkDB。</p>\n<p>如果用户需要更精细的控制，可以使用C++ API详细配置TerarkDB的各种选项。</p>\n<p>目前大家可以免费试用，可以做性能评测，但是不能用于production，因为试用版会随机删掉0.1%的数据。</p>\n<p><strong>Terark命令行工具集</strong></p>\n<p>我们提供了一组命令行工具，这些工具可以将输入数据压缩成不同的形式，压缩后的文件可以使用Terark API或（该工具集中的）其他命令行工具解压或定点访问。</p>\n<p>详情参见<a href=\"https://github.com/Terark/terark-wiki-zh_cn\" target=\"_blank\">Terark wiki中文版</a>（<a href=\"https://github.com/Terark/terark-wiki-zh_cn\" target=\"_blank\">https://github.com/Terark/terark-wiki-zh_cn</a>）。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111930\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111930votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111930\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-07-19", "vote": " ", "front_image_path": "full/ff17de8672c48c6a8dd39a73a0753c9ad77c1693.jpg", "title": "数据库压缩技术探索", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/6e6cabd45d6fb2d059e608a9ff5b97e4.jpg"]},
{"comment_nums": 0, "url_object_id": "69121d473d20cb45ed412306e1883d3f", "url": "http://blog.jobbole.com/111934/", "tags": ["IT技术", "php", "正则表达式"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/zhenbianshu/p/7197349.html\">枕边书</a>   </div><div>\n<h2 id=\"toc_0\">问题由来</h2>\n<p>前些天工作中遇到一个问题：</p>\n<blockquote><p>有 60万 条短消息记录日志，每条约 50 字，5万 关键词，长度 2-8 字，绝大部分为中文。要求将这 60万 条记录中包含的关键词全部提取出来并统计各关键词的命中次数。</p></blockquote>\n<p>本文完整介绍了我的实现方式，看我如何将需要运行十小时的任务优化到十分钟以内。虽然实现语言是 PHP，但本文介绍的更多的思想，应该能给大家一些帮助。</p>\n<h2 id=\"toc_1\">原始 – grep</h2>\n<h3 id=\"toc_2\">设计</h3>\n<p>一开始接到任务的时候，我的小心思立刻转了起来，<strong>日志 + 关键词 + 统计</strong>，我没有想到自己写代码实现，而是首先想到了 linux 下常用的日志统计命令 <span style=\"color: #ff0000;\"><code>grep</code></span>。</p>\n<p><span style=\"color: #ff0000;\"><code>grep</code></span>命令的用法不再多提，使用 <span style=\"color: #ff0000;\"><code>grep 'keyword' | wc -l</code></span> 可以很方便地进行统计关键词命中的信息条数，而php的 <span style=\"color: #ff0000;\"><code>exec()</code></span> 函数允许我们直接调用 linux 的 shell 命令，虽然这样执行危险命令时会有安全隐患。</p>\n<h3 id=\"toc_3\">代码</h3>\n<p>上伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712d0567c00612090704\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nforeach ($word_list as $keyword) {\r\n    $count = intval(exec(\"grep '{$keyword}' file.log | wc -l\"));\r\n    record($keyword, $count);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712d0567c00612090704-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c00612090704-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c00612090704-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c00612090704-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712d0567c00612090704-1\"><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">word_list </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c00612090704-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">intval</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"grep '{$keyword}' file.log | wc -l\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c00612090704-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">record</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c00612090704-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>在一台老机器上跑的，话说老机器效率真的差，跑了6小时。估计最新机器2-3小时吧，后面的优化都使用的新机器，而且需求又有变动，正文才刚刚开始。</p>\n<p><em>原始，原始在想法和方法</em>。</p>\n<h2 id=\"toc_4\">进化 – 正则</h2>\n<h3 id=\"toc_5\">设计</h3>\n<p>交了差之后，第二天产品又提出了新的想法，说以后想把某数据源接入进来，消息以数据流的形式传递，而不再是文件了。而且还要求了消息统计的实时性，一下把我想把数据写到文件再统计的想法也推翻了，为了方案的可扩展性，现在的统计对象不再是一个整体，而是要考虑拿n个单条的消息来匹配了。</p>\n<p>这时，略懵的我只好祭出了最传统的工具- 正则。正则的实现也不难，各个语言也都封装好了正则匹配函数，重点是模式(pattern)的构建。</p>\n<p>当然这里的模式构建也不难，<span style=\"color: #ff0000;\"><code>/keyword1|keword2|.../</code></span>，用<span style=\"color: #ff0000;\"><code>|</code></span>将关键词连接起来即可。</p>\n<h3 id=\"toc_6\">正则小坑</h3>\n<p>这里介绍两个使用中遇到的小坑：</p>\n<ul>\n<li>正则模式长度太长导致匹配失败：PHP 的正则有回溯限制，以防止消耗掉所有的进程可用堆栈, 最终导致 php 崩溃。太长的模式会导致 PHP 检测到回溯过多，中断匹配，经测试默认设置时最大模式长度为 32000 字节 左右。php.ini 内 <span style=\"color: #ff0000;\"><code>pcre.backtrack_limit</code></span> 参数为最大回溯次数限制，默认值为 1000000，修改或 <span style=\"color: #ff0000;\"><code>php.ini</code></span> 或在脚本开始时使用 <span style=\"color: #ff0000;\"><code>ini_set(‘pcre.backtrack_limit’, n);</code></span> 将其设置为一个较大的数可以提高单次匹配最大模式长度。当然也可以将关键词分批统计（我用了这个=_=）。</li>\n<li>模式中含有特殊字符导致大量warning：匹配过程中发现 PHP 报出大量 warning：<span style=\"color: #ff0000;\"><code>unknown modifier <strong>乱码</strong></code></span>，仔细检查发现关键词中有<span style=\"color: #ff0000;\"><code>/</code></span>字符，可以使用<span style=\"color: #ff0000;\"><code>preg_quote()</code></span>函数过滤一遍关键词即可。</li>\n</ul>\n<h3 id=\"toc_7\">代码</h3>\n<p>上伪代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712d0567c0c137414539\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$end = 0;\r\n$step = 1500;\r\n$pattern = array();\r\n// 先将pattern 拆成多个小块\r\nwhile ($end &lt; count($word_list)) {\r\n    $tmp_arr = array_slice($word_list, $end, $step);\r\n    $end += $step;\r\n    $item = implode('|', $tmp_arr);\r\n    $pattern[] = preg_quote($item);\r\n}\r\n\r\n$content = file_get_contents($log_file);\r\n$lines = explode(\"\\n\", $content);\r\nforeach ($lines as $line) {\r\n    // 使用各小块pattern分别匹配\r\n    for ($i = 0; $i &lt; count($pattern); $i++) {\r\n        preg_match_all(\"/{$pattern[$i]}/\", $line, $match);\r\n    }\r\n    $match = array_unique(array_filter($match));\r\n    dealResult($match);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c0c137414539-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c0c137414539-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">step</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1500</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-4\"><span class=\"crayon-c\">// 先将pattern 拆成多个小块</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-5\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">word_list</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_arr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_slice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">word_list</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">step</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">step</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">item</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">implode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'|'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_arr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preg_quote</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-12\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">log_file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-13\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lines</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">explode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-14\"><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">lines </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 使用各小块pattern分别匹配</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">preg_match_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/{$pattern[$i]}/\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_unique</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">array_filter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c0c137414539-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">dealResult</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c0c137414539-21\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p>为了完成任务，硬着头皮进程跑了一夜。当第二天我发现跑了近十个小时的时候内心是崩溃的。。。太慢了，完全达不到使用要求，这时，我已经开始考虑改换方法了。</p>\n<p>当产品又改换了关键词策略，替换了一些关键词，要求重新运行一遍，并表示还会继续优化关键词时，我完全否定了现有方案。绝对不能用关键词去匹配信息，这样一条一条用全部关键词去匹配，效率实在是不可忍受。</p>\n<p><em>进化，需求和实现的进化</em></p>\n<h2 id=\"toc_8\">觉醒 – 拆词</h2>\n<h3 id=\"toc_9\">设计</h3>\n<p>我终于开始意识到要拿信息去关键词里对比。如果我用关键词为键建立一个 hash 表，用信息里的词去 hash 表里查找，如果查到就认为匹配命中，这样不是能达到 O(1) 的效率了么？</p>\n<p>可是一条短消息，我如何把它拆分为刚好的词去匹配呢，分词？分词也是需要时间的，而且我的关键词都是些无语义的词，构建词库、使用分词工具又是很大的问题，最终我想到 <span style=\"color: #ff0000;\"><code>拆词</code></span>。</p>\n<p>为什么叫拆词呢，我考虑以蛮力将一句话拆分为<span style=\"color: #ff0000;\"><code><strong>所有可能</strong>的</code></span>词。如（<strong><span style=\"color: #ff0000;\"><code>我是好人）</code></span></strong>就可以拆成（<strong><span style=\"color: #ff0000;\"><code>我是、是好、好人、我是好、是好人、我是好人）</code></span></strong>等词，我的关键词长度为 2-8，所以可拆词个数会随着句子长度迅速增加。不过，可以用标点符号、空格、语气词（如<span style=\"color: #ff0000;\"><code>的、是</code></span>等）作为分隔将句子拆成小短语再进行拆词，会大大减少拆出的词量。</p>\n<p>其实分词并没有完整实现就被后一个方法替代了，只是一个极具实现可能的构想，写这篇文章时用伪代码实现了一下，供大家参考，即使不用在匹配关键词，用在其他地方也是有可能的。</p>\n<h3>代码</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712d0567c12755180361\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$str_list = getStrList($msg);\r\nforeach ($str_list as $str) {\r\n    $keywords = getKeywords($str);\r\n    foreach ($keywords as $keyword) {\r\n        // 直接通过PHP数组的哈希实现来进行快速查找\r\n        if (isset($word_list[$keyword])) {\r\n            record($keyword);\r\n        }\r\n    }\r\n}\r\n/**\r\n * 从消息中拆出短句子\r\n */\r\nfunction getStrList($msg) {\r\n    $str_list = array();\r\n    $seperators = array('，', '。', '的', ...);\r\n\r\n    $words = preg_split('/(?&lt;!^)(?!$)/u', $msg);\r\n    $str = array();\r\n    foreach ($words as $word) {\r\n        if (in_array($word, $seperators)) {\r\n            $str_list[] = $str;\r\n            $str = array();\r\n        } else {\r\n            $str[] = $word;\r\n        }\r\n    }\r\n\r\n    return array_filter($str_list);\r\n}\r\n\r\n/**\r\n * 从短句中取出各个词\r\n */\r\nfunction getKeywords($str) {\r\n    if (count($str) &lt; 2) {\r\n        return array();\r\n    }\r\n\r\n    $keywords = array();\r\n    for ($i = 0; $i &lt; count($str); $i++) {\r\n        for ($j = 2; $j &lt; 9; $j++) {\r\n            $keywords[] = array_slice($str, $i, $j); // todo 限制一下不要超过数组最大长度\r\n        }\r\n    }\r\n\r\n    return $keywords;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c12755180361-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c12755180361-48\">48</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStrList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-2\"><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">str_list </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getKeywords</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">keywords </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 直接通过PHP数组的哈希实现来进行快速查找</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">word_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">record</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keyword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-10\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-11\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-12\"><span class=\"crayon-c\"> * 从消息中拆出短句子</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-13\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-14\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStrList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">seperators</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'，'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'。'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'的'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preg_split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/(?&lt;!^)(?!$)/u'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">words </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">in_array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">seperators</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-28\"> </div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_filter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str_list</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-30\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-32\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-33\"><span class=\"crayon-c\"> * 从短句中取出各个词</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-34\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-35\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getKeywords</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-39\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_slice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// todo 限制一下不要超过数组最大长度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-46\"> </div><div class=\"crayon-line\" id=\"crayon-59712d0567c12755180361-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">keywords</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c12755180361-48\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0071 seconds] -->\r\n<p></p>\n<h3 id=\"toc_11\">结果</h3>\n<p>我们知道一个 <span style=\"color: #ff0000;\"><code>utf-8</code></span> 的中文字符要占用三个字节，为了拆分出包含中英文的每一个字符，使用简单的 <span style=\"color: #ff0000;\"><code>split()</code></span> 函数是做不到的。</p>\n<p>这里使用了 <span style=\"color: #ff0000;\"><span style=\"color: #ff0000;\"><code>preg_split('/(?&lt;!^)(?!$)/u', $msg)</code></span></span> 是通过正则匹配到两个字符之间的<span style=\"color: #ff0000;\"><code>''</code></span>来将两个字符拆散，而两个括号里的 <span style=\"color: #ff0000;\"><code>(?&lt;!^)(?!$)</code></span> 是分别用来限定捕获组不是第一个，也不是最后一个（不使用这两个捕获组限定符也是可以的，直接使用<span style=\"color: #ff0000;\"><code>//</code></span>作为模式会导致拆分结果在前后各多出一个空字符串项）。  捕获组的概念和用法可见我之前的博客 <a href=\"http://www.cnblogs.com/zhenbianshu/p/4941964.html\">PHP正则中的捕获组与非捕获组</a></p>\n<p>由于没有真正实现，也不知道效率如何。估算每个短句长度约为 10 字左右时，每条短消息约50字左右，会拆出 200 个词。虽然它会拆出很多无意义的词，但我相信效率绝不会低，由于其 hash 的高效率，甚至我觉得会可能比终极方法效率要高。</p>\n<p>最终没有使用此方案是因为它对句子要求较高，拆词时的分隔符也不好确定，最重要的是它不够优雅。。。这个方法我不太想去实现，统计标识和语气词等活显得略为笨重，而且感觉拆出很多无意义的词感觉效率浪费得厉害。</p>\n<p><em>觉醒，意识和思路的觉醒</em></p>\n<h2 id=\"toc_12\">终级 – Trie树</h2>\n<h3 id=\"toc_13\">trie树</h3>\n<p>于是我又来找谷哥帮忙了，搜索大量数据匹配，有人提出了 使用 trie 树的方式，没想到刚学习的 trie 树的就派上了用场。我上上篇文章刚介绍了 trie 树，在<a href=\"http://www.cnblogs.com/zhenbianshu/p/7061550.html\">空间索引 – 四叉树</a> 里<span style=\"color: #ff0000;\"><code>字典树</code></span>这一小节，大家可以查看一下。</p>\n<p>当然也为懒人复制了一遍我当时的解释(看过的可以跳过这一小节了)。</p>\n<blockquote><p>字典树，又称前缀树或 trie 树，是一种有序树，用于保存关联数组，其中的键通常是字符串。与二叉查找树不同，键不是直接保存在节点中，而是由节点在树中的位置决定。一个节点的所有子孙都有相同的前缀，也就是这个节点对应的字符串，而根节点对应空字符串。</p></blockquote>\n<p>我们可以类比字典的特性：我们在字典里通过拼音查找晃(<span style=\"color: #ff0000;\"><code>huang</code></span>)这个字的时候，我们会发现它的附近都是读音为<span style=\"color: #ff0000;\"><code>huang</code></span>的，可能是声调有区别，再往前翻，我们会看到读音前缀为<span style=\"color: #ff0000;\"><code>huan</code></span>的字，再往前，是读音前缀为<span style=\"color: #ff0000;\"><code>hua</code></span>的字… 取它们的读音前缀分别为 <span style=\"color: #ff0000;\"><code>h qu hua huan huang</code></span>。我们在查找时，根据 <span style=\"color: #ff0000;\"><code>abc...xyz</code></span> 的顺序找到<span style=\"color: #ff0000;\"><code>h</code></span>前缀的部分，再根据 <span style=\"color: #ff0000;\"><code>ha he hu</code></span>找到 <span style=\"color: #ff0000;\"><code>hu</code></span> 前缀的部分…最后找到 <span style=\"color: #ff0000;\"><code>huang</code></span>，我们会发现，越往后其读音前缀越长，查找也越精确，这种类似于字典的树结构就是字典树，也是前缀树。</p>\n<h2 id=\"toc_14\">设计</h2>\n<p>那么 trie 树怎么实现关键字的匹配呢? 这里以一幅图来讲解 trie 树匹配的过程。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/513742e19f31c6296f72381e383f60ea.png\"><img class=\"aligncenter wp-image-111935 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/513742e19f31c6296f72381e383f60ea.png\" alt=\"1\" width=\"396\" height=\"493\"></a></p>\n<p>其中要点：</p>\n<h4 id=\"toc_15\">构造trie树</h4>\n<ol>\n<li>将关键词用上面介绍的<span style=\"color: #ff0000;\"><code>preg_split()</code></span>函数拆分为单个字符。如<span style=\"color: #ff0000;\"><code>科学家</code></span>就拆分为<span style=\"color: #ff0000;\"><code>科、学、家</code></span>三个字符。</li>\n<li>在最后一个字符后添加一个特殊字符<span style=\"color: #ff0000;\"><code>`</code></span>，此字符作为一个关键词的结尾（图中的粉红三角），以此字符来标识查到了一个关键词（不然，我们不知道匹配到<span style=\"color: #ff0000;\"><code>科、学</code></span>两个字符时算不算匹配成功）。</li>\n<li>检查根部是否有第一个字符(<span style=\"font-family: Monaco, Consolas, 'Andale Mono', 'DejaVu Sans Mono', monospace;\">科</span>)节点，如果有了此节点，到<code style=\"font-weight: bold;\">步骤4</code>。 如果还没有，在根部添加值为<code style=\"font-weight: bold;\">科</code>的节点。</li>\n<li>依次检查并添加<span style=\"color: #ff0000;\"><code>学、家</code></span> 两个节点。</li>\n<li>在结尾添加 <span style=\"color: #ff0000;\"><code>`</code></span> 节点，并继续下一个关键词的插入。</li>\n</ol>\n<h4 id=\"toc_16\">匹配</h4>\n<p>然后我们以 <span style=\"color: #ff0000;\"><code><strong>这位科学家很了不起</strong>！</code></span>为例来发起匹配。</p>\n<ul>\n<li>首先我们将句子拆分为单个字符 <strong><span style=\"color: #ff0000;\"><code>这、位</code></span><span style=\"color: #ff0000;\"><code>、...</code></span>；</strong></li>\n<li>从根查询第一个字符<span style=\"color: #ff0000;\"><code>这</code></span>，并没有以这个字符开头的关键词，将字符“指针”向后移，直到找到根下有的字符节点<strong><span style=\"color: #ff0000;\"><code>科</code></span></strong>;</li>\n<li>接着在节点<span style=\"color: #ff0000;\"><code>科</code></span>下寻找值为 <strong><span style=\"color: #ff0000;\"><code>学</code></span></strong>节点，找到时，结果子树的深度已经到了2，关键词的最短长度是2，此时需要在<span style=\"color: #ff0000;\"><code>学</code></span>结点下查找是否有<span style=\"color: #ff0000;\"><span style=\"color: #ff0000;\"><code>`</code></span></span>，找到意味着匹配成功，返回关键词，并将字符“指针”后移，如果找不到则继续在此结点下寻找下一个字符。</li>\n<li>如此遍历，直到最后，返回所有匹配结果。</li>\n</ul>\n<h3 id=\"toc_17\">代码</h3>\n<p>完整代码我已经放到了GitHub上：<a href=\"https://github.com/zhenbianshu/DataStructureAndAlgorithm/blob/master/keyword_match_trie.php\">Trie-GitHub-zhenbianshu</a>，这里放上核心。</p>\n<p>首先是数据结构树结点的设计，当然它也是重中之重：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712d0567c1a702428477\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$node = array(\r\n    'depth' =&gt; $depth, // 深度，用以判断已命中的字数\r\n    'next' =&gt; array(\r\n        $val =&gt; $node, // 这里借用php数组的哈希底层实现，加速子结点的查找\r\n        ...\r\n    ),\r\n);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1a702428477-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1a702428477-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1a702428477-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1a702428477-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1a702428477-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1a702428477-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1a702428477-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712d0567c1a702428477-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1a702428477-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'depth'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">depth</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 深度，用以判断已命中的字数</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1a702428477-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'next'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1a702428477-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 这里借用php数组的哈希底层实现，加速子结点的查找</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1a702428477-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1a702428477-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1a702428477-7\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>然后是树构建时子结点的插入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712d0567c1e419325918\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 这里要往节点内插入子节点，所以将它以引用方式传入\r\nprivate function insert(&amp;$node, $words) {\r\n         if (empty($words)) {\r\n            return;\r\n        }\r\n        $word = array_shift($words);\r\n        // 如果子结点已存在，向子结点内继续插入\r\n        if (isset($node['next'][$word])) {\r\n            $this-&gt;insert($node['next'][$word], $words);\r\n        } else {\r\n            // 子结点不存在时，构造子结点插入结果\r\n            $tmp_node = array(\r\n                'depth' =&gt; $node['depth'] + 1,\r\n                'next' =&gt; array(),\r\n            );\r\n            $node['next'][$word] = $tmp_node;\r\n            $this-&gt;insert($node['next'][$word], $words);\r\n        }\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c1e419325918-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c1e419325918-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-1\"><span class=\"crayon-c\">// 这里要往节点内插入子节点，所以将它以引用方式传入</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-2\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-3\"><span class=\"crayon-h\">         </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 如果子结点已存在，向子结点内继续插入</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 子结点不存在时，构造子结点插入结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'depth'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'depth'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'next'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tmp_node</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c1e419325918-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c1e419325918-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p>最后是查询时的操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59712d0567c22218446252\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 这里也可以使用一个全局变量来存储已匹配到的字符，以替换$matched\r\nprivate function query($node, $words, &amp;$matched) {\r\n        $word = array_shift($words);\r\n        if (isset($node['next'][$word])) {\r\n            // 如果存在对应子结点，将它放到结果集里\r\n            array_push($matched, $word);\r\n            // 深度到达最短关键词时，即可判断是否到词尾了\r\n            if ($node['next'] &gt; 1 &amp;&amp; isset($node['next'][$word]['next']['`'])) {\r\n                return true;\r\n            }\r\n            return $this-&gt;query($node['next'][$word], $words, $matched);\r\n        } else {\r\n            $matched = array();\r\n            return false;\r\n        }\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59712d0567c22218446252-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59712d0567c22218446252-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-1\"><span class=\"crayon-c\">// 这里也可以使用一个全局变量来存储已匹配到的字符，以替换$matched</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-2\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_shift</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 如果存在对应子结点，将它放到结果集里</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">array_push</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 深度到达最短关键词时，即可判断是否到词尾了</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'`'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matched</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59712d0567c22218446252-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59712d0567c22218446252-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p></p>\n<h3 id=\"toc_18\">结果</h3>\n<p>结果当然是喜人的，如此匹配，处理一千条数据只需要3秒左右。找了 Java 的同事试了下，Java 处理一千条数据只需要1秒。</p>\n<p>这里来分析一下为什么这种方法这么快：</p>\n<ul>\n<li>正则匹配：要用所有的关键词去信息里匹配匹配次数是 <span style=\"color: #ff0000;\"><code>key_len * msg_len</code></span>，当然正则会进行优化，但基础这样，再优化效率可想而知。</li>\n<li>而 trie 树效率最差的时候是<strong> <span style=\"color: #ff0000;\"><code>msg_len * 9(最长关键词长度 + 1个特殊字符)</code></span>次 hash</strong> 查找，即最长关键词类似 <span style=\"color: #ff0000;\"><code>AAA</code></span>，信息内容为 <span style=\"color: #ff0000;\"><code>AAA...</code></span>时，而这种情况的概率可想而知。</li>\n</ul>\n<p>至此方法的优化到此结束，从每秒钟匹配 10 个，到 300 个，30 倍的性能提升还是巨大的。</p>\n<p><em>终级，却不一定是终极</em></p>\n<h2 id=\"toc_19\">他径 – 多进程</h2>\n<h3 id=\"toc_20\">设计</h3>\n<p>匹配方法的优化结束了，开头说的优化到十分钟以内的目标还没有实现，这时候就要考虑一些其他方法了。</p>\n<p>我们一提到高效，必然想到的是 <span style=\"color: #ff0000;\"><code>并发</code></span>，那么接下来的优化就要从并发说起。PHP 是单线程的（虽然也有不好用的多线程扩展），这没啥好的解决办法，并发方向只好从多进程进行了。</p>\n<p>那么一个日志文件，用多个进程怎么读呢？这里当然也提供几个方案：</p>\n<ul>\n<li>进程内添加日志行数计数器，各个进程支持传入参数 n，进程只处理第 行数<span style=\"color: #ff0000;\"><code> % n = n</code></span> 的日志，这种 hack 的反向分布式我已经用得很熟练了，哈哈。这种方法需要进程传参数，还需要每个进程都分配读取整个日志的的内存，而且也不够优雅。</li>\n<li>使用 linux 的 <span style=\"color: #ff0000;\"><code>split -l n file.log output_pre</code></span> 命令，将文件分割为每份为 n 行的文件，然后用多个进程去读取多个文件。此方法的缺点就是不灵活，想换一下进程数时需要重新切分文件。</li>\n<li>使用 Redis 的 list 队列临时存储日志，开启多个进程消费队列。此方法需要另外向 Redis 内写入数据，多了一个步骤，但它扩展灵活，而且代码简单优雅。</li>\n</ul>\n<p>最终使用了第三种方式来进行。</p>\n<h3 id=\"toc_21\">结果</h3>\n<p>这种方式虽然也会有瓶颈，最后应该会落在 Redis 的网络 IO 上。我也没有闲心开 n 个进程去挑战公司 Redis 的性能，运行 10 个进程三四分钟就完成了统计。即使再加上 Redis 写入的耗时，10分钟以内也妥妥的。</p>\n<p>一开始产品对匹配速度已经有了小时级的定位了，当我 10 分钟就拿出了新的日志匹配结果，看到产品惊讶的表情，心里也是略爽的，哈哈~</p>\n<p><em>他径，也能帮你走得更远</em></p>\n<h2 id=\"toc_22\">总结</h2>\n<p>解决问题的方法有很多种，我认为在解决各种问题之前，要了解很多种知识，即使只知道它的作用。就像一个工具架，你要先把工具尽量摆得多，才能在遇到问题时选取一个最合适的。接着当然要把这些工具用是纯熟了，这样才能使用它们去解决一些怪异问题。</p>\n<p>工欲善其事，必先利其器，要想解决性能问题，掌握系统级的方法还略显不够，有时候换一种数据结构或算法，效果可能会更好。感觉自己在这方面还略显薄弱，慢慢加强吧，各位也共勉。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111934\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111934votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111934\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-07-19", "vote": " ", "front_image_path": "full/d91c8c6ea6d894ebf725cdccfda0bccf6f675e36.jpg", "title": "10小时到10分钟，一步步优化巨量关键词的匹配", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/513742e19f31c6296f72381e383f60ea.png"]},
{"comment_nums": 0, "url_object_id": "32fb6fb546aac0808415e5f45c8f324a", "url": "http://blog.jobbole.com/111888/", "tags": ["职场", "DHH"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://m.signalvnoise.com/manufacturing-quality-time-fe043fa7b7a1#.7w18xpuzd\">DHH</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：《<a href=\"http://blog.jobbole.com/111892/\" target=\"_blank\">代码写的好，出过畅销书，还拿过赛车冠军，这是一种什么体验？</a>》这篇文章中已经介绍了 DHH。他既是 Ruby On Rails 之父，BaseCamp 的 CTO，又是一个家庭主男，业余还会参加赛车比赛，还爱好摄影，那他是如何兼顾着这一切的呢？</p>\n<p>的确也经常有人问他这个问题。不了解他的人，觉得他一定有些秘密或窍门。每晚只睡 5 小时？还是持续几个月每天工作 12 小时？还是其他什么的。</p>\n<p>2015 年 12 月 30 日，DHH 专门写了一篇文章，分享了他的答案。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhns9sfhyuj20rs0fu75o.jpg\" width=\"600\" height=\"342\"></p>\n<p style=\"text-align: left;\">“高效能人群”的共同点仅仅是他们更加努力地工作，通常像超人似的。对单一事物的关注/专注，是驱使他们工作到晚上 11 点的动力。而媒体喜欢报道他们这样那样的非凡毅力和决心。</p>\n<p>但我不吃这一套，我通常每晚的睡眠时间是 8.5 至 9 小时，并每周 40 小时。我不想在工作上花更多的时间。</p>\n<p><span style=\"color: #ff0000;\"><strong>如果一定要我说有什么技巧，那就是我追求每个小时的质量</strong></span>。不过这不代表着「<strong>时间管理</strong>」，该词出现于上世纪 90 年代，意思是将每个小时切分到最后一分钟，以压榨提高每秒的生产力峰值。但时间管理确实说明了一件事：<strong>每个小时的价值不尽相同</strong>。</p>\n<p>如果一小时充满了压力、中断、缺觉或者疲惫，在这种状态下工作，你对不起这一小时中的每一分钟。因为它是低质量的一小时。如果妄想通过这样低质时间能够做出好东西，明显非常愚蠢。因为你最终也只能「<strong>垃圾进来，垃圾出去</strong>」。</p>\n<p><strong>每周工作 40 小时，是一个王者的固守。</strong>在这样的前提下，我认为几乎可以完成所有的东西。当然了，前提是你没有把时间浪费在会议、一心多用或定义不清的问题上。这些都是吞噬时间的黑洞，深不见底。</p>\n<p>好吧，即便没有黑洞，但也有物理极限的（ 1 天只有 24 小时），我相信很多人都觉得自己是时间的穷人！如果花了时间但一事无成，你不能怪我，而我也不怪自己。<span style=\"color: #000000;\">怜悯是我们仅剩的借口了。</span></p>\n<p>自我保护或让别人帮你，也许能给你带来暂时的舒适，但从长久来看，它掩盖不了缺乏理想的窘境。面对失败，放弃是一种应对的机制。</p>\n<p>你需要的是一套精细的技术，需要积极努力地提高时间的纯度和质量。以下是我使用的几个小窍门：</p>\n<h3>1、我真的需要参与其中吗？</h3>\n<p>贪婪的好奇心会让你无休止地卷入各种讨论、决定和事件中，尽管是否有你，那些事可能区别都不大。</p>\n<p>你提出的想法或经验，“可能”对他人有用，但你也同样剥夺了他人自由思考的权利，这点可能让你难以接受。</p>\n<p>目前看来，略读邮件、拒绝会议邀请、不要在聊天中发表你的看法，这些举措可能还挺深奥的。但通过努力克制自己、避免插嘴和介入合作，能够让你集中时间花在少量的事上，以取得更重要的进展。</p>\n<h3>2、这个/这事还能等等吗？</h3>\n<p>有些问题需要今天处理掉，否则就是明天的麻烦。你最好马上处理掉那些问题，虽然它们通常只占少数。大多数的问题和机会值得从现在起，花上一天、一周甚至一月的时间来处理。</p>\n<p>将手上的事先搁置一边，可能等你回头再看的时候，它就不是事儿了。是不是很棒？！这些是不需要立刻做的工作，或者只是一开始认为非常重要，实则不然。</p>\n<p>花在解决问题上的时间越长，你会对这个问题有着更深入的了解。随着空闲时间的投入，解决问题的痛苦将大大减少。</p>\n<h3>3、我能放弃吗？</h3>\n<p>浪费了高质量时间的代价，往往最终浪费了一天的时间。而错误估计了问题的深度，也是工作和生活中的一个常见过失。</p>\n<p>当意识到现在的问题比当初预期的更难，却不承认解决问题需要花费比原计划更多的时间，结果通常是越陷越深，从而浪费更多的时间。</p>\n<p>学会放弃是一项关键的技能，能够让你专注于剩下的时间。只有失败者才会在<strong>沉没成本</strong>上下赌注。</p>\n<blockquote><p>伯乐在线补充：<strong>沉没成本</strong>是指由于过去的决策已经发生了的，而不能由现在或将来的任何决策改变的成本。人们在决定是否去做一件事情的时候，不仅是看这件事对自己有没有好处，而且也看过去是不是已经在这件事情上有过投入。我们把这些已经发生不可收回的支出，如时间、金钱、精力等称为“沉没成本”（Sunk Cost）。在经济学和商业决策制定过程中会用到“沉没成本”的概念，代指已经付出且不可收回的成本。沉没成本常用来和可变成本作比较，可变成本可以被改变，而沉没成本则不能被改变。</p></blockquote>\n<h3>4、我准备好了吗？</h3>\n<p>有时，问题需要更多的时间来发酵，你也需要更多的时间来成长。你我都做不到能够同时解决所有的问题。</p>\n<p>如果我本周适合写作，那完成新网站的拷贝工作会是一个好选择，但安排下个季度的工作情况则不是一个好的时机。如果我本周手指发痒想写代码，那正好可以尝试解决那个困扰了我一个月的 bug，但是却不适合做一对一面试。</p>\n<p>我们的情绪会如潮水般上下起伏，在激情和消沉之间摇摆不定。顺势而为要比逆势前行轻松得多。就像上文的例子一样，大多数事情都可以推延到合适的情绪下再做。</p>\n<p>即使你掌握了强大的技巧，让每一个小时都更有价值，失败仍然不可避免。原因也许只是本周所有要做的工作并不能激起你的激情。一旦激情消失，你会倍感失落。</p>\n<p>知道真相或许会给你巨大的心理安慰：每个人都会经历低潮，尽管大部分人都不承认这一点。即使有着经过打磨的高品质时间，我仍然经常生产出垃圾，比我预期得还要多。就是这么回事儿！</p>\n<p>长久来看，关键在于你要不断提高时间的质量，即使没有得到一个好的结果，也不要给自己过多的压力。</p>\n<p>一旦你建立了对高质量时间的正确认识和积极态度，我相信你就不会一味地追求更多的时间。高质量的四个连续小时和几天的垃圾（低质量）时间完全不可同日而语，两者相差悬殊。</p>\n<p>即便你对时间进行压缩以获取更多的时间，你可能也就多了 20% 到 50% 的时间；但对拥有的时间进行规划和打磨，你可能会得到 200% 到 500% 的额外价值。<span style=\"color: #ff0000;\"><strong>这才是真正的 10 倍效率！</strong></span></p>\n<p><strong>兼顾一切的窍门是停止兼顾。</strong></p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111888\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111888votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111888\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            我见青山多妩媚，料青山见我应如是        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 28</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-07-19", "vote": " ", "front_image_path": "full/5d6df9368785d41523d2ae0a30beadd79fb92b3a.jpg", "title": "编程、出书、赛车……DHH 是如何兼顾这一切的？", "front_image_url": ["http://wx3.sinaimg.cn/large/7cc829d3gy1fhns9sfhyuj20rs0fu75o.jpg"]},
{"comment_nums": 0, "url_object_id": "25cdb73013451e3d2f61f6cc3d6759e7", "url": "http://blog.jobbole.com/111889/", "tags": ["职场", "技术面试", "职场"], "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/q4000052677\">听风</a> 翻译，<a href=\"http://www.jobbole.com/members/scbzyhx\">yhx</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://aphyr.com/posts/340-acing-the-technical-interview\">Kyle Kingsbury</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p><span style=\"color: #339966\">假想面试的时候用 Clojure 做题，狠狠地鄙视了一下不懂 Clojure、且高傲无知的面试官，然后潇洒地离去。</span></p>\n<hr>\n<p>如果你打算找一份程序员的工作，那么你必须要通过白板面试。 作为工程师，模拟白板面试也经常是我们早上例行公事的一部分，同时还需要在星光层（astral plane）上打开一个漂亮的网格状的 xterms 窗口，并且在每个邻近的目录中不由自主地运行 ls 命令，以防事情在昨晚有什么变化。</p>\n<p>这不亚于在厨房后面的那个抽屉里，搞一次天翻地覆地搜查。而那个抽屉里存放着各种各样的法兰盘、螺丝刀和从各种家用电器上掉下来多年的各种配饰或零件。现在谁也不知道这些东西原来是做什么用的，或许从来就没知道过，尽管如此，我们还必须小心翼翼的对待它们。</p>\n<p>下面我将通过一个常见的面试题，向你演示一下白板面试：反转链表。</p>\n<p>首先，我们需要一个链表。清除 xterms 中不需要的工作区，然后在两个括号的作用域中写上必要的元素和通配符。这样我们就从无到有创建出了一个链表。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59716156dafe6506127253\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(defn cons [h t] #(if % h t))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59716156dafe6506127253-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59716156dafe6506127253-1\"><span class=\"crayon-o\">(</span><span class=\"crayon-st\">defn</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">#</span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>“那不是一个链表，那只是一条 if 语句。”面试官说。</p>\n<p>“ 这不就是一个另类点的链表吗？”你回答到，同时翻了一个白眼。</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fhqlozoo7jg208c08adx1.gif\" width=\"300\" height=\"298\"></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59716156daff1725691359\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuser=&gt; (def x (cons 1 (cons 2 nil)))\r\n#'user/x\r\nuser=&gt; (x true)\r\n1\r\nuser=&gt; ((x false) true)\r\n2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59716156daff1725691359-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716156daff1725691359-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59716156daff1725691359-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716156daff1725691359-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59716156daff1725691359-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716156daff1725691359-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59716156daff1725691359-1\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716156daff1725691359-2\"><span class=\"crayon-o\">#</span>'<span class=\"crayon-i\">user</span><span class=\"crayon-st\">/</span><span class=\"crayon-i\">x</span></div><div class=\"crayon-line\" id=\"crayon-59716156daff1725691359-3\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">true</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716156daff1725691359-4\"><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59716156daff1725691359-5\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">false</span><span class=\"crayon-o\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">true</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716156daff1725691359-6\"><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>“x 到底是什么？”面试官尽量让自己看些来友善些。答案就在 REPL，但不要被它一时误导了，它们可不是你的朋友。你在前台的“誓言”，不允许你使用它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59716156daff5913778065\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuser=&gt; x\r\n#object[user$cons$cell__4431 0x3b89cc1c \"user$cons$cell__4431@3b89cc1c\"]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59716156daff5913778065-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716156daff5913778065-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59716156daff5913778065-1\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716156daff5913778065-2\"><span class=\"crayon-o\">#</span><span class=\"crayon-i\">object</span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">user</span><span class=\"crayon-sy\">$</span><span class=\"crayon-st\">cons</span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">cell</span><span class=\"crayon-sy\">_</span><span class=\"crayon-sy\">_</span>4431<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x3b89cc1c</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"user$cons$cell__4431@3b89cc1c\"</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>“了解一个事物最好的方式，就是对它命名。”你回答到。恰当的名字具备魔力。由 Ursula K. Le Guin 发明的 K 语言是最古老和最精练的形式语言之一。一旦你使用某个字符对程序进行自定义命名，意味着你将不能再使用这个字符元素。 你自定义的缩写名称会记录在程序的内存中。</p>\n<p>“呃，好吧，你怎么从这个链表里面取出一个元素呢？” 面试官又问。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fhqls12mmhj20dw07hn4u.jpg\" width=\"500\" height=\"269\"></p>\n<p>那些巧妙的表达式在你脑海中逐一呈现，仿佛红地毯在你光着的双脚下慢慢展开； 犹如昨晚观看奥斯卡颁奖典礼时，你憧憬着不同的明星来亲吻你；又好像你住在瑟略岛（Sørøya ）山脉之上，月亮就是你的爱人。 除了边界检查，你在第一时间写出了正确的代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59716156daff9733193679\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(defn nth [l n]\r\n  (when l (if (= 0 n)\r\n            (l true)\r\n            (recur (l false) (dec n)))))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59716156daff9733193679-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716156daff9733193679-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59716156daff9733193679-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716156daff9733193679-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59716156daff9733193679-1\"><span class=\"crayon-o\">(</span><span class=\"crayon-st\">defn</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">nth</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716156daff9733193679-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">when</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-59716156daff9733193679-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">true</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716156daff9733193679-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">recur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">false</span><span class=\"crayon-o\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">dec</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0059 seconds] -->\r\n<p>“你能不能给我写一个正常的链表吗？就像 Python 中的那样？”</p>\n<p>你咬紧牙关，气愤地在地板上直跺脚，但还是写了一个排版良好的打印函数。 此刻，你的手掌仿佛充满了老茧，你的眼皮仿佛沾满了冰霜、以及烟灰黑色的雪花。 每个函数都是要付出代价的，当然，除非它是无副作用的纯函数。</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/large/63918611gy1fhqlxfkc84j20b408cq2z.jpg\"></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59716156daffd458778816\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(defn prn-list [l]\r\n  (print \"(\")\r\n  (loop [l l]\r\n    (if (nil? l)\r\n      (print \")n\")\r\n      (do (print (l true))\r\n          (when (l false)\r\n            (print \" \"))\r\n          (recur (l false))))))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59716156daffd458778816-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716156daffd458778816-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59716156daffd458778816-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716156daffd458778816-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59716156daffd458778816-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716156daffd458778816-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59716156daffd458778816-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716156daffd458778816-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59716156daffd458778816-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59716156daffd458778816-1\"><span class=\"crayon-o\">(</span><span class=\"crayon-st\">defn</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">prn</span><span class=\"crayon-st\">-</span><span class=\"crayon-st\">list</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">l</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716156daffd458778816-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"(\"</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-59716156daffd458778816-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">loop</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716156daffd458778816-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">nil</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-59716156daffd458778816-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\")n\"</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716156daffd458778816-6\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">true</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-59716156daffd458778816-7\"><span class=\"crayon-h\">          </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">when</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">false</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716156daffd458778816-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-59716156daffd458778816-9\"><span class=\"crayon-h\">          </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">recur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">false</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>白板面试时根本没有多余的时间去描述变量、写示例或文档注释。在白板面试中，时间就是一切。你就假装你是一名 Haskell 程序员，正当着你奶奶的面继续完成下面的代码。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59716156db000048535841\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuser=&gt; (prn-list (cons 1 (cons 2 (cons 3 nil))))\r\n(1 2 3)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59716156db000048535841-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716156db000048535841-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59716156db000048535841-1\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">prn</span><span class=\"crayon-st\">-</span><span class=\"crayon-st\">list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716156db000048535841-2\"><span class=\"crayon-o\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>面试官笑了，安心了。 至少此时，代码输出的链表仍是正序的。“那么，要反转这个链表，你需要……”</p>\n<p>你抓住了他的手，然后在白板上写代码，那感觉就像在用古老的语言吟诵诗句。而此时此刻，他的大脑却一片混乱，好像松了发条的疯狂乱撞的钟，又仿佛心脏上爬过绦虫，砰砰直跳的心脏恨不得逃出胸腔。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59716156db004466816192\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Clojure</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(defn reverse [l]\r\n  (loop [r nil, l l]\r\n    (if l\r\n      (recur (cons (l true) r) (l false))\r\n      r)))\r\n\r\nuser=&gt; (prn-list (reverse (cons 1 (cons 2 (cons 3 nil)))))\r\n(3 2 1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59716156db004466816192-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716156db004466816192-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59716156db004466816192-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716156db004466816192-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59716156db004466816192-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716156db004466816192-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59716156db004466816192-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59716156db004466816192-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59716156db004466816192-1\"><span class=\"crayon-o\">(</span><span class=\"crayon-st\">defn</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">reverse</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">l</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716156db004466816192-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">loop</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59716156db004466816192-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716156db004466816192-4\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">recur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">true</span><span class=\"crayon-o\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span><span class=\"crayon-o\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-k\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">false</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line\" id=\"crayon-59716156db004466816192-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-i\">r</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716156db004466816192-6\"> </div><div class=\"crayon-line\" id=\"crayon-59716156db004466816192-7\"><span class=\"crayon-i\">user</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">prn</span><span class=\"crayon-st\">-</span><span class=\"crayon-st\">list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">reverse</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">(</span><span class=\"crayon-st\">cons</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nil</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span><span class=\"crayon-o\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59716156db004466816192-8\"><span class=\"crayon-o\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>当你松开他的手时，他结结巴巴地说了些有礼貌的话，然后把连帽衫的拉链拉上假装以抵御寒冷。这里将会有其它的面试会议，但你已经不需要参加了。他用锐利的眼光朝你所在的地方看了一眼。</p>\n<p>当然，他们会拒绝你，并且总是装着极其难为情地说，你不符合他们的公司文化。乘风归去吧。此地不属于你。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111889\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111889votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111889\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677\">听风</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/9538B04AD8C6883F49C38BC8ECDDAF3C/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/q4000052677\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/q4000052677/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 20</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "create_date": "2017-07-20", "vote": " ", "front_image_path": "full/6e4397ded9dd50c3d6f3c52e128dcffa90427369.jpg", "title": "反转技术面试！还有这样的操作？", "front_image_url": ["http://wx4.sinaimg.cn/mw690/63918611gy1fhqls12mmhj20dw07hn4u.jpg"]}